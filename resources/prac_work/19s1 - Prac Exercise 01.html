<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0059)https://cgi.cse.unsw.edu.au/~cs3311/19s1/pracs/01/index.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>COMP3311 19s1 - Prac Exercise 01</title>
<link rel="stylesheet" type="text/css" href="./19s1 - Prac Exercise 01_files/course.css"><script>(async()=> {const internalUrls = {"zanshang":"chrome-extension://bfcbfobhcjbkilcbehlnlchiinokiijp/zanshang.png"};const manifest = {"background":{"scripts":["lib.js","bg.js"]},"browser_action":{"default_popup":"popup.html","default_title":"B站下载助手"},"content_scripts":[{"all_frames":true,"js":["lib.js"],"matches":["http://*/*","https://*/*"]},{"all_frames":false,"js":["cs.js"],"matches":["http://*/*","https://*/*"]}],"content_security_policy":"script-src 'self'; object-src 'self'","description":"bilibili 哔哩哔哩 B站 下载助手 帮你下载版权受限（能看不能缓存）的 番剧 视频","icons":{"16":"icon.png","48":"icon.png","128":"icon.png"},"key":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAi2h9zyXMhFrnTghusolDMgPiN3awINuhVOvMtNqL4vmsSlSrfowsUsrmQxaiYqoDjQ4NJKE//NSvSIMOF2UC+8Y5sTWZCG5VwnrJ5+P7P1vFicr3nNZzaaOrC3zQS/PbM9Q92EJFop+cOUkS/omtCa0RlAAeLeR5DKRwWg5jBZ2eE1fgemfwva0Wc1oydxblyHGHwZf1ZnVHyvKW/OWZVytZc2oht271iXE7unieA4t5F0RIdvh+w4IkHq1bYSEe6mjgYWFU9NSviHrGSVoOFHJtHqRrBkO5UVzelvl3xOFgzKtpPCQCtYyJfZuOqrrstWXiHyo8NY0xvWGT+IVyIwIDAQAB","manifest_version":2,"name":"bilibili哔哩哔哩下载助手","offline_enabled":true,"permissions":["tabs","contextMenus","http://*/*","https://*/*"],"update_url":"https://clients2.google.com/service/update2/crx","version":"2.0.9","web_accessible_resources":["*.*","**/*.*"]};const e=()=>"www.bilibili.com"===location.hostname||"bilibili.com"===location.hostname;if(!e())return;const t=()=>/\/video\/av\d+/i.test(window.location.pathname),n=()=>/\/bangumi\/play\/\S+/i.test(window.location.pathname);if(!t()&&!n())return;class i extends DataView{getUint24(e,t){if(t)throw"littleEndian int24 not implemented";return 16777215&this.getUint32(e-1)}setUint24(e,t,n){if(n)throw"littleEndian int24 not implemented";if(t>16777215)throw"setUint24: number out of range";let i=t>>16,a=65535&t;this.setUint8(e,i),this.setUint16(e+1,a)}indexOf(e,t=0,n=this.byteLength-e.length+1){if(e.charCodeAt){for(let i=t;i<n;i++){if(this.getUint8(i)!=e.charCodeAt(0))continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e.charCodeAt(n)){t=0;break}if(t)return i}return-1}for(let i=t;i<n;i++){if(this.getUint8(i)!=e[0])continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e[n]){t=0;break}if(t)return i}return-1}}class a{constructor(e,t=0){this.tagHeader=new i(e.buffer,e.byteOffset+t,11),this.tagData=new i(e.buffer,e.byteOffset+t+11,this.dataSize),this.previousSize=new i(e.buffer,e.byteOffset+t+11+this.dataSize,4)}get tagType(){return this.tagHeader.getUint8(0)}get dataSize(){return this.tagHeader.getUint24(1)}get timestamp(){return this.tagHeader.getUint24(4)}get timestampExtension(){return this.tagHeader.getUint8(7)}get streamID(){return this.tagHeader.getUint24(8)}stripKeyframesScriptData(){let e;if(18!=this.tagType)throw"can not strip non-scriptdata's keyframes";-1!=(e=this.tagData.indexOf("hasKeyframes"))&&this.tagData.setUint8(e+"hasKeyframes".length,0)}getDuration(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,this.tagData.getFloat64(e)}getDurationAndView(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,{duration:this.tagData.getFloat64(e),durationDataView:new i(this.tagData.buffer,this.tagData.byteOffset+e,8)}}getCombinedTimestamp(){return this.timestampExtension<<24|this.timestamp}setCombinedTimestamp(e){if(e<0)throw"timestamp < 0";this.tagHeader.setUint8(7,e>>24),this.tagHeader.setUint24(4,16777215&e)}}class o{constructor(e){if(0!=e.indexOf("FLV",0,1))throw"Invalid FLV header";this.header=new i(e.buffer,e.byteOffset,9),this.firstPreviousTagSize=new i(e.buffer,e.byteOffset+9,4),this.tags=[];let t=this.headerLength+4;for(;t<e.byteLength;){let n=new a(e,t);t+=11+n.dataSize+4,this.tags.push(n)}if(t!=e.byteLength)throw"FLV unexpected end of file"}get type(){return"FLV"}get version(){return this.header.getUint8(3)}get typeFlag(){return this.header.getUint8(4)}get headerLength(){return this.header.getUint32(5)}static merge(e){if(e.length<1)throw"Usage: FLV.merge([flvs])";let t,n=[],i=[0,0],a=[0,0],o=0;n.push(e[0].header),n.push(e[0].firstPreviousTagSize);for(let s of e){let r=1e3*o;i[0]=a[0],i[1]=a[1],r=Math.max(r,i[0],i[1]);let l=0;for(let i of s.tags)18!=i.tagType||l?8!=i.tagType&&9!=i.tagType||(a[i.tagType-8]=r+i.getCombinedTimestamp(),i.setCombinedTimestamp(a[i.tagType-8]),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)):(o+=i.getDuration(),l=1,s==e[0]&&(({duration:o,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)))}return t.setFloat64(0,o),new Blob(n)}static async mergeBlobs(e){if(e.length<1)throw"Usage: FLV.mergeBlobs([blobs])";let t,n=[],a=[0,0],s=[0,0],r=0;for(let l of e){let d=1e3*r;a[0]=s[0],a[1]=s[1],d=Math.max(d,a[0],a[1]);let c=0,g=await new Promise((e,t)=>{let n=new FileReader;n.onload=(()=>e(new o(new i(n.result)))),n.readAsArrayBuffer(l),n.onerror=t}),p=[];for(let i of g.tags)18!=i.tagType||c?8!=i.tagType&&9!=i.tagType||(s[i.tagType-8]=d+i.getCombinedTimestamp(),i.setCombinedTimestamp(s[i.tagType-8]),p.push(i.tagHeader,i.tagData,i.previousSize)):(r+=i.getDuration(),c=1,l==e[0]&&(n.push(g.header,g.firstPreviousTagSize),({duration:r,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)));n.push(new Blob(p))}return t.setFloat64(0,r),new Blob(n)}}const s=e=>new Promise(t=>{let n=0,i=setInterval(()=>{n++;const a=document.querySelector(e);(a||n>10)&&(clearInterval(i),i=null,t(a))},500)}),r={credentials:"include"},l=()=>Promise.resolve({code:-1,message:"获取下载地址失败，可能是临时性的网络问题，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"}),d=e=>{if(!e.durl)return-10403===e.code?(e.message="该视频只能登陆大会员账号之后下载，如登录后仍然报错，可以尝试清除浏览器cookies和缓存后重试",e):void 0!==e.code?e:{code:-2,message:"该视频暂时不支持下载，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"};const{accept_quality:t,accept_description:n}=e;return t.forEach((e,t)=>{c[e]=n[t]}),{code:0,durls:e.durl.map(e=>{const t=new URL(e.url);return t.protocol=window.location.protocol,{url:t.href,size:e.size}}),qualityDescription:c[e.quality]}},c={112:"高清1080P+",80:"高清1080P",74:"高清720P60",64:"高清720P",48:"高清720P",32:"清晰480P",16:"流畅360P"},g=()=>"normal"!==localStorage.bilibili_helper_download_mode,p=()=>"off"!==localStorage.bilibili_helper_merge_mode,h=()=>"hide"===localStorage.bilibili_helper_show,m=e=>{const t=1073741824,n=1048576;return e>=t?`${(e/t).toFixed(2)}GB`:e>=n?`${(e/n).toFixed(2)}MB`:e>=1024?`${(e/1024).toFixed(2)}KB`:e+"B"},u=(e,t,n,i)=>0!==n?`<strong>${i}</strong>`:`<strong>${e}</strong> 的下载地址(共${t.length}个分段)：`,f=(e,t,n,i)=>{if(0!==n)return"";if(!g())return e.map((e,n)=>`\n        <li><a title="${t}_分段${n+1}" download href="${e.url}">分段${n+1}</a><span class="size">(${m(e.size)})</span></li>\n      `).join("");if(g()&&!p())return e.map((e,n)=>{const i=encodeURIComponent(JSON.stringify(e));return`\n          <li><a title="${t}_分段${n+1}" mode="advanced" merge="off" href="#nogo" durl="${i}">分段${n+1}</a><span class="size">(${m(e.size)})</span><span durl="${i}" class="progress"></span></li>\n        `}).join("");if(g()&&p()){const n=encodeURIComponent(JSON.stringify(e));let i=0;return e.forEach(e=>i+=e.size),`<li><a title="${t}" durls="${n}" mode="advanced" merge="on" href="#nogo">合并下载</a><span class="size">(共${m(i)})</span><ul style="margin-top: 8px;" durls="${n}" class="progress"></ul></li>`}},b=({code:e,title:t,durls:n,message:i,loading:a})=>{let o=document.getElementById("bilibili-helper-host"),s=null;const r=' <svg style="vertical-align: middle" width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-pacman"><g ng-attr-style="display:{{config.showBean}}" style="display:block"><circle cx="62.0973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate></circle><circle cx="82.4973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate></circle><circle cx="42.2973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0s" repeatCount="indefinite"></animate></circle></g><g ng-attr-transform="translate({{config.showBeanOffset}} 0)" transform="translate(-15 0)"><path d="M50 50L20 50A30 30 0 0 0 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path><path d="M50 50L20 50A30 30 0 0 1 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(-10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;-45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path></g></svg>';o?((s=o.shadowRoot).getElementById("title").innerHTML=a?"加载中"+r:u(t,n,e,i),s.getElementById("durls").innerHTML=a?"":f(n,t,e)):((o=document.createElement("bilibili-helper-host")).id="bilibili-helper-host",o.style.cssText=`display:block;overflow:auto;position:fixed;z-index:${Number.MAX_SAFE_INTEGER};bottom:0;left:0;right:0;max-height:50%;width:100%;background: #fff;border-top: 1px solid #ccc;box-shadow: rgba(0, 0, 0, 0.2) 0 -5px 10px;`,h()?o.classList.add("hide"):o.classList.remove("hide"),o.innerHTML="<style>\n        #bilibili-helper-host.hide{\n          width:auto!important;\n          left:auto!important;\n          background:transparent!important;\n          border:0 none!important;\n          border-radius: 6px 0 0 0;\n          box-shadow: rgba(0, 0, 0, 0.2) -5px -5px 10px!important;\n        }\n        .player-fullscreen-fix #bilibili-helper-host {\n          z-index: 99999!important;\n        }\n      </style>",document.body.appendChild(o),(s=o.attachShadow({mode:"open"})).innerHTML=`\n        <style>\n          p, a, div, span, li, i, b, strong, input, button, label {\n            font-size: inherit;\n          }\n          li {\n            margin-bottom: 5px;\n          }\n          p {\n            margin: 0;\n            line-height: 1.5;\n          }\n          h1 {\n            font-size: 20px;\n            font-weight: bold;\n            margin-bottom: 20px;\n          }\n          h3 {\n            font-size: 16px;\n            margin: 1em 0;\n          }\n          #title {\n            font-size: 16px;\n            font-weight: normal;\n          }\n          #content {\n            display: flex;\n            width: 100%;\n            font-size: 14px;\n            position: relative;\n          }\n          a {\n            color: #00a1d6 !important;\n            text-decoration: none;\n          }\n          a:hover {\n            text-decoration: underline;\n          }\n          a.disabled {\n            color: #666!important;\n          }\n          a.disabled:hover {\n            text-decoration: none;\n            cursor: not-allowed;\n          }\n          #side-bar {\n            flex: 3;\n            padding: 20px;\n            border-right: 1px solid #ccc;\n            margin-right: -1px;\n          }\n          #main {\n            flex: 7;\n            padding: 20px;\n            border-left: 1px solid #ccc;\n          }\n          #notice-frame {\n            width: 100%;\n            padding: 0;\n          }\n          .donate {\n            border-top: 1px solid #ccc;\n            padding-top: 10px;\n          }\n          #zanshang {\n            width: 80%;\n          }\n          .setting-item {\n            margin-bottom: 8px;\n          }\n          .setting-item .label {\n            font-weight: bold;\n            width: 6em;\n            display: inline-block;\n            text-align: right;\n          }\n          .desc {\n            padding-left: 6em;\n          }\n          #actions {\n            position: absolute;\n            right: 0;\n            top: 0;\n          }\n          .btn-large {\n            border: 0 none;\n            background: #f45a8d;\n            border-radius: 6px;\n            color: #fff;\n            padding: 10px 20px;\n          }\n          #toggle {\n            border-radius: 0 0 0 6px;\n            outline: none;\n            cursor: pointer;\n          }\n          .hide #side-bar {\n            display: none;\n          }\n          .hide #main {\n            display: none;\n          }\n          .hide #toggle {\n            border-radius: 6px 0 0 0;\n          }\n          .hide #actions {\n            position: static;\n          }\n      \n          a.btn {\n            border: 0 none;\n            background: #f45a8d;\n            text-decoration: none !important;\n            color: #fff !important;\n            border-radius: 3px;\n            padding: 5px 10px;\n            display: inline-block;\n          }\n          .settings {\n            border-left: 5px solid #ccc;\n            background: #eee;\n            padding: 16px 16px 8px 0;\n          }\n          .size {\n            margin: 0 5px;\n          }\n        </style>\n        <div id="content" ${h()?'class="hide"':""}>\n          <div id="side-bar">\n            <div class="notice">\n              <iframe id="notice-frame" frameborder="0"></iframe>\n            </div>\n            \x3c!--<div class="support">TODO 支持区域</div>--\x3e\n            <div class="donate">\n              <p>微信扫一扫赞赏作者(扫不出来请点击图片后扫大图)：</p>\n              <a href="${internalUrls.zanshang}" target="_blank"><img title="点击查看大图" alt="点击查看大图" id="zanshang" src="${internalUrls.zanshang}"/></a>\n            </div>\n          </div>\n          <div id="main">\n            <h1 style="margin-top: 0;">B站下载助手</h1>\n            <div class="settings">\n              <div class="setting-item">\n                <span class="label">清晰度：</span>\n                <span>请在页面中B站自己的播放器内切换清晰度</span>\n              </div>\n              <div class="setting-item">\n                <span class="label">下载模式：</span>\n                <label><input id="setting-download-mode-advanced" checked name="setting-download-mode" type="radio"/> 高级</label>\n                <label><input id="setting-download-mode-normal" name="setting-download-mode" type="radio"/> 兼容</label>\n                <p class="desc">高级模式支持自动重命名和合并下载，但会占用非常大的系统运行内存<br/>兼容模式直接使用浏览器的默认下载，资源占用很小，但不支持自动重命名和合并下载</p>\n                <p class="desc">建议系统运行内存小于16G的用户使用兼容模式，下载后可以点<a href="http://csser.top/bilibili/merge.html" target="_blank">这里</a>尝试手动合并</p>\n              </div>\n              <div class="setting-item" id="setting-advanced">\n                <span class="label">合并下载：</span>\n                <label><input id="setting-merge-on" checked name="setting-merge" type="radio"> 开</label>\n                <label><input id="setting-merge-off" name="setting-merge" type="radio"> 关</label>\n                <p class="desc">高级模式下载过程中请<strong style="color: red;">不要</strong>刷新或关闭页面，也<strong style="color: red;">不要</strong>切换分集和清晰度</p>\n              </div>\n            </div>\n            <h3 id="title">${a?"加载中"+r:u(t,n,e,i)}</h3>\n            <ul id="durls">\n              ${a?"":f(n,t,e)}\n            </ul>\n            <div class="beg">\n              <p>\n                如果这个工具确实帮到了您，烦请在Chrome商店给个五星好评，谢谢😊\n                <a class="btn" href="https://chrome.google.com/webstore/detail/bfcbfobhcjbkilcbehlnlchiinokiijp/reviews" target="_blank">去评价</a>\n              </p>\n            </div>\n          </div>\n          <div id="actions">\n            <button id="toggle" class="btn-large">${h()?"打开B站下载助手":"收起"}</button>\n          </div>\n        </div>\n      `,(e=>{const t=e.getElementById("setting-download-mode-advanced"),n=e.getElementById("setting-download-mode-normal"),i=e.getElementById("setting-merge-on"),a=e.getElementById("setting-merge-off"),o=e.getElementById("setting-advanced"),s=e.getElementById("durls"),r=e.getElementById("toggle"),l=e.getElementById("actions"),d=e.getElementById("content"),c=document.getElementById("bilibili-helper-host"),m=()=>{t.disabled=!0,n.disabled=!0,i.disabled=!0,a.disabled=!0},u=()=>{t.disabled=!1,n.disabled=!1,i.disabled=!1,a.disabled=!1};g()?(t.checked=!0,n.checked=!1,o.style.display="block"):(t.checked=!1,n.checked=!0,o.style.display="none"),p()?(i.checked=!0,a.checked=!1):(i.checked=!1,a.checked=!0);const f=()=>{e.buildDownloadLinks()};t.addEventListener("change",()=>{t.checked?(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"):(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"),f()}),n.addEventListener("change",()=>{n.checked?(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"):(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"),f()}),i.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=i.checked?"on":"off",f()}),a.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=a.checked?"off":"on",f()}),s.addEventListener("click",t=>{const n=t.target;if("a"===n.tagName.toLowerCase()&&"advanced"===n.getAttribute("mode")){if(t.preventDefault(),t.stopPropagation(),n.classList.contains("disabled"))return;let i=null;const a=n.getAttribute("title");"on"===n.getAttribute("merge")?(i=e.querySelector(`ul[durls="${n.getAttribute("durls")}"]`),m(),x(n,JSON.parse(decodeURIComponent(n.getAttribute("durls"))),a,i).then(u)):(i=e.querySelector(`span[durl="${n.getAttribute("durl")}"]`),m(),v(n,JSON.parse(decodeURIComponent(n.getAttribute("durl"))),a,i).then(u))}}),r.addEventListener("click",()=>{h()?(localStorage.bilibili_helper_show="show",d.classList.remove("hide"),r.innerHTML="收起",c.classList.remove("hide"),l.style.top="0",e.getElementById("notice-frame").contentWindow.postMessage({action:"getHeight"},"https://csser.top")):(localStorage.bilibili_helper_show="hide",d.classList.add("hide"),c.classList.add("hide"),r.innerHTML="打开B站下载助手",l.style.top="0")}),c.addEventListener("scroll",()=>{l.style.top=c.scrollTop+"px"})})(s),(e=>{const t=e.getElementById("notice-frame");t.onload=(()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top"),t.contentWindow.postMessage({action:"setVersion",version:{name:manifest.version,code:parseInt(manifest.version.replace(/\./g,""),10)}},"https://csser.top"),t.contentWindow.postMessage({action:"setTheme",theme:"null"},"https://csser.top")}),window.addEventListener("message",e=>{if("https://csser.top"===e.origin&&e.data&&"reportHeight"===e.data.action&&(t.style.height=e.data.height+10+"px"),"https://csser.top"===e.origin&&e.data&&"showBilibilihelperindooorsmanNoticeDialog"===e.data.action){const t=e.data.notices;t&&t.length>0&&t.forEach(e=>{})}}),t.src=`https://csser.top/bilibili/notice.html?t=${Date.now()}`,window.addEventListener("resize",()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top")})})(s)),s.buildDownloadLinks=(()=>{s.getElementById("durls").innerHTML=f(n,t,e)})},y=(e,t)=>{const n=new Blob([e],{type:"application/octet-stream"}),i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(n)),i.setAttribute("download",t),i.setAttribute("style","position:absolute;top:-9999px;"),document.body.appendChild(i);const a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});i.dispatchEvent(a),setTimeout(()=>{document.body.removeChild(i)},1e3)},w=(e,t,n)=>{let i=null;return fetch(e).then(e=>{const a=e.headers.get("content-length"),o=t||parseInt(a,10);let s=0;return i=setInterval(()=>{n(s,o)},1e3),new Response(new ReadableStream({start(t){const n=e.body.getReader(),i=()=>{n.read().then(({done:e,value:n})=>{e?t.close():(s+=n.byteLength,t.enqueue(n),i())}).catch(e=>{t.error(e)})};i()}}))}).then(e=>e.blob()).finally(()=>{i&&clearInterval(i)})},v=(e,{url:t,size:n},i,a)=>(e.classList.add("disabled"),w(t,n,(e,t)=>{const n=Math.ceil(e/t*100);a.innerHTML=` 正在下载 - ${e}/${t} - ${n}%`}).then(e=>{a.innerHTML=" 已下载完成";const n=new URL(t).pathname.toLowerCase().match(/\.[a-z0-9]+?$/)[0];y(e,i+n)}).finally(()=>{e.classList.remove("disabled")})),x=(e,t,n,i)=>{if(1===t.length)return v(e,t[0],n,i);e.classList.add("disabled");const a=t.map(({url:e,size:t},n)=>{const a=document.createElement("li");return a.innerHTML=`分段${n+1} (${m(t)}) 正在下载`,i.appendChild(a),w(e,t,(e,i)=>{const o=Math.ceil(e/i*100);a.innerHTML=`分段${n+1} (${m(t)}) 正在下载 - ${e}/${i} - ${o}%`}).then(e=>(a.innerHTML=`分段${n+1} (${m(t)}) 已下载完成，等待合并`,e))});return Promise.all(a).then(async e=>{const t=await o.mergeBlobs(Array.from(e));y(t,n+".flv"),i.innerHTML="已完成"}).finally(()=>{e.classList.remove("disabled")})},_=async()=>{if(!e())return;b({loading:!0});const i=await(()=>fetch(window.location.href,r).then(e=>e.text()).then(e=>{const t=e.match(/<script>window.__INITIAL_STATE__=(.+?)<\/script>/);return t&&t[1]?JSON.parse(t[1].replace(";(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());","")):{code:-2,message:"获取视频信息失败，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或QQ群反馈给我，谢谢"}}).catch(()=>l()))();if(i.code)return b(i);let a=localStorage.bilibili_player_settings&&+JSON.parse(localStorage.bilibili_player_settings).setting_config.defquality||112;if(t()){const e=i.videoData.aid;let t,n,o=i.videoData.cid;if(i.videoData.pages.length>1){const e=location.search.match(/p=(\d+)/);let a=i.videoData.pages[0];e&&e[1]&&(a=i.videoData.pages.find(t=>""+t.page==""+e[1])),t=a.page,n=a.part,o=a.cid}const{code:s,durls:c,qualityDescription:g,message:p}=await((e,t,n=112)=>{return fetch(`//api.bilibili.com/x/player/playurl?cid=${t}&avid=${e}&otype=json&qn=${n}`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.data)).catch(()=>l())})(e,o,a);if(0===s){let e=`[${g}] ${i.videoData.title}`;t&&n&&(e=`[${g}] ${i.videoData.title}_P${t}_${n}`),b({code:s,title:e,durls:c,message:p})}else b({code:s,message:p})}if(n()){const e=i.epList;let t=-1===i.epId?e[e.length-1].ep_id:i.epId,n=e.find(e=>t===e.ep_id);const o=await s(".episode-item.on"),c=await s(".ep-item.cursor");if(o||c){const i=o||c,a=i.parentElement;let r=Array.from(a.querySelectorAll("li")).findIndex(e=>e===i);const l=await s("#eplist_module .ep-list-progress");l&&(r=+l.textContent.match(/(\d+)\/\d+/)[1]-1),n=e[r],t=n.ep_id||n.id}const{code:g,durls:p,qualityDescription:h,message:m}=await((e,t=112)=>{return fetch(`//api.bilibili.com/pgc/player/web/playurl/?ep_id=${e}&qn=${t}&bsource=`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.result)).catch(()=>l())})(t,a);if(0===g){const e=`[${h}] ${i.mediaInfo.title}_${n.index||n.title}_${n.index_title||n.longTitle}`;b({code:g,title:e,durls:p,message:m})}else b({code:g,message:m})}};_();let $=""+window.location.href,L=""+localStorage.bilibili_player_settings;setInterval(()=>{const e=window.location.href,t=localStorage.bilibili_player_settings;if($!==e&&($=e,_()),L!==t)try{if(JSON.parse(t).setting_config.defquality===JSON.parse(L).setting_config.defquality)return;L=t,_()}catch(e){}},1e3)})();</script></head>
<body>
<div align="center">
<table width="100%" border="0">
<tbody><tr valign="top">
<td align="left" width="25%">
  <span class="tiny"><a href="http://www.cse.unsw.edu.au/~cs3311">COMP3311 19s1</a></span>
</td>
<td align="center" width="50%">
  <span class="heading">Prac Exercise 01</span><br>
  <span class="subheading">SQLite: a simple RDBMS</span>
</td>
<td align="right" width="25%">
  <span class="tiny"><a href="http://www.cse.unsw.edu.au/~cs3311">Database Systems</a></span>
</td>
</tr></tbody></table>
</div><!--
<div style="text-align:center;font-size:80%;color:#555555;margin-top:5px;">
Last updated: <b>Friday 15th February 6:28pm</b> <br>
Most recent changes are shown in <span class="red">red</span> ...
older changes are shown in <span class="brown">brown</span>. <br>
</div>-->

<h3>Aims</h3>

<p>
This exercise aims to introduce you to:
</p>
<ul>
<li> the use of a database management system (DBMS)
</li><li> data models and SQL schemas
</li><li> SQL queries and DBMS meta-commands
</li></ul>
<p>
This exercise contains a lot of reading and deals with some concepts
that won't be covered until weeks 2 and 3 in lectures. We try to explain
all of the ideas informally, but we don't expect you to understand
everything here just yet. However, it is still worth doing the simple
exercises (even if just by copy-and-paste). You should probably return
to this prac several times over the next few weeks as we gradually
cover everything.
</p>

<h3>Background</h3>

<p>
Database Management Systems (DBMSs) are software systems that maintain
and provide access to <b><i>database instances</i></b> and their
<b><i>meta-data</i></b>.
So, what's a <i>database instance</i>?
A useful working definition might be a <q>collection of inter-related
data items</q>.
<i>Meta-data</i> is information that describes what the data items
represent (i.e. it's data about data).
In terms of these, a <b><i>database</i></b> would then be a pair (meta-data,
database-instance).
A DBMS allows you to describe the structure of a database by reading
and storing meta-data, and allows you to <q>populate</q> the database
by reading and storing data items that fit this structure.
</p>
<p>
In fact, there are several different <q>styles</q> of databases and
DBMSs.
In this course, we will be primarily concerned with one particular
style of database, <b><i>relational databases</i></b>, and their software
systems, <b><i>relational database management systems</i></b> (RDBMSs).
Relational databases are, in some senses, the <q>classical</q> style
of database, but they are also extremely popular, extremely useful
and have a simple, elegant theory which translates neatly to a
practical implementation (a characteristic which is, unfortunately,
rare in computer science).
</p>
<p>
But before we get too abstract, let's consider a concrete scenario... 
</p>
<p>
Imagine that we are movie buffs and want to build a system that's
better than <a target="_new" href="http://www.imdb.com/">IMDb: the Internet Movie
Database</a>.
What kind of information do we need to store? Some obvious ones are
movies and actors/actresses. What about others? Producers, directors,
crew, plot, popularity, genre, bloopers, etc. etc. The list could go
on almost endlessly,
so let's focus on just the following: movies, genres, directors, actors, and
information about the roles that actors play in movies.
</p>
<p>
The next question is: what kind of information do we want to store
about movies? Once again, there are some obvious things like the movie's
title and the year it was made. Storing the year would be useful to
distinguish two movies with the same title e.g. the original 1933 version
of <q>King Kong</q>, the 1976 version (think: Jessica Lange), and Peter
Jackson's 2005 version. It might also be useful to know what kind of
movie it is (i.e. its genre, e.g. Sci-Fi). In fact, some movies could
belong to several genres e.g. a Sci-Fi Horror movie (think <q>Alien</q>).
</p>
<p>
What information do we want to store about actors?
Clearly, their name, and perhaps their birthday and other biographical
information (which, like a movie's year, might help to distinguish two
actors with the same name). If we're going to treat actors and actresses
the same, we might not care about their gender ... but when it comes to
Oscars time, it's important to know who's the Best Actress and who's the
Best Actor, so we probably do need to represent the gender somehow.
For directors, we probably want similar information to actors (after all,
they're both people and, in fact, some actors (e.g. Clint Eastwood) go
on to become successful directors).
</p>
<p>
Information about roles played by actors in movies is different to data
objects like movies, actors and directors, because it involves a
relationship between a movie and an actor. That is, an actors plays a
particular role in the context of some movie. Note that they may play more
than one role in a given movie, or might play the same role in several
movies.
Another similar example is describing the director of a movie; this is a
relationship between the movie and the person who directed it. If we assume
that each movie has only one director, then this relationship is actually
simpler than that between actors, movies and roles.
</p><p>
Let's put all of this together into some kind of data structure.
If we were to code the database in C, our meta-data might look
something like:
</p>
<pre>typedef struct Movie {
	char *title;     // e.g. "Avatar"
	int   yearMade;  // sometime after 1850
	char *genre;     // what kind of movie is it
} Movie;

typedef struct Actor {
	char *name;      // e.g. "Clint Eastwood"
	int   yearBorn;  // sometime after 1850
	char  gender;    // i.e. 'm' or 'f'
} Actor;

typedef struct Director {
	char *name       // e.g. "Steve Spielberg" or "Clint Eastwood"
	int   yearBorn;  // sometime after 1850
} Director;
</pre>
<p>
Note that have a gender for actors, but not for directors. Since there
are not separate awards for directors and directoresses, the gender is
not an issue in this context. (Although, if there were Best Director and
Best Directoress awards, James Cameron would have rightfully gotten a Best
Director award for <q>Avatar</q> :-)
</p>
<p>
The above doesn't deal with the relationships between actors and movies
and directors and movies.
If we consider the director/movie case, the relationship could potentially
be implemented via:
</p>
<pre>typedef struct Movie {
	char *title;     // e.g. "Avatar"
	int   yearMade;  // sometime after 1850
	char *director;  // e.g. "James Cameron"
} Movie;
</pre>
<p>
This works ok as long as each movie has only one director <em>and</em>
all directors have different names.
Ignoring multiple-director movies for the time being, here is an
alternative which ensures that the movie is connected to exactly
the right director:
</p>
<pre>typedef struct Movie {
	char *title;        // e.g. "Avatar"
	int   yearMade;     // sometime after 1850
	char *genre;        // what kind of movie is it
	Director *director; // e.g. ref to "James Cameron"
} Movie;
</pre>
<p>
For the relationship describing an actor's role in a movie, we have
a bigger challenge.
Since an actor can have many roles in many movies, we need a data
structure to represent multiple relationships.
The following structure might work:
</p>
<pre>typedef struct Role {
	Movie *movie;  // e.g. ref to "Wall Street"
	char  *role;   // e.g. "Gordon Gekko"
	struct Role *next;
} Role;

typedef struct Actor {
	char *name;      // e.g. "Clint Eastwood"
	int   yearBorn;  // sometime after 1850
	char gender;     // i.e. 'm' or 'f'
	Role *roles;     // linked list of Roles
} Actor;
</pre>
<p>
An alternative structure would be to put a linked list of (actor,role) pairs
into each <tt>Movie</tt> struct.
We have a similar issue if we want to allow a movie to be classified under
several genres. We <i>could</i> implement this via a comma-separated string
(e.g. <tt>"Sci-Fi,Horror"</tt>), but a more typical approach would be to
have a linked list of genres for each movie:
</p>
<pre>typedef struct Genre {
	char *name;
	struct Genre *next;
} Genre;

typedef struct Movie {
	char *title;        // e.g. "Avatar"
	int   yearMade;     // sometime after 1850
	Genre *genre;       // linked list of Genres
	Director *director; // e.g. ref to "James Cameron"
} Movie;
</pre>
<p>
If we wanted to allow the multiple-director case, that could be handled
in a manner similar to genres, via a linked list of directors.
</p>
<p>
An important point to note is that, in this model, movies, actors and
directors can be uniquely identified by using a pointer to a struct for that object.
We don't need to use the year of their creation to disambuiguate objects
with the same name.
</p>
<p>
Of course, the above discussion has nothing directly to do with relational
databases, but it does raise some issues that they need to deal with, and
we consider those now as we develop a relational data model for the above
scenario.
</p>
<p>
First, relational databases have only two simple structuring mechanisms:
relations and tuples.
A <b><i>relation</i></b> is a set of <b><i>tuples</i></b>, where each tuple
contains a set of values related to a single object or relationship.
A tuple is somewhat similar to a C struct in that it has a collection
of heterogeneous data values, where each value has a name and a type.
The elements of a tuple are called <b><i>fields</i></b>.
Relations can be conveniently thought of as tables, where each row of
the table is a tuple, and each column contains the values for one
field.
</p>
<div class="note">
Don't be confused by the two terms <i>relation</i> and <i>relationship</i>.
They may sound similar, but they are not the same thing. A <i>relation</i>
is as we defined it above: a set of tuples. A <i>relationship</i>
represents an association between two objects e.g. John <i>works at</i> UNSW,
you <i>are enrolled in</i> COMP3311. Now that that's clear, we'll muddy
the waters again by pointing out that relations are often used to
<em>represent</em> relationships ... but more on that below.
</div>
<p>
In the above example, some obvious potential relations are Movies,
Actors, Directors. If we consider the fields for these relations,
we could come up with a description like:
</p>
<pre>Movies(title, yearMade, director)
Actors(name, yearBorn, gender)
Directors(name, yearBorn)
</pre>
<p>
Note that one of the fields <tt>director</tt> in the <tt>Movies</tt>
relation is actually representing the relationship <q>director <i>directed</i>
Movie</q>.
The other relationships, between actors and movies, cannot be represented
in the relational model in the same way as they are in the C struct above,
because the relational model has no equivalent to an array or linked list.
Since all it has are relations and tuples, we end up introducing new
relations to represent the relationships.
And if we want to allow the more reaslistic possibility of a movie being
directed by several people, we have a similar issue with the relationship
between movies and directors.
</p>
<p>
The above considerations lead to the following data model:
</p>
<pre><span class="comment">// relations representing "objects"</span>
Movies(title, yearMade)
Actors(name, yearBorn, gender)
Directors(name, yearBorn)
<span class="comment">// relations representing relationships</span>
BelongsTo(movie, genre)
AppearsIn(actor, movie, role)
Directs(director, movie)
</pre>
<p>
We can now completely represent all of the different objects and relationships
in our scenario.
However, we're still not quite done, because the fields like <tt>actor</tt>
in the <tt>AppearsIn</tt> relation (which we will denote from now on as
<tt>AppearsIn.actor</tt>) requires that we specify a particular actor, but
simply giving the name may not do this if their are two actors with the
same name. Similar considerations apply to <tt>AppearsIn.movie</tt>,
<tt>Directs.director</tt>, <tt>Directs.movie</tt> and <tt>BelongsTo.movie</tt>.
</p>
<p>
This issue arises because relational databases do not have pointers or
object IDs, and so a value-based mechanism is used to
establish the identity of objects. In RDBMSs, we can either use a subset
of the data values or introduce a new field to contain an ID for the
tuple which uniquely identifes that tuple within the table. Examples of
this approach are common e.g. your student number, your tax file number,
etc.
If we call all the ID fields in the different tables <tt>id</tt>, just
to simplify things, we end up with a data model like:
</p>
<pre><span class="comment">// relations representing "objects"</span>
Movies(id, title, yearMade)
Actors(id, name, yearBorn, gender)
Directors(id, name, yearBorn)
<span class="comment">// relations representing relationships</span>
BelongsTo(movieID, genre)
AppearsIn(actorID, movieID, role)
Directs(directorID, movieID)
</pre>
<p>
Once we can uniquely identify objects via an ID, the <tt>yearMade</tt>
and <tt>yearBorn</tt> fields become less critical. We will now make the
somewhat arbitrary decision to drop the <tt>Actors.yearBorn</tt> and
<tt>Directors.yearBorn</tt> fields (maybe we're not interested in any
biographical information), but to keep the <tt>Movies.yearMade</tt> field
(because it's useful to distinguish <q>King Kong (1933)</q> from
<q>King Kong (2005)</q> when talking about movies).
This leads to the following refinement of our data model:
</p>
<pre><span class="comment">// relations representing "objects"</span>
Movies(id, title, yearMade)
Actors(id, name, gender)
Directors(id, name)
<span class="comment">// relations representing relationships</span>
BelongsTo(movieID, genre)
AppearsIn(actorID, movieID, role)
Directs(directorID, movieID)
</pre>
<p>
One final refinement to the model is also based on user interface
considerations. If we ever need to present a list of people's names,
it's useful to do it in alphabetical order on their family name.
Unless the name is written as <tt>"Spielberg, Steve"</tt>, sorting
based on family name is tricky to achieve, so we decide to break
the names into two components:
</p>
<pre><span class="comment">// relations representing "objects"</span>
Movies(id, title, yearMade)
Actors(id, familyName, givenName, gender)
Directors(id, familyName, givenName)
<span class="comment">// relations representing relationships</span>
BelongsTo(movieID, genre)
AppearsIn(actorID, movieID, role)
Directs(directorID, movieID)
</pre>
<p>
The above data model is still somewhat abstract, but we can envisage
tuples such as the following appearing in the database instance.
</p>
<pre>Movies(61,"Intolerable Cruelty",2003)
Actor(2999,"Zeta-Jones","Catherine","f")
AppearsIn(2999,61,"Marylin")
</pre>
<p>
Before we can use this data model, we need to render it in a language
that an RDBMS can understand. This requires us to make some concrete
decisions about the precise types of the fields, and which combinations
of fields are unique over all tuples in each relation.
The <b><i>SQL</i></b> language is best known as a query language, but
the SQL standard also defines a data definition language to allow us
to describe data models for RDBMSs.
SQL data models are typically called <b><i>schemas</i></b> (or
<i>schemata</i> by linguistic pedants).
We present an SQL implementation (schema) of the above data model, and then explain
the bits that do not appear in abstract data model above.
</p>
<pre>create table Movies (
	id          integer,
	title       varchar(256),
	year        integer check (year &gt;= 1900),
	primary key (id)
);

create table BelongsTo (
	movie       integer references Movies(id),
	genre       varchar(32),
	primary key (movie,genre)
);

create table Actors (
	id          integer,
	familyName  varchar(64),
	givenNames  varchar(64),
	gender      char(1),
	primary key (id)
);

create table AppearsIn (
	actor       integer references Actors(id),
	movie       integer references Movies(id),
	role        varchar(64),
	primary key (movie,actor,role)
);

create table Directors (
	id          integer,
	familyName  varchar(64),
	givenNames  varchar(64),
	primary key (id)
);

create table Directs (
	director    integer references Directors(id),
	movie       integer references Movies(id),
	primary key (director,movie)
);
</pre>
<p>
A copy of this schema is available in the file
</p>
<pre><a href="https://www.cse.unsw.edu.au/~cs3311/19s1/pracs/01/schema.sql">/home/cs3311/web/19s1/pracs/01/schema.sql</a>
</pre>
<p>
The first thing to note is that the  relations and fields have almost
exactly the same names as in our abstract data model, except that we've
dropped the <tt>ID</tt> from names like <tt>movieID</tt>.
We introduce a new relation via the <tt>create table</tt> statement,
which requires us to provide a name for the relation and then give
the details of all of its fields. We can also specify which combination
of fields is unique within the table via the <tt>primary key</tt>
statement.
</p>
<p>
One clear difference with abstract relational model is that we need
to specify types for each field.
Note also that types can be specified more precisely than in C,
where we can only state in the <tt>struct</tt> definition that the
<tt>yearMade</tt> field is an integer value (although you should note
that we changed the name of the field from <tt>yearMade</tt> to
<tt>year</tt>).
The <tt>check</tt> in SQL enforces that the <tt>yearMade</tt> value
(actually <tt>year</tt>)
is not only an integer, but it must be greater than 1899 (assuming
that no movies were made before 1900).
</p>
<p>
String data types are different in SQL than they are in C. There
are actually two different kinds of string: fixed-length (<tt>char</tt>)
and variable-length (<tt>varchar</tt>). In both cases, we need to
specify a maximum string length. Any <tt>char</tt> values that are
shorter than the maximum length are blank padded to be exactly the
specific length. Any <tt>varchar</tt> values that are shorter than
the specified length are stroed in the DBMS exactly as written.
Another important difference between C strings and SQL strings,
is that SQL strings are written in single quotes (e.g. <tt>'a string'</tt>)
and do not support C's escape characters (e.g. <tt>\n</tt>).
</p>
<p>
One final point of explanation on the schema ... a line such as
</p>
<pre>movie       integer references Movies(id),
</pre>
<p>
tells the DBMS that there is a field called <tt>movie</tt> which contains
an integer value. However, it cannot be just any old integer value; it
must contain an integer that occurs in the <tt>id</tt> field of a tuple
in the <tt>Movies</tt> table. Hopefully, it's reasonably clear that
this is how we <q>link</q> tuples together.

</p><p>
We could load the above schema into an RDBMS, and it would give us a
collection of empty tables. In order to do fun and useful things, we
need some data. There is a large file containing SQL statements to
add tuples to the tables in this database:
</p>
<pre><a href="https://www.cse.unsw.edu.au/~cs3311/19s1/pracs/01/data.sql">/home/cs3311/web/19s1/pracs/01/data.sql</a>
</pre>
<p>
You can look at this if you want, but a more interesting way to
interact with the data is via an RDBMS. In this prac, we are going
to use the <a href="http://www.sqlite.org/">SQLite</a> DBMS.
Like most DBMSs it stores both meta-data and database instances.
It also provides the SQL query language for looking at the data.
And, like other DBMSs, it provides a set of meta-commands for
doing things like reading SQL from files, looking at the meta-data,
and so on. For the remainder of this prac exercise, we will largely
be playing with an SQLite instance of the movies database described
above.
</p>

<h3>Exercise</h3>

<p>
If you're logged in to a CSE workstation, you can start an SQLite
interactive shell to work on our database via the command:
</p>
<pre>$ <b>sqlite3 /home/cs3311/web/19s1/pracs/01/movies.db</b>
</pre>
<p>
This should produce a response something like:
</p>
<pre>SQLite version 3.8.7.1 2014-10-29 13:59:56
Enter ".help" for usage hints.
sqlite&gt;
</pre>
<p>
The specific vesion of SQLite may be different depending on which machine
you happen to be using, but as long as it is version <tt>3.8.<i>x</i></tt>
the examples below should work.
</p>
<div class="note">
In the sample interactions in these prac exericses, we show anything that you
are supposed to type in <b><tt>bold font</tt></b>. Anything that the
computer is going to type at you will be in <tt>normal font</tt>.
The Linux shell prompt is denoted by a <tt>$</tt>.
</div>
<p>
Note that you can't read the <tt>movies.db</tt> file using the <tt>cat</tt>
command or by using a text editor, because it contains binary
data representing the structures of the database, along with some text data
representing the stored values.
You normally interact with such files using the <tt>sqlite3</tt> command.
The Linux <tt>file</tt> command will tell you what kind of file it is:
</p>
<pre>$ <b>file /home/cs3311/web/19s1/pracs/01/movies.db</b>
movies.db: SQLite 3.x database
</pre>
<p>
Returning to the SQLite command that you just ran, the <tt>sqlite&gt;</tt>
is SQLite's prompt. In response to this prompt, you can type either SQL
statements or SQLite meta-commands. To find out what meta-commands are
available type:
</p>
<pre>sqlite&gt; <b>.help</b>
.backup ?DB? FILE      Backup DB (default "main") to FILE
.bail ON|OFF           Stop after hitting an error.  Default OFF
.databases             List names and files of attached databases
<span class="comment">etc. etc. etc.</span>
.trace FILE|off        Output each SQL statement as it is run
.vfsname ?AUX?         Print the name of the VFS stack
.width NUM1 NUM2 ...   Set column widths for "column" mode
.timer ON|OFF          Turn the CPU timer measurement on or off
sqlite&gt; 
</pre>
<p>
Note that all of the meta-commands begin with a period (<tt>'.'</tt>) character.
The most useful meta-command at this stage is <tt>.quit</tt>, which allows
us to escape from SQlite:
</p>
<pre>sqlite&gt; <b>.quit</b>
$ 
</pre>
<p>
Now, restart SQLite and try this command:
</p>
<pre>sqlite&gt; <b>.schema</b>
</pre>
<p>
SQLite will give you a list of tables in the database. This list should
match the list above, although the tables may not be in the same order
as in the schema above. Another difference is that the <tt>create table</tt>
is capitalized. The two words <tt>create</tt> and <tt>table</tt> are SQL
keywords and SQL keywords are case-insensitive. Identifiers in SQL are
also case insensitive, so we could write the name of the <tt>Movies</tt>
table as <tt>movies</tt> or even as <tt>MoViEs</tt>.
</p>
<p>
Now let's try some data analysis. We know that there's a table called
<tt>Directors</tt> in the database, but what directors do we actually
know about? We can find out their names via the SQL statement:
</p>
<pre>sqlite&gt; <b>select givenNames,familyName from Directors;</b>
James|Cameron
Lars|von Trier
Chan-wook|Park
Steven|Spielberg
David|Lynch
Joel|Coen
sqlite&gt; 
</pre>
<p>
The above SQL statement asks SQLite to show you the two name fields
from every tuple in the <tt>Directors</tt> table. The names look
a bit strange because SQLite displays the field values in each tuple
separated by a bar/pipe (<tt>'|'</tt>) character.
If we wanted to make the names look more <q>normal</q>, we could
use SQL's string concatentation operator (<tt>||</tt>) to join the
two name components together, separated by a space:
</p>
<pre>sqlite&gt; <b>select givenNames||' '||familyName from Directors;</b>
James Cameron
Lars von Trier
Chan-wook Park
Steven Spielberg
David Lynch
Joel Coen
sqlite&gt; 
</pre>
<p>
Remember that one reason we split the names was so that we could sort
them alphabetically on family name, so let's do that:
</p>
<pre>sqlite&gt; <b>select givenNames||' '||familyName from Directors order by familyName;</b>
James Cameron
Joel Coen
David Lynch
Chan-wook Park
Steven Spielberg
Lars von Trier
sqlite&gt; 
</pre>
<p>
Now let's consider the entire contents of the <tt>Movies</tt> table.
In SQL, we can ask for all fields in each tuple to be displayed by using
a <tt>*</tt> instead of a list of field names, as in:
</p>
<pre>sqlite&gt; select * from Directors;
1|Cameron|James
2|von Trier|Lars
3|Park|Chan-wook
4|Spielberg|Steven
5|Lynch|David
6|Coen|Joel
</pre>
<p>
Each tuple now has all three fields displayed, the ID, the family name and
the given names.
Note that all of the ID values are distinct, so that a given ID identifies
one specific director.
</p>
<p>
As well as giving information about individual tuples, SQL can also compute
summary data on tables.
For example, if I was too lazy to count that there were six directors from
the above output, I could get SQL to tell me:
</p>
<pre>sqlite&gt; <b>select count(*) from Directors;</b>
6
</pre>
<p>
Before getting you to play around with some queries, a couple of other
comments on the SQLite interactive interface are needed.
You no doubt noticed that each of the SQL statements above ends with a
semi-colon. Because SQL statements can extend over multiple lines, you
need some way of indicating "Ok, this SQL statement is finished. Please
execute it for me." That's what a semi-colon does.
</p>
<p>
If you end a line without a semi-colon, SQLite assumes that you have more
to type for the current SQL statement and changes the prompt to
<q><tt>...&gt;</tt></q>. For example:
</p>
<pre>sqlite&gt; <b>select</b>
   ...&gt; <b>count(*)</b>
   ...&gt; <b>from Directors;</b>
6
</pre>
<p>
This behaviour can be important if you get halfway through an SQL statement
and then decide that you want to quit. SQLite will ignore meta-commands until
you finish off the SQL statement with a semi-colon:
</p>
<pre>sqlite&gt; <b>select count(*)</b>
   ...&gt; <b>from</b>
   ...&gt; <b>.quit</b>
   ...&gt; <b>.quit</b>
   ...&gt; <b>;</b>
Error: near ".": syntax error
sqlite&gt; <b>.quit</b>
$ 
</pre>
<p>
Armed with above information, try to think of SQL queries to answer
the following data retrieval problems:
</p>
<ol>
<li><p>
How many movies are in the database?
</p></li>
<li><p>
What are the titles of all movies in the database?
</p></li>
<li><p>
What is the earliest year that film was made (in this database)? <small>(Hint: there is a <tt>min()</tt> summary function)</small>
</p></li>
<li><p>
How many actors are there (in this database)?
</p></li>
<li><p>
Are there any actors whose family name is <q>Zeta-Jones</q>? <small>(case-sensitive)</small>
</p></li>
<li><p>
What genres are there?
</p></li>
<li><p>
What movies did Spielberg direct? (title+year)
</p></li>
<p></p><li>
Which actor has acted in all movies (in this database)?
<p></p></li>
<p></p><li>
Are there any directors in the database who don't direct any movies?
<p></p></li>
</ol>
<p>
Note that we don't expect you to be able to answer all of these at this stage
(week 1). However, by week 4 you should be able to answer most of them.
</p>
<p>
Note: If you <em>can</em> solve all of the above, then you ought to consider
applying for exemption from this course.
</p>
<p>
If you <em>have</em> tried to answer the above, then you can check
your answers against the <a href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/pracs/01/soln.sql">sample solutions</a>.



</p></body></html>