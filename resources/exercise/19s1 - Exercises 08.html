<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0063)https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>COMP3311 19s1 - Exercises 08</title>
<link rel="stylesheet" type="text/css" href="./19s1 - Exercises 08_files/course.css"><script language="JavaScript">
function changeText(el, newText) {
  // Safari work around
  if (el.innerText)
    el.innerText = newText;
  else if (el.firstChild && el.firstChild.nodeValue)
    el.firstChild.nodeValue = newText;
}
function toggleVisible(elid) {
  el1 = document.getElementById(elid);
  el2 = document.getElementById(elid+"a");
  if (el1.style.display == "") {
     el1.style.display = "none";
     changeText(el2,"show answer");
  }
  else {
     el1.style.display = "";
     changeText(el2,"hide answer");
  }
}
</script><script>(async()=> {const internalUrls = {"zanshang":"chrome-extension://bfcbfobhcjbkilcbehlnlchiinokiijp/zanshang.png"};const manifest = {"background":{"scripts":["lib.js","bg.js"]},"browser_action":{"default_popup":"popup.html","default_title":"B站下载助手"},"content_scripts":[{"all_frames":true,"js":["lib.js"],"matches":["http://*/*","https://*/*"]},{"all_frames":false,"js":["cs.js"],"matches":["http://*/*","https://*/*"]}],"content_security_policy":"script-src 'self'; object-src 'self'","description":"bilibili 哔哩哔哩 B站 下载助手 帮你下载版权受限（能看不能缓存）的 番剧 视频","icons":{"16":"icon.png","48":"icon.png","128":"icon.png"},"key":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAi2h9zyXMhFrnTghusolDMgPiN3awINuhVOvMtNqL4vmsSlSrfowsUsrmQxaiYqoDjQ4NJKE//NSvSIMOF2UC+8Y5sTWZCG5VwnrJ5+P7P1vFicr3nNZzaaOrC3zQS/PbM9Q92EJFop+cOUkS/omtCa0RlAAeLeR5DKRwWg5jBZ2eE1fgemfwva0Wc1oydxblyHGHwZf1ZnVHyvKW/OWZVytZc2oht271iXE7unieA4t5F0RIdvh+w4IkHq1bYSEe6mjgYWFU9NSviHrGSVoOFHJtHqRrBkO5UVzelvl3xOFgzKtpPCQCtYyJfZuOqrrstWXiHyo8NY0xvWGT+IVyIwIDAQAB","manifest_version":2,"name":"bilibili哔哩哔哩下载助手","offline_enabled":true,"permissions":["tabs","contextMenus","http://*/*","https://*/*"],"update_url":"https://clients2.google.com/service/update2/crx","version":"2.0.9","web_accessible_resources":["*.*","**/*.*"]};const e=()=>"www.bilibili.com"===location.hostname||"bilibili.com"===location.hostname;if(!e())return;const t=()=>/\/video\/av\d+/i.test(window.location.pathname),n=()=>/\/bangumi\/play\/\S+/i.test(window.location.pathname);if(!t()&&!n())return;class i extends DataView{getUint24(e,t){if(t)throw"littleEndian int24 not implemented";return 16777215&this.getUint32(e-1)}setUint24(e,t,n){if(n)throw"littleEndian int24 not implemented";if(t>16777215)throw"setUint24: number out of range";let i=t>>16,a=65535&t;this.setUint8(e,i),this.setUint16(e+1,a)}indexOf(e,t=0,n=this.byteLength-e.length+1){if(e.charCodeAt){for(let i=t;i<n;i++){if(this.getUint8(i)!=e.charCodeAt(0))continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e.charCodeAt(n)){t=0;break}if(t)return i}return-1}for(let i=t;i<n;i++){if(this.getUint8(i)!=e[0])continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e[n]){t=0;break}if(t)return i}return-1}}class a{constructor(e,t=0){this.tagHeader=new i(e.buffer,e.byteOffset+t,11),this.tagData=new i(e.buffer,e.byteOffset+t+11,this.dataSize),this.previousSize=new i(e.buffer,e.byteOffset+t+11+this.dataSize,4)}get tagType(){return this.tagHeader.getUint8(0)}get dataSize(){return this.tagHeader.getUint24(1)}get timestamp(){return this.tagHeader.getUint24(4)}get timestampExtension(){return this.tagHeader.getUint8(7)}get streamID(){return this.tagHeader.getUint24(8)}stripKeyframesScriptData(){let e;if(18!=this.tagType)throw"can not strip non-scriptdata's keyframes";-1!=(e=this.tagData.indexOf("hasKeyframes"))&&this.tagData.setUint8(e+"hasKeyframes".length,0)}getDuration(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,this.tagData.getFloat64(e)}getDurationAndView(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,{duration:this.tagData.getFloat64(e),durationDataView:new i(this.tagData.buffer,this.tagData.byteOffset+e,8)}}getCombinedTimestamp(){return this.timestampExtension<<24|this.timestamp}setCombinedTimestamp(e){if(e<0)throw"timestamp < 0";this.tagHeader.setUint8(7,e>>24),this.tagHeader.setUint24(4,16777215&e)}}class o{constructor(e){if(0!=e.indexOf("FLV",0,1))throw"Invalid FLV header";this.header=new i(e.buffer,e.byteOffset,9),this.firstPreviousTagSize=new i(e.buffer,e.byteOffset+9,4),this.tags=[];let t=this.headerLength+4;for(;t<e.byteLength;){let n=new a(e,t);t+=11+n.dataSize+4,this.tags.push(n)}if(t!=e.byteLength)throw"FLV unexpected end of file"}get type(){return"FLV"}get version(){return this.header.getUint8(3)}get typeFlag(){return this.header.getUint8(4)}get headerLength(){return this.header.getUint32(5)}static merge(e){if(e.length<1)throw"Usage: FLV.merge([flvs])";let t,n=[],i=[0,0],a=[0,0],o=0;n.push(e[0].header),n.push(e[0].firstPreviousTagSize);for(let s of e){let r=1e3*o;i[0]=a[0],i[1]=a[1],r=Math.max(r,i[0],i[1]);let l=0;for(let i of s.tags)18!=i.tagType||l?8!=i.tagType&&9!=i.tagType||(a[i.tagType-8]=r+i.getCombinedTimestamp(),i.setCombinedTimestamp(a[i.tagType-8]),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)):(o+=i.getDuration(),l=1,s==e[0]&&(({duration:o,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)))}return t.setFloat64(0,o),new Blob(n)}static async mergeBlobs(e){if(e.length<1)throw"Usage: FLV.mergeBlobs([blobs])";let t,n=[],a=[0,0],s=[0,0],r=0;for(let l of e){let d=1e3*r;a[0]=s[0],a[1]=s[1],d=Math.max(d,a[0],a[1]);let c=0,g=await new Promise((e,t)=>{let n=new FileReader;n.onload=(()=>e(new o(new i(n.result)))),n.readAsArrayBuffer(l),n.onerror=t}),p=[];for(let i of g.tags)18!=i.tagType||c?8!=i.tagType&&9!=i.tagType||(s[i.tagType-8]=d+i.getCombinedTimestamp(),i.setCombinedTimestamp(s[i.tagType-8]),p.push(i.tagHeader,i.tagData,i.previousSize)):(r+=i.getDuration(),c=1,l==e[0]&&(n.push(g.header,g.firstPreviousTagSize),({duration:r,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)));n.push(new Blob(p))}return t.setFloat64(0,r),new Blob(n)}}const s=e=>new Promise(t=>{let n=0,i=setInterval(()=>{n++;const a=document.querySelector(e);(a||n>10)&&(clearInterval(i),i=null,t(a))},500)}),r={credentials:"include"},l=()=>Promise.resolve({code:-1,message:"获取下载地址失败，可能是临时性的网络问题，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"}),d=e=>{if(!e.durl)return-10403===e.code?(e.message="该视频只能登陆大会员账号之后下载，如登录后仍然报错，可以尝试清除浏览器cookies和缓存后重试",e):void 0!==e.code?e:{code:-2,message:"该视频暂时不支持下载，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或者QQ群反馈给我，谢谢"};const{accept_quality:t,accept_description:n}=e;return t.forEach((e,t)=>{c[e]=n[t]}),{code:0,durls:e.durl.map(e=>{const t=new URL(e.url);return t.protocol=window.location.protocol,{url:t.href,size:e.size}}),qualityDescription:c[e.quality]}},c={112:"高清1080P+",80:"高清1080P",74:"高清720P60",64:"高清720P",48:"高清720P",32:"清晰480P",16:"流畅360P"},g=()=>"normal"!==localStorage.bilibili_helper_download_mode,p=()=>"off"!==localStorage.bilibili_helper_merge_mode,h=()=>"hide"===localStorage.bilibili_helper_show,m=e=>{const t=1073741824,n=1048576;return e>=t?`${(e/t).toFixed(2)}GB`:e>=n?`${(e/n).toFixed(2)}MB`:e>=1024?`${(e/1024).toFixed(2)}KB`:e+"B"},u=(e,t,n,i)=>0!==n?`<strong>${i}</strong>`:`<strong>${e}</strong> 的下载地址(共${t.length}个分段)：`,f=(e,t,n,i)=>{if(0!==n)return"";if(!g())return e.map((e,n)=>`\n        <li><a title="${t}_分段${n+1}" download href="${e.url}">分段${n+1}</a><span class="size">(${m(e.size)})</span></li>\n      `).join("");if(g()&&!p())return e.map((e,n)=>{const i=encodeURIComponent(JSON.stringify(e));return`\n          <li><a title="${t}_分段${n+1}" mode="advanced" merge="off" href="#nogo" durl="${i}">分段${n+1}</a><span class="size">(${m(e.size)})</span><span durl="${i}" class="progress"></span></li>\n        `}).join("");if(g()&&p()){const n=encodeURIComponent(JSON.stringify(e));let i=0;return e.forEach(e=>i+=e.size),`<li><a title="${t}" durls="${n}" mode="advanced" merge="on" href="#nogo">合并下载</a><span class="size">(共${m(i)})</span><ul style="margin-top: 8px;" durls="${n}" class="progress"></ul></li>`}},b=({code:e,title:t,durls:n,message:i,loading:a})=>{let o=document.getElementById("bilibili-helper-host"),s=null;const r=' <svg style="vertical-align: middle" width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-pacman"><g ng-attr-style="display:{{config.showBean}}" style="display:block"><circle cx="62.0973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate></circle><circle cx="82.4973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate></circle><circle cx="42.2973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0s" repeatCount="indefinite"></animate></circle></g><g ng-attr-transform="translate({{config.showBeanOffset}} 0)" transform="translate(-15 0)"><path d="M50 50L20 50A30 30 0 0 0 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path><path d="M50 50L20 50A30 30 0 0 1 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(-10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;-45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path></g></svg>';o?((s=o.shadowRoot).getElementById("title").innerHTML=a?"加载中"+r:u(t,n,e,i),s.getElementById("durls").innerHTML=a?"":f(n,t,e)):((o=document.createElement("bilibili-helper-host")).id="bilibili-helper-host",o.style.cssText=`display:block;overflow:auto;position:fixed;z-index:${Number.MAX_SAFE_INTEGER};bottom:0;left:0;right:0;max-height:50%;width:100%;background: #fff;border-top: 1px solid #ccc;box-shadow: rgba(0, 0, 0, 0.2) 0 -5px 10px;`,h()?o.classList.add("hide"):o.classList.remove("hide"),o.innerHTML="<style>\n        #bilibili-helper-host.hide{\n          width:auto!important;\n          left:auto!important;\n          background:transparent!important;\n          border:0 none!important;\n          border-radius: 6px 0 0 0;\n          box-shadow: rgba(0, 0, 0, 0.2) -5px -5px 10px!important;\n        }\n        .player-fullscreen-fix #bilibili-helper-host {\n          z-index: 99999!important;\n        }\n      </style>",document.body.appendChild(o),(s=o.attachShadow({mode:"open"})).innerHTML=`\n        <style>\n          p, a, div, span, li, i, b, strong, input, button, label {\n            font-size: inherit;\n          }\n          li {\n            margin-bottom: 5px;\n          }\n          p {\n            margin: 0;\n            line-height: 1.5;\n          }\n          h1 {\n            font-size: 20px;\n            font-weight: bold;\n            margin-bottom: 20px;\n          }\n          h3 {\n            font-size: 16px;\n            margin: 1em 0;\n          }\n          #title {\n            font-size: 16px;\n            font-weight: normal;\n          }\n          #content {\n            display: flex;\n            width: 100%;\n            font-size: 14px;\n            position: relative;\n          }\n          a {\n            color: #00a1d6 !important;\n            text-decoration: none;\n          }\n          a:hover {\n            text-decoration: underline;\n          }\n          a.disabled {\n            color: #666!important;\n          }\n          a.disabled:hover {\n            text-decoration: none;\n            cursor: not-allowed;\n          }\n          #side-bar {\n            flex: 3;\n            padding: 20px;\n            border-right: 1px solid #ccc;\n            margin-right: -1px;\n          }\n          #main {\n            flex: 7;\n            padding: 20px;\n            border-left: 1px solid #ccc;\n          }\n          #notice-frame {\n            width: 100%;\n            padding: 0;\n          }\n          .donate {\n            border-top: 1px solid #ccc;\n            padding-top: 10px;\n          }\n          #zanshang {\n            width: 80%;\n          }\n          .setting-item {\n            margin-bottom: 8px;\n          }\n          .setting-item .label {\n            font-weight: bold;\n            width: 6em;\n            display: inline-block;\n            text-align: right;\n          }\n          .desc {\n            padding-left: 6em;\n          }\n          #actions {\n            position: absolute;\n            right: 0;\n            top: 0;\n          }\n          .btn-large {\n            border: 0 none;\n            background: #f45a8d;\n            border-radius: 6px;\n            color: #fff;\n            padding: 10px 20px;\n          }\n          #toggle {\n            border-radius: 0 0 0 6px;\n            outline: none;\n            cursor: pointer;\n          }\n          .hide #side-bar {\n            display: none;\n          }\n          .hide #main {\n            display: none;\n          }\n          .hide #toggle {\n            border-radius: 6px 0 0 0;\n          }\n          .hide #actions {\n            position: static;\n          }\n      \n          a.btn {\n            border: 0 none;\n            background: #f45a8d;\n            text-decoration: none !important;\n            color: #fff !important;\n            border-radius: 3px;\n            padding: 5px 10px;\n            display: inline-block;\n          }\n          .settings {\n            border-left: 5px solid #ccc;\n            background: #eee;\n            padding: 16px 16px 8px 0;\n          }\n          .size {\n            margin: 0 5px;\n          }\n        </style>\n        <div id="content" ${h()?'class="hide"':""}>\n          <div id="side-bar">\n            <div class="notice">\n              <iframe id="notice-frame" frameborder="0"></iframe>\n            </div>\n            \x3c!--<div class="support">TODO 支持区域</div>--\x3e\n            <div class="donate">\n              <p>微信扫一扫赞赏作者(扫不出来请点击图片后扫大图)：</p>\n              <a href="${internalUrls.zanshang}" target="_blank"><img title="点击查看大图" alt="点击查看大图" id="zanshang" src="${internalUrls.zanshang}"/></a>\n            </div>\n          </div>\n          <div id="main">\n            <h1 style="margin-top: 0;">B站下载助手</h1>\n            <div class="settings">\n              <div class="setting-item">\n                <span class="label">清晰度：</span>\n                <span>请在页面中B站自己的播放器内切换清晰度</span>\n              </div>\n              <div class="setting-item">\n                <span class="label">下载模式：</span>\n                <label><input id="setting-download-mode-advanced" checked name="setting-download-mode" type="radio"/> 高级</label>\n                <label><input id="setting-download-mode-normal" name="setting-download-mode" type="radio"/> 兼容</label>\n                <p class="desc">高级模式支持自动重命名和合并下载，但会占用非常大的系统运行内存<br/>兼容模式直接使用浏览器的默认下载，资源占用很小，但不支持自动重命名和合并下载</p>\n                <p class="desc">建议系统运行内存小于16G的用户使用兼容模式，下载后可以点<a href="http://csser.top/bilibili/merge.html" target="_blank">这里</a>尝试手动合并</p>\n              </div>\n              <div class="setting-item" id="setting-advanced">\n                <span class="label">合并下载：</span>\n                <label><input id="setting-merge-on" checked name="setting-merge" type="radio"> 开</label>\n                <label><input id="setting-merge-off" name="setting-merge" type="radio"> 关</label>\n                <p class="desc">高级模式下载过程中请<strong style="color: red;">不要</strong>刷新或关闭页面，也<strong style="color: red;">不要</strong>切换分集和清晰度</p>\n              </div>\n            </div>\n            <h3 id="title">${a?"加载中"+r:u(t,n,e,i)}</h3>\n            <ul id="durls">\n              ${a?"":f(n,t,e)}\n            </ul>\n            <div class="beg">\n              <p>\n                如果这个工具确实帮到了您，烦请在Chrome商店给个五星好评，谢谢😊\n                <a class="btn" href="https://chrome.google.com/webstore/detail/bfcbfobhcjbkilcbehlnlchiinokiijp/reviews" target="_blank">去评价</a>\n              </p>\n            </div>\n          </div>\n          <div id="actions">\n            <button id="toggle" class="btn-large">${h()?"打开B站下载助手":"收起"}</button>\n          </div>\n        </div>\n      `,(e=>{const t=e.getElementById("setting-download-mode-advanced"),n=e.getElementById("setting-download-mode-normal"),i=e.getElementById("setting-merge-on"),a=e.getElementById("setting-merge-off"),o=e.getElementById("setting-advanced"),s=e.getElementById("durls"),r=e.getElementById("toggle"),l=e.getElementById("actions"),d=e.getElementById("content"),c=document.getElementById("bilibili-helper-host"),m=()=>{t.disabled=!0,n.disabled=!0,i.disabled=!0,a.disabled=!0},u=()=>{t.disabled=!1,n.disabled=!1,i.disabled=!1,a.disabled=!1};g()?(t.checked=!0,n.checked=!1,o.style.display="block"):(t.checked=!1,n.checked=!0,o.style.display="none"),p()?(i.checked=!0,a.checked=!1):(i.checked=!1,a.checked=!0);const f=()=>{e.buildDownloadLinks()};t.addEventListener("change",()=>{t.checked?(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"):(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"),f()}),n.addEventListener("change",()=>{n.checked?(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"):(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"),f()}),i.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=i.checked?"on":"off",f()}),a.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=a.checked?"off":"on",f()}),s.addEventListener("click",t=>{const n=t.target;if("a"===n.tagName.toLowerCase()&&"advanced"===n.getAttribute("mode")){if(t.preventDefault(),t.stopPropagation(),n.classList.contains("disabled"))return;let i=null;const a=n.getAttribute("title");"on"===n.getAttribute("merge")?(i=e.querySelector(`ul[durls="${n.getAttribute("durls")}"]`),m(),x(n,JSON.parse(decodeURIComponent(n.getAttribute("durls"))),a,i).then(u)):(i=e.querySelector(`span[durl="${n.getAttribute("durl")}"]`),m(),v(n,JSON.parse(decodeURIComponent(n.getAttribute("durl"))),a,i).then(u))}}),r.addEventListener("click",()=>{h()?(localStorage.bilibili_helper_show="show",d.classList.remove("hide"),r.innerHTML="收起",c.classList.remove("hide"),l.style.top="0",e.getElementById("notice-frame").contentWindow.postMessage({action:"getHeight"},"https://csser.top")):(localStorage.bilibili_helper_show="hide",d.classList.add("hide"),c.classList.add("hide"),r.innerHTML="打开B站下载助手",l.style.top="0")}),c.addEventListener("scroll",()=>{l.style.top=c.scrollTop+"px"})})(s),(e=>{const t=e.getElementById("notice-frame");t.onload=(()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top"),t.contentWindow.postMessage({action:"setVersion",version:{name:manifest.version,code:parseInt(manifest.version.replace(/\./g,""),10)}},"https://csser.top"),t.contentWindow.postMessage({action:"setTheme",theme:"null"},"https://csser.top")}),window.addEventListener("message",e=>{if("https://csser.top"===e.origin&&e.data&&"reportHeight"===e.data.action&&(t.style.height=e.data.height+10+"px"),"https://csser.top"===e.origin&&e.data&&"showBilibilihelperindooorsmanNoticeDialog"===e.data.action){const t=e.data.notices;t&&t.length>0&&t.forEach(e=>{})}}),t.src=`https://csser.top/bilibili/notice.html?t=${Date.now()}`,window.addEventListener("resize",()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top")})})(s)),s.buildDownloadLinks=(()=>{s.getElementById("durls").innerHTML=f(n,t,e)})},y=(e,t)=>{const n=new Blob([e],{type:"application/octet-stream"}),i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(n)),i.setAttribute("download",t),i.setAttribute("style","position:absolute;top:-9999px;"),document.body.appendChild(i);const a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});i.dispatchEvent(a),setTimeout(()=>{document.body.removeChild(i)},1e3)},w=(e,t,n)=>{let i=null;return fetch(e).then(e=>{const a=e.headers.get("content-length"),o=t||parseInt(a,10);let s=0;return i=setInterval(()=>{n(s,o)},1e3),new Response(new ReadableStream({start(t){const n=e.body.getReader(),i=()=>{n.read().then(({done:e,value:n})=>{e?t.close():(s+=n.byteLength,t.enqueue(n),i())}).catch(e=>{t.error(e)})};i()}}))}).then(e=>e.blob()).finally(()=>{i&&clearInterval(i)})},v=(e,{url:t,size:n},i,a)=>(e.classList.add("disabled"),w(t,n,(e,t)=>{const n=Math.ceil(e/t*100);a.innerHTML=` 正在下载 - ${e}/${t} - ${n}%`}).then(e=>{a.innerHTML=" 已下载完成";const n=new URL(t).pathname.toLowerCase().match(/\.[a-z0-9]+?$/)[0];y(e,i+n)}).finally(()=>{e.classList.remove("disabled")})),x=(e,t,n,i)=>{if(1===t.length)return v(e,t[0],n,i);e.classList.add("disabled");const a=t.map(({url:e,size:t},n)=>{const a=document.createElement("li");return a.innerHTML=`分段${n+1} (${m(t)}) 正在下载`,i.appendChild(a),w(e,t,(e,i)=>{const o=Math.ceil(e/i*100);a.innerHTML=`分段${n+1} (${m(t)}) 正在下载 - ${e}/${i} - ${o}%`}).then(e=>(a.innerHTML=`分段${n+1} (${m(t)}) 已下载完成，等待合并`,e))});return Promise.all(a).then(async e=>{const t=await o.mergeBlobs(Array.from(e));y(t,n+".flv"),i.innerHTML="已完成"}).finally(()=>{e.classList.remove("disabled")})},_=async()=>{if(!e())return;b({loading:!0});const i=await(()=>fetch(window.location.href,r).then(e=>e.text()).then(e=>{const t=e.match(/<script>window.__INITIAL_STATE__=(.+?)<\/script>/);return t&&t[1]?JSON.parse(t[1].replace(";(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());","")):{code:-2,message:"获取视频信息失败，可以尝试清除浏览器cookies和缓存后重试，如多次重试仍然报错，请通过邮箱或QQ群反馈给我，谢谢"}}).catch(()=>l()))();if(i.code)return b(i);let a=localStorage.bilibili_player_settings&&+JSON.parse(localStorage.bilibili_player_settings).setting_config.defquality||112;if(t()){const e=i.videoData.aid;let t,n,o=i.videoData.cid;if(i.videoData.pages.length>1){const e=location.search.match(/p=(\d+)/);let a=i.videoData.pages[0];e&&e[1]&&(a=i.videoData.pages.find(t=>""+t.page==""+e[1])),t=a.page,n=a.part,o=a.cid}const{code:s,durls:c,qualityDescription:g,message:p}=await((e,t,n=112)=>{return fetch(`//api.bilibili.com/x/player/playurl?cid=${t}&avid=${e}&otype=json&qn=${n}`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.data)).catch(()=>l())})(e,o,a);if(0===s){let e=`[${g}] ${i.videoData.title}`;t&&n&&(e=`[${g}] ${i.videoData.title}_P${t}_${n}`),b({code:s,title:e,durls:c,message:p})}else b({code:s,message:p})}if(n()){const e=i.epList;let t=-1===i.epId?e[e.length-1].ep_id:i.epId,n=e.find(e=>t===e.ep_id);const o=await s(".episode-item.on"),c=await s(".ep-item.cursor");if(o||c){const i=o||c,a=i.parentElement;let r=Array.from(a.querySelectorAll("li")).findIndex(e=>e===i);const l=await s("#eplist_module .ep-list-progress");l&&(r=+l.textContent.match(/(\d+)\/\d+/)[1]-1),n=e[r],t=n.ep_id||n.id}const{code:g,durls:p,qualityDescription:h,message:m}=await((e,t=112)=>{return fetch(`//api.bilibili.com/pgc/player/web/playurl/?ep_id=${e}&qn=${t}&bsource=`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.result)).catch(()=>l())})(t,a);if(0===g){const e=`[${h}] ${i.mediaInfo.title}_${n.index||n.title}_${n.index_title||n.longTitle}`;b({code:g,title:e,durls:p,message:m})}else b({code:g,message:m})}};_();let $=""+window.location.href,L=""+localStorage.bilibili_player_settings;setInterval(()=>{const e=window.location.href,t=localStorage.bilibili_player_settings;if($!==e&&($=e,_()),L!==t)try{if(JSON.parse(t).setting_config.defquality===JSON.parse(L).setting_config.defquality)return;L=t,_()}catch(e){}},1e3)})();</script></head>
<body>
<div align="center">
<table width="100%" border="0">
<tbody><tr valign="top">
<td align="left" width="25%">
  <span class="tiny"><a href="http://www.cse.unsw.edu.au/~cs3311">COMP3311 19s1</a></span>
</td>
<td align="center" width="50%">
  <span class="heading">Exercises 08</span><br>
  <span class="subheading">Relational Algebra</span>
</td>
<td align="right" width="25%">
  <span class="tiny"><a href="http://www.cse.unsw.edu.au/~cs3311">Database Systems</a></span>
</td>
</tr></tbody></table>
</div><p style="text-align:center;font-size:75%"><a href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php?view=qo">[Show with no answers]</a> &nbsp; <a href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php?view=all">[Show with all answers]</a>

<br>
</p><center>
<table width="80%" border="1" cellpadding="6"><tbody><tr>
<td style="font-size:75%">
<p>
<b>Notation:</b> in the relational schemas below,
primary key attributes are shown in &nbsp; <code><b>bold</b></code> &nbsp; font,
foreign key attributes are shown in &nbsp; <code><i>italic</i></code> &nbsp; font,
and primary key attributes that are also foreign keys are
shown in &nbsp; <code><b><i>bold italic</i></b></code> &nbsp; font.
</p>
Example:
<pre>   Student(<u>id</u>, name, <i>degreeCode</i>)
   Degree(<u>code</u>, name, requirements)
   Subject(<u>code</u>, name, syllabus)
   Marks(<i><u>studentId</u></i>, <i><u>subjectCode</u></i>, <u>session</u>, mark)
</pre>
<p>
In their respective relations, the student id, the degree code
and the subject code are primary keys.
In the Student relation, the degree code is a foreign key.
In the Marks relation, the three attributes student id, subject
code and session together form the primary key; the first two
(student id and subject code) are also foreign keys.
</p>
</td></tr></tbody></table>
</center>

<ol>

<li>
<p>
Relational algebra operators can be <i>composed</i>.
What precisely does this mean? And why is it important?
</p>
<p><small>[<a id="q1a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q1&#39;)">show answer</a>]</small></p>
<div id="q1" style="color:#000099;display:none">
<p>
Composition means that the result of one operator can be used as an argument
for some other operator.
Since most relational algebra operators take relations as inputs and produce
relations as results, they can be composed.
It is important because it allows us to build arbitrarily complex relational
algebra expressions to answer arbitrarily complex queries (i.e. we can build
answers to complex queries from answers to simple queries).
</p><p>
Note that we often find it clearer to express complex queries as a
sequence of simple queries which are <q>assigned</q> to named
intermediate relations, rather than as deeply nested expressions. 
</p>
</div>

</li><li>
<p>
The natural join ( <i>R</i> Join <i>S</i> ) joins two tables on
their common attributes.
Consider a theta-join ( <i>R</i> Join[<i>C</i>] <i>S</i> ) where
the join condition <i>C</i> is a conjunction of <i>R.A</i> = <i>S.A</i>
for each attribute <i>A</i> appearing in the schemas of both <i>R</i>
and <i>S</i> (i.e. it joins on the common attributes).
What is the difference between the above natural join and theta join?
</p>
<p><small>[<a id="q2a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q2&#39;)">show answer</a>]</small></p>
<div id="q2" style="color:#000099;display:none">
<p>
The relation that results from the natural join has only one attribute
from each pair of matching attributes. The theta-join has attributes for
both, and their columns are identical. 
Both joins result in a relation with the same number of tuples.
</p>
</div>

</li><li>
<p>
The definition of relational algebra in lectures was based on <em>sets</em>
of tuples. In practice, commercial relational database management systems
deal with <em>bags</em> (or <em>multisets</em>) of tuples.
</p><p>
Consider the following relation that describes a collection of PCs
</p><p>
</p><center>
<b>PCs</b>
<table border="1" cellpadding="4">
<tbody><tr><th>Model</th><th>Speed</th><th>RAM</th><th>Disk</th><th>Price</th></tr><tr>
</tr><tr><td>1001</td><td>700</td><td>64</td><td>10</td><td>799</td></tr>
<tr><td>1002</td><td>1500</td><td>128</td><td>60</td><td>2499</td></tr>
<tr><td>1003</td><td>1000</td><td>128</td><td>20</td><td>1499</td></tr>
<tr><td>1004</td><td>1000</td><td>256</td><td>40</td><td>1999</td></tr>
<tr><td>1005</td><td>700</td><td>64</td><td>30</td><td>999</td></tr>
</tbody></table>
</center>
<p>
Consider a projection of this relation on the processor speed
attribute, i.e. <code>Proj[speed](PCs)</code>.
</p><ol type="a">
<li> What is the value of the projection as a set?
</li><li> What is the value of the projection as a bag?
</li><li> What is the average speed if the projection is a set?
</li><li> What is the average speed if the projection is a bag?
</li><li> Is the minimum/maximum speed different between the bag and set representation?
</li></ol>
<p></p>
<p><small>[<a id="q3a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q3&#39;)">show answer</a>]</small></p>
<div id="q3" style="color:#000099;display:none">
<p>
</p><ol type="a">
<li> {700, 1000, 1500}
</li><li> {700, 700, 1000, 1000, 1500}
</li><li> (700+1000+1500)/3 = 1067
</li><li> (700+700+1000+1000+1500)/5 = 980
</li><li> No. Unlike the average value, the minimum and maximum values
are not affected by repetitions.
</li></ol>
</div>

</li><li>
<p>
Consider the following two relations:
</p><p>
</p><center>
<table border="0" cellpadding="10">
<tbody><tr>
<td valign="top" align="center">
   <b>R</b>
   <table border="1" cellpadding="4">
   <tbody><tr><th>A</th><th>B</th><th>C</th></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td></tr>
   </tbody></table>
</td>
<td> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </td>
<td valign="top" align="center">
   <b>S</b>
   <table border="1" cellpadding="4">
   <tbody><tr><th>B</th><th>C</th></tr>
   <tr><td>b1</td><td>c1</td></tr>
   <tr><td>b2</td><td>c2</td></tr>
   </tbody></table>
</td>
</tr>
</tbody></table>
</center>
<p>
Give the relation that results from each of the following
relational algebra expressions on these relations:
</p>

<ol type="a">
<li>
<p>
<i>R</i> Div <i>S</i>
</p>
<p><small>[<a id="q4a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q4&#39;)">show answer</a>]</small></p>
<div id="q4" style="color:#000099;display:none">
<p>
<table cellpadding="6">
<tbody><tr valign="top">
 <td><i>R</i> Div <i>S</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>A</th></tr>
   <tr><td>a1</td></tr>
   </tbody></table>
 </td>
</tr></tbody></table>
</p></div>
</li><li>
<p>
<i>R</i> Div (Sel[B != b1](<i>S</i>))
</p>
<p><small>[<a id="q5a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q5&#39;)">show answer</a>]</small></p>
<div id="q5" style="color:#000099;display:none">
<p>
<table cellpadding="6">
<tbody><tr valign="top">
 <td><i>Tmp1</i> = Sel[B != b1](<i>S</i>)</td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>B</th><th>C</th></tr>
   <tr><td>b2</td><td>c2</td></tr>
   </tbody></table>
 </td>
</tr>
<tr valign="top">
 <td><i>R</i> Div <i>Tmp1</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>A</th></tr>
   <tr><td>a1</td></tr>
   </tbody></table>
 </td>
</tr>
</tbody></table>
</p></div>
</li><li>
<p>
<i>R</i> Div (Sel[B != b2](<i>S</i>))
</p>
<p><small>[<a id="q6a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q6&#39;)">show answer</a>]</small></p>
<div id="q6" style="color:#000099;display:none">
<p>
<table cellpadding="6">
<tbody><tr valign="top">
 <td><i>Tmp1</i> = Sel[B != b2](<i>S</i>)</td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>B</th><th>C</th></tr>
   <tr><td>b1</td><td>c1</td></tr>
   </tbody></table>
 </td>
</tr>
<tr valign="top">
 <td><i>R</i> Div <i>Tmp1</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>A</th></tr>
   <tr><td>a1</td></tr>
   <tr><td>a2</td></tr>
   </tbody></table>
 </td>
</tr>
</tbody></table>
</p></div>
</li><li>
<p>
<i>R</i> × <i>S</i>) - (Sel[R.C=S.C](<i>R</i> Join[B=B] <i>S</i>)
</p>
<p><small>[<a id="q7a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q7&#39;)">show answer</a>]</small></p>
<div id="q7" style="color:#000099;display:none">
<p>
<table cellpadding="6">
<tbody><tr valign="top">
 <td><i>Tmp1</i> = <i>R</i> Join[R.B=S.B] <i>S</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>R.A</th><th>R.B</th><th>R.C</th><th>S.B</th><th>S.C</th></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td><td>b2</td><td>c2</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   </tbody></table>
 </td>
</tr>
<tr valign="top">
 <td><i>Tmp2</i> = Sel[R.C=S.C](<i>Tmp1</i>)</td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>R.A</th><th>R.B</th><th>R.C</th><th>S.B</th><th>S.C</th></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td><td>b2</td><td>c2</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   </tbody></table>
 </td>
</tr>
<tr valign="top">
 <td><i>Tmp3</i> = <i>R</i> × <i>S</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>R.A</th><th>R.B</th><th>R.C</th><th>S.B</th><th>S.C</th></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td><td>b2</td><td>c2</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td><td>b1</td><td>c1</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td><td>b2</td><td>c2</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td><td>b1</td><td>c1</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td><td>b2</td><td>c2</td></tr>
   </tbody></table>
 </td>
</tr>
<tr valign="top">
 <td><i>Tmp3</i> - <i>Tmp2</i></td><td>=</td>
 <td>
   <table border="1" cellpadding="5">
   <tbody><tr><th>R.A</th><th>R.B</th><th>R.C</th><th>S.B</th><th>S.C</th></tr>
   <tr><td>a1</td><td>b1</td><td>c1</td><td>b2</td><td>c2</td></tr>
   <tr><td>a1</td><td>b2</td><td>c2</td><td>b1</td><td>c1</td></tr>
   <tr><td>a2</td><td>b1</td><td>c1</td><td>b2</td><td>c2</td></tr>
   </tbody></table>
 </td>
</tr>
</tbody></table>
</p></div>
</li></ol>

</li><li>
<p>
Consider two relations <i>R1</i> and <i>R2</i>, where <i>R1</i> contains
<i>N1</i> tuples and <i>R2</i> contains <i>N2</i> tuples, and 
<i>N1</i> &gt; <i>N2</i> &gt; 0.
Give the minimum and maximum possible sizes (in tuples) for the
result relation produced by each of the following relational algebra
expressions.
In each case state any assumptions about the schemas of <i>R1</i> and
<i>R2</i> that are needed to make the expression meaningful.
</p><p>
</p><ol type="a">
<li> <i>R1</i> Union <i>R2</i>
</li><li> <i>R1</i> Intersect <i>R2</i>
</li><li> <i>R1</i> - <i>R2</i>
</li><li> <i>R1</i> × <i>R2</i>
</li><li> Sel<small>[a=5]</small>(<i>R1</i>)
</li><li> Proj<small>[a]</small>(<i>R1</i>)
</li><li> <i>R1</i> Div <i>R2</i>
</li></ol>
<p></p>
<p><small>[<a id="q8a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q8&#39;)">show answer</a>]</small></p>
<div id="q8" style="color:#000099;display:none">
<p>
</p><center>
<table border="1" cellpadding="10">
<tbody><tr>
  <td><b>Expression</b></td>
  <td><b>Assumptions</b></td>
  <td><b>Min</b></td>
  <td><b>Max</b></td>
</tr>
<tr>
  <td><i>R1</i> Union <i>R2</i></td>
  <td><i>R1</i> and <i>R2</i> are union-compatible</td>
  <td><i>N1</i> <br> (when <i>R2⊂R1</i>)</td>
  <td><i>N1+N2</i> <br> (when <i>R1∩R2=∅</i>)</td>
</tr>
<tr>
  <td><i>R1</i> Intersect <i>R2</i></td>
  <td><i>R1</i> and <i>R2</i> are union-compatible</td>
  <td><i>0</i> <br> (when <i>R1∩R2=∅</i>)</td>
  <td><i><i>N2</i> <br> (when <i>R2⊂R1</i>) </i></td>
</tr>
<tr>
  <td><i>R1</i> - <i>R2</i></td>
  <td><i>R1</i> and <i>R2</i> are union-compatible</td>
  <td><i>N1-N2</i> <br> (when <i>R2∩R1=R2</i>)</td>
  <td><i>N1</i> <br> (when <i>R1∩R2=∅</i>)</td>
</tr>
<tr>
  <td><i>R1</i> × <i>R2</i></td>
  <td>None</td>
  <td><i>N1*N2</i></td>
  <td><i>N1*N2</i></td>
</tr>
<tr>
  <td>Sel<small>[a=5]</small>(<i>R1</i>)</td>
  <td><i>R1</i> has an attribute <i>a</i></td>
  <td><i>0</i> <br> (no matches)</td>
  <td><i>N1</i> <br> (all match)</td>
</tr>
<tr>
  <td>Proj<small>[a]</small>(<i>R1</i>)</td>
  <td><i>R1</i> has an attribute <i>a</i>, <i>N1 &gt; 0</i></td>
  <td><i>1</i></td>
  <td><i>N1</i></td>
</tr>
<tr>
  <td><i>R1</i> Div <i>R2</i></td>
  <td>The set of <i>R2</i>'s attributes is <br> a subset of <i>R1</i>'s attributes</td>
  <td><i>0</i></td>
  <td><i>floor(N1/N2)</i></td>
</tr>
</tbody></table>
</center>
</div>

</li><li>
<p>
<small>(Date, exercise 6.11)</small>
Let <i>A</i> and <i>B</i> be two arbitrary relations.
In terms of the keys of <i>A</i> and <i>B</i>, state
the keys for each of the following RA expressions.
Assume in each case that <i>A</i> and <i>B</i> meet the requirements
of the operation (e.g. they are union-compatible for the Union and
Intersect operations).
</p>

<ol type="a">
<li>
<p>
Sel<small>[<i>cond</i>]</small>(<i>A</i>),
	&nbsp;  where <i>cond</i> is any condition
</p>
<p><small>[<a id="q9a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q9&#39;)">show answer</a>]</small></p>
<div id="q9" style="color:#000099;display:none">
<p>
Any subset of <i>A</i> inherits all of the candidate keys for <i>A</i>
</p>
</div>
</li><li>
<p>
Proj<small>[<i>attrs</i>]</small>(<i>A</i>), 
	&nbsp; where <i>attrs</i> is any set of atributes
</p>
<p><small>[<a id="q10a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q10&#39;)">show answer</a>]</small></p>
<div id="q10" style="color:#000099;display:none">
<p>
If the projection includes any candidate key <i>K</i> of <i>A</i>,
then <i>K</i> is a candidate key for the projection. Otherwise, the
only candidate key is the combination of all projected attributes.
</p>
</div>
</li><li>
<p>
<i>A</i> × <i>B</i>
</p>
<p><small>[<a id="q11a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q11&#39;)">show answer</a>]</small></p>
<div id="q11" style="color:#000099;display:none">
<p>
Every combination of a candidate key <i>KA</i> for <i>A</i> and
a candidate key <i>KB</i> for <i>B</i> is a candidate key for
the product.
</p>
</div>
</li><li>
<p>
<i>A</i> Union <i>B</i>
</p>
<p><small>[<a id="q12a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q12&#39;)">show answer</a>]</small></p>
<div id="q12" style="color:#000099;display:none">
<p>
Even if two relations are union-compatible, it doesn't mean that
they share the same candidate keys, so in the general case, the
only candidate key for a union is the set of all attributes.
In the special case where <i>A</i> and <i>B</i> are selections
from the same relation, the candidate keys for the union would
the the same as the candidate keys for the underlying relation.
</p>
</div>
</li><li>
<p>
<i>A</i> Intersect <i>B</i>
</p>
<p><small>[<a id="q13a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q13&#39;)">show answer</a>]</small></p>
<div id="q13" style="color:#000099;display:none">
<p>
Same considerations as for Union.
</p>
</div>
</li><li>
<p>
<i>A</i> - <i>B</i>
</p>
<p><small>[<a id="q14a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q14&#39;)">show answer</a>]</small></p>
<div id="q14" style="color:#000099;display:none">
<p>
Every candidate key for <i>A</i> is a candidate key for the
difference (could be viewed as a special kind of selection
from <i>A</i>).
</p>
</div>
</li><li>
<p>
<i>A</i> Div <i>B</i>
</p>
<p><small>[<a id="q15a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q15&#39;)">show answer</a>]</small></p>
<div id="q15" style="color:#000099;display:none">
<p>
Ultimately, division is like a selection followed by projection
on the original table.
Similar considerations would apply as for projection.
</p>
</div>
</li></ol>

</li><li>
<p>Consider the following relational schema:</p>
<pre>   Suppliers(<b>sid</b>, sname, address)
   Parts(<b>pid</b>, pname, colour)
   Catalog(<b><i>supplier</i></b>, <b><i>part</i></b>, cost)
</pre>
<p>
Assume that the ids are integers,
that <code>cost</code> is a real number,
that all other attributes are strings,
that the <code><b><i>supplier</i></b></code> field 
is a foreign key containing a supplier id,
and
that the <b><i>part</i></b> field is a foreign key
containing a part id.
Write a relational algebra expression to answer each
of the following queries:
</p>
<ol type="a">
<li>
<p>
Find the <i>names</i> of suppliers who supply some red part.
</p>
<p><small>[<a id="q16a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q16&#39;)">show answer</a>]</small></p>
<div id="q16" style="color:#000099;display:none">
<p>
</p><pre>RedPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red']</small>(Parts))
RedPartSupplierIds = Rename<small>[sid]</small>(Proj<small>[supplier]</small>(RedPartIds Join Catalog))
Answer = Proj<small>[sname]</small>(RedPartSupplierIds Join Suppliers)
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply some red or green part.
</p>
<p><small>[<a id="q17a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q17&#39;)">show answer</a>]</small></p>
<div id="q17" style="color:#000099;display:none">
<p>
</p><pre>RedGreenPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red' OR colour='green']</small>(Parts))
Answer = Proj<small>[sid]</small>(RedGreenPartIds Join Catalog)
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply some red part or
whose address is 221 Packer Street.
</p>
<p><small>[<a id="q18a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q18&#39;)">show answer</a>]</small></p>
<div id="q18" style="color:#000099;display:none">
<p>
</p><pre>RedPartIds = Rename[RedPartIds(part)](Proj<small>[pid]</small>(Sel<small>[colour='red']</small>(Parts)))
RedPartSupplierIds = Rename[RedPartSupplierIds(sid)](Proj<small>[supplier]</small>(RedPartIds Join Catalog))
PackerStSupplierIds = Proj<small>[sid]</small>(Sel<small>[address='221 Packer Street']</small>(Suppliers))
Answer = RedPartSupplierIds Union PackerStSupplierIds
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply some red part and some green part.
</p>
<p><small>[<a id="q19a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q19&#39;)">show answer</a>]</small></p>
<div id="q19" style="color:#000099;display:none">
<p>
</p><pre>RedPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red']</small>(Parts))
RedPartSupplierIds = Proj<small>[sid]</small>(RedPartIds Join Catalog)
GreenPartIds = Proj<small>[pid]</small>(Sel<small>[colour='green']</small>(Parts))
GreenPartSupplierIds = Proj<small>[sid]</small>(GreenPartIds Join Catalog)
Answer = RedPartSupplierIds &nbsp; Intersect &nbsp; GreenPartSupplierIds
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply every part.
</p>
<p><small>[<a id="q20a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q20&#39;)">show answer</a>]</small></p>
<div id="q20" style="color:#000099;display:none">
<p>
</p><pre>AllPartIds = Proj<small>[pid]</small>(Parts)
PartSuppliers = Proj<small>[sid,pid]</small>(Catalog)
Answer = PartSuppliers Div AllPartIds
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply every red part.
</p>
<p><small>[<a id="q21a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q21&#39;)">show answer</a>]</small></p>
<div id="q21" style="color:#000099;display:none">
<p>
</p><pre>RedPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red']</small>(Parts))
PartSuppliers = Proj<small>[sid,pid]</small>(Catalog)
Answer = PartSuppliers Div RedPartIds
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply every red or green part.
</p>
<p><small>[<a id="q22a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q22&#39;)">show answer</a>]</small></p>
<div id="q22" style="color:#000099;display:none">
<p>
</p><pre>RedGreenPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red' OR colour='green']</small>(Parts))
Answer = PartSuppliers Div RedGreenPartIds
</pre>
</div>
</li><li>
<p>
Find the <i>sids</i> of suppliers who supply every red part
or supply every green part.
</p>
<p><small>[<a id="q23a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q23&#39;)">show answer</a>]</small></p>
<div id="q23" style="color:#000099;display:none">
<p>
</p><pre>RedPartIds = Proj<small>[pid]</small>(Sel<small>[colour='red']</small>(Parts))
GreenPartIds = Proj<small>[pid]</small>(Sel<small>[colour='green']</small>(Parts))
PartSuppliers = Proj<small>[sid,pid]</small>(Catalog)
AllRedPartSuppliers = PartSuppliers Div RedPartIds
AllGreenPartSuppliers = PartSuppliers Div GreenPartIds
Answer = AllRedPartSuppliers Union AllGreenPartSuppliers
</pre>
</div>
</li><li>
<p>
Find the <i>pids</i> of parts that are supplied by at least two
different suppliers.
</p>
<p><small>[<a id="q24a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q24&#39;)">show answer</a>]</small></p>
<div id="q24" style="color:#000099;display:none">
<p>
</p><pre>C1 = Catalog
C2 = Catalog
SupplierPartPairs = Sel<small>[C1.sid!=C2.sid]</small>(C1 Join<small>[pid]</small> C2)
Answer = Proj<small>[C1.pid]</small>(SupplierPartPairs)
</pre>
</div>
</li><li>
<p>
Find pairs of <i>sids</i> such that the supplier with the first <i>sid</i>
charges more for some part than the supplier with the second sid.
</p>
<p><small>[<a id="q25a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q25&#39;)">show answer</a>]</small></p>
<div id="q25" style="color:#000099;display:none">
<p>
</p><pre>C1 = Catalog
C2 = Catalog
SupplierPartPairs = Sel<small>[C1.sid!=C2.sid AND C1.cost&gt;C2.cost]</small>(C1 Join<small>[pid]</small> C2)
Answer = Proj<small>[C1.sid,C2.sid]</small>(SupplierPartPairs)
</pre>
</div>
</li><li>
<p>
Find the <i>pids</i> of the most expensive part(s) supplied by suppliers
named "Yosemite Sham".
</p>
<p><small>[<a id="q26a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q26&#39;)">show answer</a>]</small></p>
<div id="q26" style="color:#000099;display:none">
<p>
</p><pre>R1 = Proj<small>[sid,pid,cost]</small>(Sel<small>[name='Yosemite Sham']</small>(Suppliers Join Catalog))
R2 = R1
R3 = Rename<small>[1-&gt;sid,2-&gt;pid,3-&gt;cost]</small>(Sel<small>[R2.cost&lt;R1.cost]</small>(R1 × R2))
Answer = Proj<small>[pid]</small>(R2 Minus Proj<small>[sid,pid,cost]</small>(R3))
</pre>
</div>
</li><li>
<p>
Find the <i>pids</i> of parts supplied by every supplier at a price less
than 200 dollars (if any supplier either does not supply the part or charges
more than 200 dollars for it, the part should not be selected).
</p>
<p><small>[<a id="q27a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q27&#39;)">show answer</a>]</small></p>
<div id="q27" style="color:#000099;display:none">
<p>
</p><pre>CheapParts = Sel<small>[cost&lt;200]</small>(Catalog)
AllSuppliers = Proj<small>[sid]</small>(Suppliers)
Answer = Proj<small>[part,supplier]</small>(CheapParts Div AllSuppliers)
</pre>
</div>
</li></ol>

</li><li>
<p>
Using the Suppliers-Parts-Catalog schema from the previous question,
state what the following relational algebra expressions compute:
</p>
<ol type="a">
<li>
<pre>Proj<small>[sname]</small>(
	Proj<small>[sid]</small>(Sel<small>[colour='red']</small>(Parts))
	Join
	Sel<small>[cost&lt;100]</small>(Catalog)
	Join
	Suppliers
)
</pre>
<p><small>[<a id="q28a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q28&#39;)">show answer</a>]</small></p>
<div id="q28" style="color:#000099;display:none">
<p>
Finds the names of all suppliers who supply red parts that cost less than $100.
</p>
</div>
</li><li>
<pre>Proj<small>[sname]</small>(
	Proj<small>[sid]</small>(
		Sel<small>[colour='red']</small>(Parts)
		Join
		Sel<small>[cost&lt;100]</small>(Catalog)
		Join
		Suppliers
	)
)
</pre>
<p><small>[<a id="q29a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q29&#39;)">show answer</a>]</small></p>
<div id="q29" style="color:#000099;display:none">
<p>
Produces nothing, because there is no <tt>sname</tt> field left to job
after the <tt>Proj<small>[sid]</small></tt>.
</p>
</div>
</li><li>
<pre>Proj<small>[sname]</small>(
	Sel<small>[colour='red']</small>(Parts)
	Join
	Sel<small>[cost&lt;100]</small>(Catalog)
	Join
	Suppliers
)
Intersect
Proj<small>[sname]</small>(
	Sel<small>[colour='green']</small>(Parts)
	Join
	Sel<small>[cost&lt;100]</small>(Catalog)
	Join
	Suppliers
)
</pre>
<p><small>[<a id="q30a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q30&#39;)">show answer</a>]</small></p>
<div id="q30" style="color:#000099;display:none">
<p>
Finds the names of all suppliers who supply both red and green parts
that cost less than $100.
</p>
</div>
</li><li>
<pre>Proj<small>[sid]</small>(
	Sel<small>[colour='red']</small>(Parts)
	Join
	Sel<small>[cost&lt;100]</small>(Catalog)
	Join
	Suppliers
)
Intersect
Proj<small>[sid]</small>(
	Sel<small>[colour='green']</small>(Parts)
	Join
	Sel<small>[cost&lt;100]</small>(Catalog)
	Join
	Suppliers
)
</pre>
<p><small>[<a id="q31a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q31&#39;)">show answer</a>]</small></p>
<div id="q31" style="color:#000099;display:none">
<p>
Finds the sids of all suppliers who supply both red and green parts
that cost less than $100.
</p>
</div>
</li><li>
<pre>Proj<small>[sid,sname]</small>(
	Proj<small>[sid,sname]</small>(
		Sel<small>[colour='red']</small>(Parts)
		Join
		Sel<small>[cost&lt;100]</small>(Catalog)
		Join
		Suppliers
	)
	Intersect
	Proj<small>[sid,sname]</small>(
		Sel<small>[colour='green']</small>(Parts)
		Join
		Sel<small>[cost&lt;100]</small>(Catalog)
		Join
		Suppliers
	)
)
</pre>
<p><small>[<a id="q32a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q32&#39;)">show answer</a>]</small></p>
<div id="q32" style="color:#000099;display:none">
<p>
Finds the names and sids of all suppliers who supply
both red and green parts that cost less than $100.
The outermost projection is completely redundant.
</p>
</div>
</li></ol>

</li><li>
<p>
Consider the following relational schema containing flight, aircraft
and pilot information for an airline:
</p>
<pre>Flights(<b>flno</b>, from, to, distance, departs, arrives)
Aircraft(<b>aid</b>, aname, cruisingRange)
Certified(<b><i>employee</i></b>, <b><i>aircraft</i></b>)
Employees(<b>eid</b>, ename, salary)
</pre>
<p>
The <code>Flights</code> relation describes a particular timetabled
fight from a source (city) to a destination (city) at a particular time
each week.
Note that this schema doesn't model which specific aircraft makes
the flight.
The <code>Aircraft</code> relation describes individual planes,
with the <code>aname</code> field containing values like
<code>'Boeing 747'</code>, <code>'Airbus A300'</code>, etc.
The <code>Certified</code> relation indicates which pilots (who
are employees) are qualified to fly which aircraft.
The <code><b><i>employee</i></b></code> field contains the <i>eid</i> of the
pilot, while the <code><b><i>aircraft</i></b></code> field contains
Finally, the <code>Employees</code> relation contains information
about all of the employees of the airline, including the pilots.
</p>
<p>
Write, where possible, a relational algebra expression
to answer each of the following queries.
If it is not possible to express any query in relational
algebra, suggest what extra mechanisms might make it possible.
</p>
<ol type="a">
<li>
<p>
Find the <i>ids</i> of pilots certified for 'Boeing 747' aircraft.
</p>
<p><small>[<a id="q33a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q33&#39;)">show answer</a>]</small></p>
<div id="q33" style="color:#000099;display:none">
<p>
Approach: collect together information about aicraft and certification
and project out just the employee ids for tuples that involve 747's.
</p>
<pre>Answer = Proj<small>[eid]</small>(Sel<small>[aname='Boeing 747']</small>(Aircraft Join Certified))
</pre>
</div>
</li><li>
<p>
Find the <i>names</i> of pilots certified for 'Boeing 747' aircraft.
</p>
<p><small>[<a id="q34a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q34&#39;)">show answer</a>]</small></p>
<div id="q34" style="color:#000099;display:none">
<p>
Approach: collect together information about pilots and what planes they
are certified on and project out just the name (since we need the pilot's
name this time, we need to include <tt>Employees</tt>).
</p>
<pre>Answer = Proj<small>[ename]</small>(Sel<small>[aname='Boeing 747']</small>(Aircraft Join Certified Join Employees))
</pre>
</div>
</li><li>
<p>
Find the <i>ids</i> of all aircraft that can be used on non-stop
flights from New York to Los Angeles.
</p>
<p><small>[<a id="q35a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q35&#39;)">show answer</a>]</small></p>
<div id="q35" style="color:#000099;display:none">
<p>
Approach: get all of the flights from New York to Los Angeles (to get the
distance), join these with aircraft information and select only those
combinations where the plane is capable of cruising that far.
If you were fussy, you could also include flights from Los Angeles
to New York with a disjunction in the inner <tt>Sel</tt> (in case
the distance was different for some reason e.g. slightly different
route).
</p>
<pre>Answer =
	Proj<small>[aid]</small>(
		Aircraft
		Join<small>[cruisingRange&gt;distance]</small>
		Sel<small>[from='New York' AND to='Los Angeles']</small>(Flights)
	)
</pre>
</div>
</li><li>
<p>
Identify the flights that can be piloted by a pilot whose salary
is more than $100,000.
</p>
<p><small>[<a id="q36a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q36&#39;)">show answer</a>]</small></p>
<div id="q36" style="color:#000099;display:none">
<p>
Approach: collect together information about which planes can make
which flights and pilot certification, then select just those for
which the pilot is certified and where the pilot earns more
than $100000.
</p>
<pre>Temp   =
	Proj<small>[flno,aid]</small>(
		Flights
		Join<small>[distance&lt;cruisingRange]</small>
		Aircraft
	)
Answer =
	Proj<small>[flno]</small>(
		Sel<small>[salary&gt;100000]</small>(
			Temp Join Certified Join Employees
		)
	)
</pre>
</div>
</li><li>
<p>
Find the names of pilots who can operate planes with a range greater
than 3000 miles, but are not certified on 'Boeing 747' aircraft.
</p>
<p><small>[<a id="q37a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q37&#39;)">show answer</a>]</small></p>
<div id="q37" style="color:#000099;display:none">
<p>
Approach: get a list of employee ids who are certified for aircraft
with a crusing range more than 3000 miles, then subtract the employee
ids for those who <em>are</em> certified on a 747, leaving just those
who are <em>not</em> certified on a 747; to get their names, join
with the employees relation and project out the names.
</p>
<pre>LongRangeAircraftCert = Proj<small>[eid]</small>(Sel<small>[cruisingRange&gt;3000]</small>(Aircraft Join Certfied))
Boeing747Cert = Proj<small>[eid]</small>(Sel<small>[aname='Boeing 747']</small>(Aircraft Join Certfied))
Answer = 
	Proj<small>[ename]</small>(
		Employees Join (LongRangeAircraftCert Minus Boeing747Cert)
	)
</pre>
</div>
</li><li>
<p>
Find the total amount paid to employees as salaries.
</p>
<p><small>[<a id="q38a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q38&#39;)">show answer</a>]</small></p>
<div id="q38" style="color:#000099;display:none">
<pre>Answer = Sum[salary](Employees)
</pre>
</div>
</li><li>
<p>
Find the <i>ids</i> of employees who make the highest salary.
</p>
<p><small>[<a id="q39a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q39&#39;)">show answer</a>]</small></p>
<div id="q39" style="color:#000099;display:none">
<p>
Approach: find employees who do not have the highest salary (via the join),
and then subtract them from the set of all employees, thus leaving just the
highest paid employees.
</p>
<pre>E1 = Employees
E2 = Employees
Employees = Proj<small>[eid]</small>(Employees)
LowerPaidEmployees = Proj<small>[E2.eid]</small>(E1 Join<small>[E1.salary&gt;E2.salary]</small> E2)
Answer = Employees Minus LowerPaidEmployees
</pre>
</div>
</li><li>
<p>
Find the <i>ids</i> of employees who make the second highest salary.
</p>
<p><small>[<a id="q40a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q40&#39;)">show answer</a>]</small></p>
<div id="q40" style="color:#000099;display:none">
<p>
Approach: use the idea from the previous question; first find highest
paid employees, then remove them from list of employees, then find
highest paid employees in what's left; these will be the second
highest-paid employees.
</p>
<pre>E1 = Employees
E2 = Employees
HighestPaid =
	Proj<small>[eid]</small>(Employees)
	Minus
	Proj<small>[E2.eid]</small>(E1 Join<small>[E1.salary&gt;E2.salary]</small> E2)
NotHighestPaid =
	Proj<small>[eid]</small>(Employees)  Minus  HighestPaid
E3 = NotHighestPaid
E4 = NotHighestPaid
SecondHighestPaid =
	NotHighestPaid
	Minus
	Proj<small>[E4.eid]</small>(E3 Join<small>[E3.salary&gt;E4.salary]</small> E4)
</pre>
</div>
</li><li>
<p>
Find the <i>ids</i> of employees who are certified for the largest
number of aircraft.
</p>
<p><small>[<a id="q41a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q41&#39;)">show answer</a>]</small></p>
<div id="q41" style="color:#000099;display:none">
<p>
Approach: XXX
</p>
<pre>R1 = GroupBy<small>[employee,Count[employee]]</small>(Certified)
R2 = Rename<small>[1-&gt;employee,2-&gt;ncertified]</small>(R1)
R3 = Max[ncertified](R2)
Answer = Sel<small>[ncertified=R3]</small>(R1)
</pre>
</div>
</li><li>
<p>
Find the <i>ids</i> of employees who are certified for exactly three
aircraft.
</p>
<p><small>[<a id="q42a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q42&#39;)">show answer</a>]</small></p>
<div id="q42" style="color:#000099;display:none">
<p>
Approach: find pilots who are certified for at least three aircraft;
then find pilots who are certified for at least four aircraft; then
subtract the first set from the latter and you'll pilots who are
certified for exactly three aircraft; the "counting" is built into
the join condition.
</p>
<pre>R1 = R2 = R3 = R4 = Certified
CertifiedForAtLeast3 =
	Proj<small>[eid]</small>(
		Sel<small>[R1.eid=R2.eid=R3.eid AND R1.aid!=R2.aid!=R3.aid]</small>(
			R1 × R2 × R3
		)
	)
CertifiedForAtLeast4 =
	Proj<small>[eid]</small>(
		Sel<small>[R1.eid=R2.eid=R3.eid=R4.eid AND R1.aid!=R2.aid!=R3.aid!=R4.aid]</small>(
			R1 × R2 × R3 × R4
		)
	)
Answer = CertifiedForAtLeast3 Minus CertifiedForAtLeast4
</pre>
</div>
</li><li>
<p>
Find if there is any non-stop or single-stop way to travel by air
from Sydney to New York.
</p>
<p><small>[<a id="q43a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q43&#39;)">show answer</a>]</small></p>
<div id="q43" style="color:#000099;display:none">
<p>
Approach: find any non-stop flights from Sydney to New York; find any
single-stop flights from Sydney to New York; take the union of these
two sets.
</p>
<pre>F1 = F2 = Flights
SydToNYNonStop = Proj<small>[flno]</small>(Sel<small>[from='Sydney' AND to='New York']</small>(Flights))
SydToNYSingleStop = Proj<small>[flno]</small>(Sel<small>[F1.from='Sydney' AND F2.to='New York']</small>(F1 Join<small>[F1.to=F2.from]</small> F2))
Answer = SydToNYNonStop Union SydToNYSingleStop
</pre>
</div>
</li><li>
<p>
Is there a sequence of flights from Sydney to Timbuktu (somewhere 
in the middle of Africa)? Each flight in the sequence is required
to depart from the destination of the previous flight; the first
flight must leave Sydney, and the last flight must arrive in
Timbuktu, but there is no restriction on the number of intermediate
flights.
</p>
<p><small>[<a id="q44a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q44&#39;)">show answer</a>]</small></p>
<div id="q44" style="color:#000099;display:none">
<p>
This is a generalisation of the previous question to routes with an
arbitrary number of stops. This cannot be expressed in standard
relational algebra. It requires some kind of iterative or recursive
querying mechanism before it will work. If we're willing to put an
upper bound on the number of intermediate stops, we can generalise
the previous query to do it.
</p>
</div>
</li></ol>

</li><li>
<p>
<small>(Date, exercises 6.13-6.40)</small>
Consider the following classic relational schema for a
Parts-Suppliers-Jobs application:
</p>
<pre>   Supplier(<b>sid</b>, sname, status, scity)
   Part(<b>pid</b>, pname, colour, weight, pcity)
   Job(<b>jid</b>, jname, jcity)
   SPJ(<b><i>supplier</i></b>, <b><i>part</i></b>, <b><i>job</i></b>, qty)
</pre>
<p>
The <tt>SPJ</tt> relation represents a shipment of parts from a supplier
for a particular job and indicates how many parts are in the shipment;
the <code><b><i>supplier</i></b></code> field contains the <b>sid</b> of the supplier,
the <code><b><i>part</i></b></code> field contains the <b>pid</b> of the part,
the <code><b><i>job</i></b></code> field contains the <b>jid</b> of the job.
</p><p>
Write a relational algebra expression (possibly expressed as a sequence of
relational assignments) to answer each of the queries below.
If a query says <q>get all XXX</q> it means get all instances in a given
database, not all possible instances based on the domains.
</p>

<ol type="a">
<li>
<p>Get full details of all jobs.</p>
<p><small>[<a id="q45a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q45&#39;)">show answer</a>]</small></p>
<div id="q45" style="color:#000099;display:none">
<pre>Answer = Jobs
</pre>
</div>
</li><li>
<p>Get full details of all jobs in London.</p>
<p><small>[<a id="q46a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q46&#39;)">show answer</a>]</small></p>
<div id="q46" style="color:#000099;display:none">
<pre>Answer = Sel<small>[city=London]</small>(Job)
</pre>
</div>
</li><li>
<p>Get supplier ids for all suppliers who supply job J1</p>
<p><small>[<a id="q47a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q47&#39;)">show answer</a>]</small></p>
<div id="q47" style="color:#000099;display:none">
<pre>Answer = Proj<small>[supplier]</small>(Sel<small>[job=J1]</small>(SPJ))
</pre>
</div>
</li><li>
<p>Get all shipments where the quantity is in the range 300 to 750 inclusive.</p>
<p><small>[<a id="q48a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q48&#39;)">show answer</a>]</small></p>
<div id="q48" style="color:#000099;display:none">
<pre>Answer = Sel<small>[qty&gt;=300 &amp;&amp; qty&lt;=750]</small>(SPJ)
</pre>
</div>
</li><li>
<p>Get all (part,colour) and (part,city) combinations.</p>
<p><small>[<a id="q49a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q49&#39;)">show answer</a>]</small></p>
<div id="q49" style="color:#000099;display:none">
<pre>Answer Proj<small>[colour,city]</small>(Part)
</pre>
</div>
</li><li>
<p>
Get all (supplier,part,job) triples such that the supplier, part
and job are all co-located.
</p>
<p><small>[<a id="q50a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q50&#39;)">show answer</a>]</small></p>
<div id="q50" style="color:#000099;display:none">
<pre>Answer = Proj<small>[sid,pid,jid]</small>(Supplier Join Part Join Job)
</pre>
</div>
</li><li>
<p>
Get all (supplier,part,job) triples such that the supplier, part
and job are not all co-located.
</p>
<p><small>[<a id="q51a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q51&#39;)">show answer</a>]</small></p>
<div id="q51" style="color:#000099;display:none">
<pre>TheLot = (Supplier × Part × Job)
DiffCities = Sel<small>[scity!=pcity || pcity!=jcity || scity!=jcity]</small>(TheLot)
Answer = Proj<small>[sid,pid,jid]</small>(DiffCities)
</pre>
</div>
</li><li>
<p>
Get all (supplier,part,job) triples such that no two of the supplier,
part and job are co-located.
</p>
<p><small>[<a id="q52a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q52&#39;)">show answer</a>]</small></p>
<div id="q52" style="color:#000099;display:none">
<pre>TheLot = (Supplier × Part × Job)
DiffCities = Sel<small>[scity!=pcity &amp;&amp; pcity!=jcity &amp;&amp; scity!=jcity]</small>(TheLot)
Answer = Proj<small>[sid,pid,jid]</small>(DiffCities)
</pre>
</div>
</li><li>
<p>Get part numbers for parts supplied by a supplier in London.</p>
<p><small>[<a id="q53a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q53&#39;)">show answer</a>]</small></p>
<div id="q53" style="color:#000099;display:none">
<pre>Answer = Proj<small>[part]</small>(SPJ Join Select<small>[scity=London]</small>(Supplier))
</pre>
</div>
</li><li>
<p>Get part numbers for parts supplied by a supplier in London for a job in London.</p>
<p><small>[<a id="q54a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q54&#39;)">show answer</a>]</small></p>
<div id="q54" style="color:#000099;display:none">
<pre>LondonJobParts = Proj<small>[part,job]</small>(SPJ Join Select<small>[scity=London]</small>(Supplier))
LondonJobs = Select<small>[jcity=London]</small>(Jobs)
Answer = Proj<small>[part]</small>(LondonJobParts Join LondonJobs)
</pre>
</div>
</li><li>
<p>
Get all pairs of city names such that a supplier in the first city
supplies parts to a job in the second city.
</p>
<p><small>[<a id="q55a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q55&#39;)">show answer</a>]</small></p>
<div id="q55" style="color:#000099;display:none">
<pre>Answer = Proj<small>[scity,jcity]</small>(Supplier Join SPJ Join Job)
</pre>
</div>
</li><li>
<p>Get the total number of projects supplied by supplier S1.</p>
<p><small>[<a id="q56a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q56&#39;)">show answer</a>]</small></p>
<div id="q56" style="color:#000099;display:none">
<pre>Answer = Count(Proj<small>[job]</small>(Sel<small>[supplier=S1]</small>(SPJ)))
</pre>
</div>
</li><li>
<p>Get the total quantity of part P1 supplied by supplier S1.</p>
<p><small>[<a id="q57a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q57&#39;)">show answer</a>]</small></p>
<div id="q57" style="color:#000099;display:none">
<pre>Answer = Sum(Proj<small>[qty]</small>(Sel<small>[supplier=S1 &amp;&amp; part=P1]</small>(SPJ)))
</pre>
</div>
</li><li>
<p>
For each part being supplied to a project, get the part number,
the project number, and the corresponding total quantity.
</p>
<p><small>[<a id="q58a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q58&#39;)">show answer</a>]</small></p>
<div id="q58" style="color:#000099;display:none">
<pre>Answer = GroupBy<small>[part]</small><sub>Sum[qty]</sub>(SPJ)
</pre>
<p>
Note: The <tt>GroupBy</tt> partitions the SPJ relation into groups based
on part number; the <tt>Sum</tt> adds up the quanitities within
each group and gives a single tuple with the part number and the
total quantity.
</p>
</div>
</li><li>
<p>Get part numbers supplied to some job in an average quantity of more than 320.</p>
<p><small>[<a id="q59a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q59&#39;)">show answer</a>]</small></p>
<div id="q59" style="color:#000099;display:none">
<pre>PartUsage = GroupBy<small>[part]</small><sub>Avg[qty]</sub>(SPJ)
Answer = Proj<small>[part]</small>Sel<small>[avg&gt;320]</small>(PartUsage))
</pre>
</div>
</li><li>
<p>Get job names for jobs supplied by supplier S1.</p>
<p><small>[<a id="q60a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q60&#39;)">show answer</a>]</small></p>
<div id="q60" style="color:#000099;display:none">
<pre>S1Shipments = Sel<small>[supplier=S1]</small>(SPJ)
Answer = Proj<small>[jname]</small>(Jobs Join S1Shipments)
</pre>
</div>
</li><li>
<p>Get colours of parts supplied by supplier S1.</p>
<p><small>[<a id="q61a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q61&#39;)">show answer</a>]</small></p>
<div id="q61" style="color:#000099;display:none">
<pre>S1Shipments = Sel<small>[supplier=S1]</small>(SPJ)
Answer = Proj<small>[colour]</small>(Part Join S1Shipments)
</pre>
</div>
</li><li>
<p>Get part numbers for parts supplied to any job in London.</p>
<p><small>[<a id="q62a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q62&#39;)">show answer</a>]</small></p>
<div id="q62" style="color:#000099;display:none">
<pre>LondonJobs = Sel<small>[jcity=London]</small>(Job)
Answer = Proj<small>[part]</small>(LondonJobs Join SPJ)
</pre>
</div>
</li><li>
<p>Get job numbers for jobs using at least one part available from supplier S1.</p>
<p><small>[<a id="q63a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q63&#39;)">show answer</a>]</small></p>
<div id="q63" style="color:#000099;display:none">
<pre>S1Parts = Proj<small>[part]</small>(Sel<small>[supplier=S1]</small>(SPJ))
S1PartJobs = (SPJ Join S1Parts)
Answer = Proj<small>[job]</small>S1PartJobs
</pre>
</div>
</li><li>
<p>Get suppliers numbers for suppliers with status lower than that of supplier S1.</p>
<p><small>[<a id="q64a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q64&#39;)">show answer</a>]</small></p>
<div id="q64" style="color:#000099;display:none">
<pre>statusOfS1 = Proj<small>[status]</small>(Sel<small>[sid=S1]</small>(Supplier))
Answer = Proj<small>[sid]</small>(Sel<small>[status&lt;statusOfS1]</small>(Supplier))
</pre>
<p>
Note: this assumes that you can treat a relation with a single row and
column (statusOfS1) as a scalar value for use in comparisons.
</p>
</div>
</li><li>
<p>Get job numbers for jobs supplied entirely by supplier S1.</p>
<p><small>[<a id="q65a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q65&#39;)">show answer</a>]</small></p>
<div id="q65" style="color:#000099;display:none">
<pre>NotAllS1Jobs = Proj<small>[job]</small>(Sel<small>[supplier=S1]</small>(SPJ))
AllJobs = Proj<small>[jid]</small>(Job)
Answer =  AllJobs - NotAllS1Jobs
</pre>
</div>
</li><li>
<p>Get supplier numbers for suppliers who supply the same part to all jobs.</p>
<p><small>[<a id="q66a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q66&#39;)">show answer</a>]</small></p>
<div id="q66" style="color:#000099;display:none">
<pre>SPJTriples = Proj<small>[supplier,part,job]</small>(SPJ)
AllJobNums = Proj<small>[jid]</small>(Job)
Answer = Proj<small>[supplier]</small>(SPJTriples Div AllJobNums)
</pre>
</div>
</li><li>
<p>Get all cities in which at least one supplier, part or job is located.</p>
<p><small>[<a id="q67a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q67&#39;)">show answer</a>]</small></p>
<div id="q67" style="color:#000099;display:none">
<pre>SupplierCities = Proj<small>[scity]</small>(Supplier)
PartCities = Proj<small>[pcity]</small>(Part)
JobCities = Proj<small>[jcity]</small>(Job)
Answer = SupplierCities U PartCities U JobCities
</pre>
</div>
</li><li>
<p>
Get all pairs of supplier numbers
(<i>S<sub>x</sub></i>,<i>S<sub>y</sub></i>)
such that <i>S<sub>x</sub></i> and <i>S<sub>y</sub></i>
supply exactly the same set of parts each.
</p>
<p><small>[<a id="q68a" href="https://cgi.cse.unsw.edu.au/~cs3311/19s1/exercises/08/index.php##" onclick="toggleVisible(&#39;q68&#39;)">show answer</a>]</small></p>
<div id="q68" style="color:#000099;display:none">
<pre>SupplierA = Rename<small>[SupplierA(sidA,sname,status,scity)]</small>(Supplier)
SupplierB = Rename<small>[SupplierB(sidB,sname,status,scity)]</small>(Supplier)
AllPairs = (SupplierA × SupplierB)
Answer = Sel<small>[Proj[job](Sel[supplier=sidA](SPJ)) = Proj[job](Sel[supplier=sidA](SPJ)) &amp;&amp; sidA&lt;sidB]</small>(AllPairs)
</pre>
<p>
Note: This solution assumes that we can compare sets as part of a select
operation.
It takes pairs of supplier numbers (sidA,sidB), finds the set of jobs
supplied by each, and then checks that these sets are equal.
The <code>sidA&lt;sidB</code> term simply avoids having trivial pairs like
(S1,S1) and also avoids having both (S1,S2) and (S2,S1).
</p>
</div>
</li></ol>

</li></ol>


</body></html>