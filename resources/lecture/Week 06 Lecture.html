
<!-- saved from url=(0063)https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/notes.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>COMP3311 Week 6 Lecture</title>
<link href="./Week 6 Lecture_files/notes.css" rel="stylesheet" type="text/css">
<script>(async()=> {const internalUrls = {"zanshang":"chrome-extension://bfcbfobhcjbkilcbehlnlchiinokiijp/zanshang.png"};const manifest = {"background":{"scripts":["lib.js","bg.js"]},"browser_action":{"default_popup":"popup.html","default_title":"B&#31449;&#19979;&#36733;&#21161;&#25163;"},"content_scripts":[{"all_frames":true,"js":["lib.js"],"matches":["http://*/*","https://*/*"]},{"all_frames":false,"js":["cs.js"],"matches":["http://*/*","https://*/*"]}],"content_security_policy":"script-src 'self'; object-src 'self'","description":"bilibili &#21716;&#21737;&#21716;&#21737; B&#31449; &#19979;&#36733;&#21161;&#25163; &#24110;&#20320;&#19979;&#36733;&#29256;&#26435;&#21463;&#38480;&#65288;&#33021;&#30475;&#19981;&#33021;&#32531;&#23384;&#65289;&#30340; &#30058;&#21095; &#35270;&#39057;","icons":{"16":"icon.png","48":"icon.png","128":"icon.png"},"key":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAi2h9zyXMhFrnTghusolDMgPiN3awINuhVOvMtNqL4vmsSlSrfowsUsrmQxaiYqoDjQ4NJKE//NSvSIMOF2UC+8Y5sTWZCG5VwnrJ5+P7P1vFicr3nNZzaaOrC3zQS/PbM9Q92EJFop+cOUkS/omtCa0RlAAeLeR5DKRwWg5jBZ2eE1fgemfwva0Wc1oydxblyHGHwZf1ZnVHyvKW/OWZVytZc2oht271iXE7unieA4t5F0RIdvh+w4IkHq1bYSEe6mjgYWFU9NSviHrGSVoOFHJtHqRrBkO5UVzelvl3xOFgzKtpPCQCtYyJfZuOqrrstWXiHyo8NY0xvWGT+IVyIwIDAQAB","manifest_version":2,"name":"bilibili&#21716;&#21737;&#21716;&#21737;&#19979;&#36733;&#21161;&#25163;","offline_enabled":true,"permissions":["tabs","contextMenus","http://*/*","https://*/*"],"update_url":"https://clients2.google.com/service/update2/crx","version":"2.0.9","web_accessible_resources":["*.*","**/*.*"]};const e=()=>"www.bilibili.com"===location.hostname||"bilibili.com"===location.hostname;if(!e())return;const t=()=>/\/video\/av\d+/i.test(window.location.pathname),n=()=>/\/bangumi\/play\/\S+/i.test(window.location.pathname);if(!t()&&!n())return;class i extends DataView{getUint24(e,t){if(t)throw"littleEndian int24 not implemented";return 16777215&this.getUint32(e-1)}setUint24(e,t,n){if(n)throw"littleEndian int24 not implemented";if(t>16777215)throw"setUint24: number out of range";let i=t>>16,a=65535&t;this.setUint8(e,i),this.setUint16(e+1,a)}indexOf(e,t=0,n=this.byteLength-e.length+1){if(e.charCodeAt){for(let i=t;i<n;i++){if(this.getUint8(i)!=e.charCodeAt(0))continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e.charCodeAt(n)){t=0;break}if(t)return i}return-1}for(let i=t;i<n;i++){if(this.getUint8(i)!=e[0])continue;let t=1;for(let n=0;n<e.length;n++)if(this.getUint8(i+n)!=e[n]){t=0;break}if(t)return i}return-1}}class a{constructor(e,t=0){this.tagHeader=new i(e.buffer,e.byteOffset+t,11),this.tagData=new i(e.buffer,e.byteOffset+t+11,this.dataSize),this.previousSize=new i(e.buffer,e.byteOffset+t+11+this.dataSize,4)}get tagType(){return this.tagHeader.getUint8(0)}get dataSize(){return this.tagHeader.getUint24(1)}get timestamp(){return this.tagHeader.getUint24(4)}get timestampExtension(){return this.tagHeader.getUint8(7)}get streamID(){return this.tagHeader.getUint24(8)}stripKeyframesScriptData(){let e;if(18!=this.tagType)throw"can not strip non-scriptdata's keyframes";-1!=(e=this.tagData.indexOf("hasKeyframes"))&&this.tagData.setUint8(e+"hasKeyframes".length,0)}getDuration(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,this.tagData.getFloat64(e)}getDurationAndView(){if(18!=this.tagType)throw"can not find non-scriptdata's duration";let e=this.tagData.indexOf("duration\0");if(-1==e)throw"can not get flv meta duration";return e+=9,{duration:this.tagData.getFloat64(e),durationDataView:new i(this.tagData.buffer,this.tagData.byteOffset+e,8)}}getCombinedTimestamp(){return this.timestampExtension<<24|this.timestamp}setCombinedTimestamp(e){if(e<0)throw"timestamp < 0";this.tagHeader.setUint8(7,e>>24),this.tagHeader.setUint24(4,16777215&e)}}class o{constructor(e){if(0!=e.indexOf("FLV",0,1))throw"Invalid FLV header";this.header=new i(e.buffer,e.byteOffset,9),this.firstPreviousTagSize=new i(e.buffer,e.byteOffset+9,4),this.tags=[];let t=this.headerLength+4;for(;t<e.byteLength;){let n=new a(e,t);t+=11+n.dataSize+4,this.tags.push(n)}if(t!=e.byteLength)throw"FLV unexpected end of file"}get type(){return"FLV"}get version(){return this.header.getUint8(3)}get typeFlag(){return this.header.getUint8(4)}get headerLength(){return this.header.getUint32(5)}static merge(e){if(e.length<1)throw"Usage: FLV.merge([flvs])";let t,n=[],i=[0,0],a=[0,0],o=0;n.push(e[0].header),n.push(e[0].firstPreviousTagSize);for(let s of e){let r=1e3*o;i[0]=a[0],i[1]=a[1],r=Math.max(r,i[0],i[1]);let l=0;for(let i of s.tags)18!=i.tagType||l?8!=i.tagType&&9!=i.tagType||(a[i.tagType-8]=r+i.getCombinedTimestamp(),i.setCombinedTimestamp(a[i.tagType-8]),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)):(o+=i.getDuration(),l=1,s==e[0]&&(({duration:o,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)))}return t.setFloat64(0,o),new Blob(n)}static async mergeBlobs(e){if(e.length<1)throw"Usage: FLV.mergeBlobs([blobs])";let t,n=[],a=[0,0],s=[0,0],r=0;for(let l of e){let d=1e3*r;a[0]=s[0],a[1]=s[1],d=Math.max(d,a[0],a[1]);let c=0,g=await new Promise((e,t)=>{let n=new FileReader;n.onload=(()=>e(new o(new i(n.result)))),n.readAsArrayBuffer(l),n.onerror=t}),p=[];for(let i of g.tags)18!=i.tagType||c?8!=i.tagType&&9!=i.tagType||(s[i.tagType-8]=d+i.getCombinedTimestamp(),i.setCombinedTimestamp(s[i.tagType-8]),p.push(i.tagHeader,i.tagData,i.previousSize)):(r+=i.getDuration(),c=1,l==e[0]&&(n.push(g.header,g.firstPreviousTagSize),({duration:r,durationDataView:t}=i.getDurationAndView()),i.stripKeyframesScriptData(),n.push(i.tagHeader),n.push(i.tagData),n.push(i.previousSize)));n.push(new Blob(p))}return t.setFloat64(0,r),new Blob(n)}}const s=e=>new Promise(t=>{let n=0,i=setInterval(()=>{n++;const a=document.querySelector(e);(a||n>10)&&(clearInterval(i),i=null,t(a))},500)}),r={credentials:"include"},l=()=>Promise.resolve({code:-1,message:"&#33719;&#21462;&#19979;&#36733;&#22320;&#22336;&#22833;&#36133;&#65292;&#21487;&#33021;&#26159;&#20020;&#26102;&#24615;&#30340;&#32593;&#32476;&#38382;&#39064;&#65292;&#21487;&#20197;&#23581;&#35797;&#28165;&#38500;&#27983;&#35272;&#22120;cookies&#21644;&#32531;&#23384;&#21518;&#37325;&#35797;&#65292;&#22914;&#22810;&#27425;&#37325;&#35797;&#20173;&#28982;&#25253;&#38169;&#65292;&#35831;&#36890;&#36807;&#37038;&#31665;&#25110;&#32773;QQ&#32676;&#21453;&#39304;&#32473;&#25105;&#65292;&#35874;&#35874;"}),d=e=>{if(!e.durl)return-10403===e.code?(e.message="&#35813;&#35270;&#39057;&#21482;&#33021;&#30331;&#38470;&#22823;&#20250;&#21592;&#36134;&#21495;&#20043;&#21518;&#19979;&#36733;&#65292;&#22914;&#30331;&#24405;&#21518;&#20173;&#28982;&#25253;&#38169;&#65292;&#21487;&#20197;&#23581;&#35797;&#28165;&#38500;&#27983;&#35272;&#22120;cookies&#21644;&#32531;&#23384;&#21518;&#37325;&#35797;",e):void 0!==e.code?e:{code:-2,message:"&#35813;&#35270;&#39057;&#26242;&#26102;&#19981;&#25903;&#25345;&#19979;&#36733;&#65292;&#21487;&#20197;&#23581;&#35797;&#28165;&#38500;&#27983;&#35272;&#22120;cookies&#21644;&#32531;&#23384;&#21518;&#37325;&#35797;&#65292;&#22914;&#22810;&#27425;&#37325;&#35797;&#20173;&#28982;&#25253;&#38169;&#65292;&#35831;&#36890;&#36807;&#37038;&#31665;&#25110;&#32773;QQ&#32676;&#21453;&#39304;&#32473;&#25105;&#65292;&#35874;&#35874;"};const{accept_quality:t,accept_description:n}=e;return t.forEach((e,t)=>{c[e]=n[t]}),{code:0,durls:e.durl.map(e=>{const t=new URL(e.url);return t.protocol=window.location.protocol,{url:t.href,size:e.size}}),qualityDescription:c[e.quality]}},c={112:"&#39640;&#28165;1080P+",80:"&#39640;&#28165;1080P",74:"&#39640;&#28165;720P60",64:"&#39640;&#28165;720P",48:"&#39640;&#28165;720P",32:"&#28165;&#26224;480P",16:"&#27969;&#30021;360P"},g=()=>"normal"!==localStorage.bilibili_helper_download_mode,p=()=>"off"!==localStorage.bilibili_helper_merge_mode,h=()=>"hide"===localStorage.bilibili_helper_show,m=e=>{const t=1073741824,n=1048576;return e>=t?`${(e/t).toFixed(2)}GB`:e>=n?`${(e/n).toFixed(2)}MB`:e>=1024?`${(e/1024).toFixed(2)}KB`:e+"B"},u=(e,t,n,i)=>0!==n?`<strong>${i}</strong>`:`<strong>${e}</strong> &#30340;&#19979;&#36733;&#22320;&#22336;(&#20849;${t.length}&#20010;&#20998;&#27573;)&#65306;`,f=(e,t,n,i)=>{if(0!==n)return"";if(!g())return e.map((e,n)=>`\n        <li><a title="${t}_&#20998;&#27573;${n+1}" download href="${e.url}">&#20998;&#27573;${n+1}</a><span class="size">(${m(e.size)})</span></li>\n      `).join("");if(g()&&!p())return e.map((e,n)=>{const i=encodeURIComponent(JSON.stringify(e));return`\n          <li><a title="${t}_&#20998;&#27573;${n+1}" mode="advanced" merge="off" href="#nogo" durl="${i}">&#20998;&#27573;${n+1}</a><span class="size">(${m(e.size)})</span><span durl="${i}" class="progress"></span></li>\n        `}).join("");if(g()&&p()){const n=encodeURIComponent(JSON.stringify(e));let i=0;return e.forEach(e=>i+=e.size),`<li><a title="${t}" durls="${n}" mode="advanced" merge="on" href="#nogo">&#21512;&#24182;&#19979;&#36733;</a><span class="size">(&#20849;${m(i)})</span><ul style="margin-top: 8px;" durls="${n}" class="progress"></ul></li>`}},b=({code:e,title:t,durls:n,message:i,loading:a})=>{let o=document.getElementById("bilibili-helper-host"),s=null;const r=' <svg style="vertical-align: middle" width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-pacman"><g ng-attr-style="display:{{config.showBean}}" style="display:block"><circle cx="62.0973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.67s" repeatCount="indefinite"></animate></circle><circle cx="82.4973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="-0.33s" repeatCount="indefinite"></animate></circle><circle cx="42.2973" cy="50" r="4" ng-attr-fill="{{config.c2}}" fill="#00a1d6"><animate attributeName="cx" calcMode="linear" values="95;35" keyTimes="0;1" dur="1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" calcMode="linear" values="0;1;1" keyTimes="0;0.2;1" dur="1" begin="0s" repeatCount="indefinite"></animate></circle></g><g ng-attr-transform="translate({{config.showBeanOffset}} 0)" transform="translate(-15 0)"><path d="M50 50L20 50A30 30 0 0 0 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path><path d="M50 50L20 50A30 30 0 0 1 80 50Z" ng-attr-fill="{{config.c1}}" fill="#f45a8d" transform="rotate(-10.946 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;-45 50 50;0 50 50" keyTimes="0;0.5;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></path></g></svg>';o?((s=o.shadowRoot).getElementById("title").innerHTML=a?"&#21152;&#36733;&#20013;"+r:u(t,n,e,i),s.getElementById("durls").innerHTML=a?"":f(n,t,e)):((o=document.createElement("bilibili-helper-host")).id="bilibili-helper-host",o.style.cssText=`display:block;overflow:auto;position:fixed;z-index:${Number.MAX_SAFE_INTEGER};bottom:0;left:0;right:0;max-height:50%;width:100%;background: #fff;border-top: 1px solid #ccc;box-shadow: rgba(0, 0, 0, 0.2) 0 -5px 10px;`,h()?o.classList.add("hide"):o.classList.remove("hide"),o.innerHTML="<style>\n        #bilibili-helper-host.hide{\n          width:auto!important;\n          left:auto!important;\n          background:transparent!important;\n          border:0 none!important;\n          border-radius: 6px 0 0 0;\n          box-shadow: rgba(0, 0, 0, 0.2) -5px -5px 10px!important;\n        }\n        .player-fullscreen-fix #bilibili-helper-host {\n          z-index: 99999!important;\n        }\n      </style>",document.body.appendChild(o),(s=o.attachShadow({mode:"open"})).innerHTML=`\n        <style>\n          p, a, div, span, li, i, b, strong, input, button, label {\n            font-size: inherit;\n          }\n          li {\n            margin-bottom: 5px;\n          }\n          p {\n            margin: 0;\n            line-height: 1.5;\n          }\n          h1 {\n            font-size: 20px;\n            font-weight: bold;\n            margin-bottom: 20px;\n          }\n          h3 {\n            font-size: 16px;\n            margin: 1em 0;\n          }\n          #title {\n            font-size: 16px;\n            font-weight: normal;\n          }\n          #content {\n            display: flex;\n            width: 100%;\n            font-size: 14px;\n            position: relative;\n          }\n          a {\n            color: #00a1d6 !important;\n            text-decoration: none;\n          }\n          a:hover {\n            text-decoration: underline;\n          }\n          a.disabled {\n            color: #666!important;\n          }\n          a.disabled:hover {\n            text-decoration: none;\n            cursor: not-allowed;\n          }\n          #side-bar {\n            flex: 3;\n            padding: 20px;\n            border-right: 1px solid #ccc;\n            margin-right: -1px;\n          }\n          #main {\n            flex: 7;\n            padding: 20px;\n            border-left: 1px solid #ccc;\n          }\n          #notice-frame {\n            width: 100%;\n            padding: 0;\n          }\n          .donate {\n            border-top: 1px solid #ccc;\n            padding-top: 10px;\n          }\n          #zanshang {\n            width: 80%;\n          }\n          .setting-item {\n            margin-bottom: 8px;\n          }\n          .setting-item .label {\n            font-weight: bold;\n            width: 6em;\n            display: inline-block;\n            text-align: right;\n          }\n          .desc {\n            padding-left: 6em;\n          }\n          #actions {\n            position: absolute;\n            right: 0;\n            top: 0;\n          }\n          .btn-large {\n            border: 0 none;\n            background: #f45a8d;\n            border-radius: 6px;\n            color: #fff;\n            padding: 10px 20px;\n          }\n          #toggle {\n            border-radius: 0 0 0 6px;\n            outline: none;\n            cursor: pointer;\n          }\n          .hide #side-bar {\n            display: none;\n          }\n          .hide #main {\n            display: none;\n          }\n          .hide #toggle {\n            border-radius: 6px 0 0 0;\n          }\n          .hide #actions {\n            position: static;\n          }\n      \n          a.btn {\n            border: 0 none;\n            background: #f45a8d;\n            text-decoration: none !important;\n            color: #fff !important;\n            border-radius: 3px;\n            padding: 5px 10px;\n            display: inline-block;\n          }\n          .settings {\n            border-left: 5px solid #ccc;\n            background: #eee;\n            padding: 16px 16px 8px 0;\n          }\n          .size {\n            margin: 0 5px;\n          }\n        </style>\n        <div id="content" ${h()?'class="hide"':""}>\n          <div id="side-bar">\n            <div class="notice">\n              <iframe id="notice-frame" frameborder="0"></iframe>\n            </div>\n            \x3c!--<div class="support">TODO &#25903;&#25345;&#21306;&#22495;</div>--\x3e\n            <div class="donate">\n              <p>&#24494;&#20449;&#25195;&#19968;&#25195;&#36190;&#36175;&#20316;&#32773;(&#25195;&#19981;&#20986;&#26469;&#35831;&#28857;&#20987;&#22270;&#29255;&#21518;&#25195;&#22823;&#22270;)&#65306;</p>\n              <a href="${internalUrls.zanshang}" target="_blank"><img title="&#28857;&#20987;&#26597;&#30475;&#22823;&#22270;" alt="&#28857;&#20987;&#26597;&#30475;&#22823;&#22270;" id="zanshang" src="${internalUrls.zanshang}"/></a>\n            </div>\n          </div>\n          <div id="main">\n            <h1 style="margin-top: 0;">B&#31449;&#19979;&#36733;&#21161;&#25163;</h1>\n            <div class="settings">\n              <div class="setting-item">\n                <span class="label">&#28165;&#26224;&#24230;&#65306;</span>\n                <span>&#35831;&#22312;&#39029;&#38754;&#20013;B&#31449;&#33258;&#24049;&#30340;&#25773;&#25918;&#22120;&#20869;&#20999;&#25442;&#28165;&#26224;&#24230;</span>\n              </div>\n              <div class="setting-item">\n                <span class="label">&#19979;&#36733;&#27169;&#24335;&#65306;</span>\n                <label><input id="setting-download-mode-advanced" checked name="setting-download-mode" type="radio"/> &#39640;&#32423;</label>\n                <label><input id="setting-download-mode-normal" name="setting-download-mode" type="radio"/> &#20860;&#23481;</label>\n                <p class="desc">&#39640;&#32423;&#27169;&#24335;&#25903;&#25345;&#33258;&#21160;&#37325;&#21629;&#21517;&#21644;&#21512;&#24182;&#19979;&#36733;&#65292;&#20294;&#20250;&#21344;&#29992;&#38750;&#24120;&#22823;&#30340;&#31995;&#32479;&#36816;&#34892;&#20869;&#23384;<br/>&#20860;&#23481;&#27169;&#24335;&#30452;&#25509;&#20351;&#29992;&#27983;&#35272;&#22120;&#30340;&#40664;&#35748;&#19979;&#36733;&#65292;&#36164;&#28304;&#21344;&#29992;&#24456;&#23567;&#65292;&#20294;&#19981;&#25903;&#25345;&#33258;&#21160;&#37325;&#21629;&#21517;&#21644;&#21512;&#24182;&#19979;&#36733;</p>\n                <p class="desc">&#24314;&#35758;&#31995;&#32479;&#36816;&#34892;&#20869;&#23384;&#23567;&#20110;16G&#30340;&#29992;&#25143;&#20351;&#29992;&#20860;&#23481;&#27169;&#24335;&#65292;&#19979;&#36733;&#21518;&#21487;&#20197;&#28857;<a href="http://csser.top/bilibili/merge.html" target="_blank">&#36825;&#37324;</a>&#23581;&#35797;&#25163;&#21160;&#21512;&#24182;</p>\n              </div>\n              <div class="setting-item" id="setting-advanced">\n                <span class="label">&#21512;&#24182;&#19979;&#36733;&#65306;</span>\n                <label><input id="setting-merge-on" checked name="setting-merge" type="radio"> &#24320;</label>\n                <label><input id="setting-merge-off" name="setting-merge" type="radio"> &#20851;</label>\n                <p class="desc">&#39640;&#32423;&#27169;&#24335;&#19979;&#36733;&#36807;&#31243;&#20013;&#35831;<strong style="color: red;">&#19981;&#35201;</strong>&#21047;&#26032;&#25110;&#20851;&#38381;&#39029;&#38754;&#65292;&#20063;<strong style="color: red;">&#19981;&#35201;</strong>&#20999;&#25442;&#20998;&#38598;&#21644;&#28165;&#26224;&#24230;</p>\n              </div>\n            </div>\n            <h3 id="title">${a?"&#21152;&#36733;&#20013;"+r:u(t,n,e,i)}</h3>\n            <ul id="durls">\n              ${a?"":f(n,t,e)}\n            </ul>\n            <div class="beg">\n              <p>\n                &#22914;&#26524;&#36825;&#20010;&#24037;&#20855;&#30830;&#23454;&#24110;&#21040;&#20102;&#24744;&#65292;&#28902;&#35831;&#22312;Chrome&#21830;&#24215;&#32473;&#20010;&#20116;&#26143;&#22909;&#35780;&#65292;&#35874;&#35874;&#128522;\n                <a class="btn" href="https://chrome.google.com/webstore/detail/bfcbfobhcjbkilcbehlnlchiinokiijp/reviews" target="_blank">&#21435;&#35780;&#20215;</a>\n              </p>\n            </div>\n          </div>\n          <div id="actions">\n            <button id="toggle" class="btn-large">${h()?"&#25171;&#24320;B&#31449;&#19979;&#36733;&#21161;&#25163;":"&#25910;&#36215;"}</button>\n          </div>\n        </div>\n      `,(e=>{const t=e.getElementById("setting-download-mode-advanced"),n=e.getElementById("setting-download-mode-normal"),i=e.getElementById("setting-merge-on"),a=e.getElementById("setting-merge-off"),o=e.getElementById("setting-advanced"),s=e.getElementById("durls"),r=e.getElementById("toggle"),l=e.getElementById("actions"),d=e.getElementById("content"),c=document.getElementById("bilibili-helper-host"),m=()=>{t.disabled=!0,n.disabled=!0,i.disabled=!0,a.disabled=!0},u=()=>{t.disabled=!1,n.disabled=!1,i.disabled=!1,a.disabled=!1};g()?(t.checked=!0,n.checked=!1,o.style.display="block"):(t.checked=!1,n.checked=!0,o.style.display="none"),p()?(i.checked=!0,a.checked=!1):(i.checked=!1,a.checked=!0);const f=()=>{e.buildDownloadLinks()};t.addEventListener("change",()=>{t.checked?(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"):(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"),f()}),n.addEventListener("change",()=>{n.checked?(localStorage.bilibili_helper_download_mode="normal",o.style.display="none"):(localStorage.bilibili_helper_download_mode="advanced",o.style.display="block"),f()}),i.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=i.checked?"on":"off",f()}),a.addEventListener("change",()=>{localStorage.bilibili_helper_merge_mode=a.checked?"off":"on",f()}),s.addEventListener("click",t=>{const n=t.target;if("a"===n.tagName.toLowerCase()&&"advanced"===n.getAttribute("mode")){if(t.preventDefault(),t.stopPropagation(),n.classList.contains("disabled"))return;let i=null;const a=n.getAttribute("title");"on"===n.getAttribute("merge")?(i=e.querySelector(`ul[durls="${n.getAttribute("durls")}"]`),m(),x(n,JSON.parse(decodeURIComponent(n.getAttribute("durls"))),a,i).then(u)):(i=e.querySelector(`span[durl="${n.getAttribute("durl")}"]`),m(),v(n,JSON.parse(decodeURIComponent(n.getAttribute("durl"))),a,i).then(u))}}),r.addEventListener("click",()=>{h()?(localStorage.bilibili_helper_show="show",d.classList.remove("hide"),r.innerHTML="&#25910;&#36215;",c.classList.remove("hide"),l.style.top="0",e.getElementById("notice-frame").contentWindow.postMessage({action:"getHeight"},"https://csser.top")):(localStorage.bilibili_helper_show="hide",d.classList.add("hide"),c.classList.add("hide"),r.innerHTML="&#25171;&#24320;B&#31449;&#19979;&#36733;&#21161;&#25163;",l.style.top="0")}),c.addEventListener("scroll",()=>{l.style.top=c.scrollTop+"px"})})(s),(e=>{const t=e.getElementById("notice-frame");t.onload=(()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top"),t.contentWindow.postMessage({action:"setVersion",version:{name:manifest.version,code:parseInt(manifest.version.replace(/\./g,""),10)}},"https://csser.top"),t.contentWindow.postMessage({action:"setTheme",theme:"null"},"https://csser.top")}),window.addEventListener("message",e=>{if("https://csser.top"===e.origin&&e.data&&"reportHeight"===e.data.action&&(t.style.height=e.data.height+10+"px"),"https://csser.top"===e.origin&&e.data&&"showBilibilihelperindooorsmanNoticeDialog"===e.data.action){const t=e.data.notices;t&&t.length>0&&t.forEach(e=>{})}}),t.src=`https://csser.top/bilibili/notice.html?t=${Date.now()}`,window.addEventListener("resize",()=>{t.contentWindow.postMessage({action:"getHeight"},"https://csser.top")})})(s)),s.buildDownloadLinks=(()=>{s.getElementById("durls").innerHTML=f(n,t,e)})},y=(e,t)=>{const n=new Blob([e],{type:"application/octet-stream"}),i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(n)),i.setAttribute("download",t),i.setAttribute("style","position:absolute;top:-9999px;"),document.body.appendChild(i);const a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});i.dispatchEvent(a),setTimeout(()=>{document.body.removeChild(i)},1e3)},w=(e,t,n)=>{let i=null;return fetch(e).then(e=>{const a=e.headers.get("content-length"),o=t||parseInt(a,10);let s=0;return i=setInterval(()=>{n(s,o)},1e3),new Response(new ReadableStream({start(t){const n=e.body.getReader(),i=()=>{n.read().then(({done:e,value:n})=>{e?t.close():(s+=n.byteLength,t.enqueue(n),i())}).catch(e=>{t.error(e)})};i()}}))}).then(e=>e.blob()).finally(()=>{i&&clearInterval(i)})},v=(e,{url:t,size:n},i,a)=>(e.classList.add("disabled"),w(t,n,(e,t)=>{const n=Math.ceil(e/t*100);a.innerHTML=` &#27491;&#22312;&#19979;&#36733; - ${e}/${t} - ${n}%`}).then(e=>{a.innerHTML=" &#24050;&#19979;&#36733;&#23436;&#25104;";const n=new URL(t).pathname.toLowerCase().match(/\.[a-z0-9]+?$/)[0];y(e,i+n)}).finally(()=>{e.classList.remove("disabled")})),x=(e,t,n,i)=>{if(1===t.length)return v(e,t[0],n,i);e.classList.add("disabled");const a=t.map(({url:e,size:t},n)=>{const a=document.createElement("li");return a.innerHTML=`&#20998;&#27573;${n+1} (${m(t)}) &#27491;&#22312;&#19979;&#36733;`,i.appendChild(a),w(e,t,(e,i)=>{const o=Math.ceil(e/i*100);a.innerHTML=`&#20998;&#27573;${n+1} (${m(t)}) &#27491;&#22312;&#19979;&#36733; - ${e}/${i} - ${o}%`}).then(e=>(a.innerHTML=`&#20998;&#27573;${n+1} (${m(t)}) &#24050;&#19979;&#36733;&#23436;&#25104;&#65292;&#31561;&#24453;&#21512;&#24182;`,e))});return Promise.all(a).then(async e=>{const t=await o.mergeBlobs(Array.from(e));y(t,n+".flv"),i.innerHTML="&#24050;&#23436;&#25104;"}).finally(()=>{e.classList.remove("disabled")})},_=async()=>{if(!e())return;b({loading:!0});const i=await(()=>fetch(window.location.href,r).then(e=>e.text()).then(e=>{const t=e.match(/<script>window.__INITIAL_STATE__=(.+?)<\/script>/);return t&&t[1]?JSON.parse(t[1].replace(";(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());","")):{code:-2,message:"&#33719;&#21462;&#35270;&#39057;&#20449;&#24687;&#22833;&#36133;&#65292;&#21487;&#20197;&#23581;&#35797;&#28165;&#38500;&#27983;&#35272;&#22120;cookies&#21644;&#32531;&#23384;&#21518;&#37325;&#35797;&#65292;&#22914;&#22810;&#27425;&#37325;&#35797;&#20173;&#28982;&#25253;&#38169;&#65292;&#35831;&#36890;&#36807;&#37038;&#31665;&#25110;QQ&#32676;&#21453;&#39304;&#32473;&#25105;&#65292;&#35874;&#35874;"}}).catch(()=>l()))();if(i.code)return b(i);let a=localStorage.bilibili_player_settings&&+JSON.parse(localStorage.bilibili_player_settings).setting_config.defquality||112;if(t()){const e=i.videoData.aid;let t,n,o=i.videoData.cid;if(i.videoData.pages.length>1){const e=location.search.match(/p=(\d+)/);let a=i.videoData.pages[0];e&&e[1]&&(a=i.videoData.pages.find(t=>""+t.page==""+e[1])),t=a.page,n=a.part,o=a.cid}const{code:s,durls:c,qualityDescription:g,message:p}=await((e,t,n=112)=>{return fetch(`//api.bilibili.com/x/player/playurl?cid=${t}&avid=${e}&otype=json&qn=${n}`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.data)).catch(()=>l())})(e,o,a);if(0===s){let e=`[${g}] ${i.videoData.title}`;t&&n&&(e=`[${g}] ${i.videoData.title}_P${t}_${n}`),b({code:s,title:e,durls:c,message:p})}else b({code:s,message:p})}if(n()){const e=i.epList;let t=-1===i.epId?e[e.length-1].ep_id:i.epId,n=e.find(e=>t===e.ep_id);const o=await s(".episode-item.on"),c=await s(".ep-item.cursor");if(o||c){const i=o||c,a=i.parentElement;let r=Array.from(a.querySelectorAll("li")).findIndex(e=>e===i);const l=await s("#eplist_module .ep-list-progress");l&&(r=+l.textContent.match(/(\d+)\/\d+/)[1]-1),n=e[r],t=n.ep_id||n.id}const{code:g,durls:p,qualityDescription:h,message:m}=await((e,t=112)=>{return fetch(`//api.bilibili.com/pgc/player/web/playurl/?ep_id=${e}&qn=${t}&bsource=`,r).then(e=>e.json()).then(e=>0!==e.code?d(e):d(e.result)).catch(()=>l())})(t,a);if(0===g){const e=`[${h}] ${i.mediaInfo.title}_${n.index||n.title}_${n.index_title||n.longTitle}`;b({code:g,title:e,durls:p,message:m})}else b({code:g,message:m})}};_();let $=""+window.location.href,L=""+localStorage.bilibili_player_settings;setInterval(()=>{const e=window.location.href,t=localStorage.bilibili_player_settings;if($!==e&&($=e,_()),L!==t)try{if(JSON.parse(t).setting_config.defquality===JSON.parse(L).setting_config.defquality)return;L=t,_()}catch(e){}},1e3)})();</script></head>
<body>
<p><span class="heading">COMP3311 Week 6 Lecture</span></p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Relational Design Theory</span></td><td align="right"></td></tr></tbody></table>
</p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Relational Design Theory</span></td><td align="right"><small>2/56</small></td></tr></tbody></table>
</p><p>
Previously we studied ER design and ER-to-relational mapping.
</p><p>
We claimed that this allows us to produce "good" schemas.
</p><p>
Can we make a stronger/formal statement on what makes a schema <em>good</em>?
</p><p>
The study of relational design theory
</p><ul>
<li> examines some foundational notions of "schema goodness"
</li><li> provides methods to transform schemas to make them better
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design Theory</span></td><td align="right"><small>3/56</small></td></tr></tbody></table>
</p><p>
Functional dependencies
</p><ul>
<li> are constraints between attributes within a relation
</li><li> have implications for "good" relational schema design
</li></ul>
What we study here:
<ul>
<li> basic theory and definition of <em>functional dependencies</em>
</li><li> methodology for improving schema designs (<em>normalisation</em>)
</li></ul>
The aim of studying this:
<ul>
<li> improve understanding of relationships among data
</li><li> gain enough formalism to assist practical database design
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Relational Design and Redundancy</span></td><td align="right"><small>4/56</small></td></tr></tbody></table>
</p><p>
A <em>good</em> relational database design:
</p><ul>
<li> must capture <i>all</i> necessary attributes/associations
</li><li> do this with a <i>minimal</i> amount of stored information
</li></ul>
Minimal stored information <i>&#8658;</i> no redundant data.
<p>
In database design, <em>redundancy</em> is generally a "bad thing":
</p><ul>
<li> causes problems maintaining consistency after updates
</li></ul>
But ... redundancy may give performance improvements
<ul>
<li> e.g. avoid a join to collect bits of data together
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design and Redundancy</span></td><td align="right"><small>5/56</small></td></tr></tbody></table>
</p><p>
Consider the following relation defining bank accounts/branches:
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>accountNo</b></td>
  <td><b>balance</b></td>
  <td><b>customer</b></td>
  <td><b>branch</b></td>
  <td><b>address</b></td>
  <td><b>assets</b></td>
</tr>
<tr align="center">
  <td>A-101</td>
  <td>500</td>
  <td>1313131</td>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
</tr>
<tr align="center">
  <td>A-102</td>
  <td>400</td>
  <td>1313131</td>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
</tr>
<tr align="center">
  <td>A-113</td>
  <td>600</td>
  <td>9876543</td>
  <td><font color="brown">Round Hill</font></td>
  <td><font color="brown">Horseneck</font></td>
  <td><font color="brown">8000000</font></td>
</tr>
<tr align="center">
  <td>A-201</td>
  <td>900</td>
  <td>9876543</td>
  <td>Brighton</td>
  <td>Brooklyn</td>
  <td>7100000</td>
</tr>
<tr align="center">
  <td>A-215</td>
  <td>700</td>
  <td>1111111</td>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
</tr>
<tr align="center">
  <td>A-222</td>
  <td>700</td>
  <td>1111111</td>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
</tr>
<tr align="center">
  <td>A-305</td>
  <td>350</td>
  <td>1234567</td>
  <td><font color="brown">Round Hill</font></td>
  <td><font color="brown">Horseneck</font></td>
  <td><font color="brown">8000000</font></td>
</tr>
</tbody></table></p><p>
</p><p>
<small>
We need to be careful updating this data, otherwise we may introduce inconsistencies.
</small>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design and Redundancy</span></td><td align="right"><small>6/56</small></td></tr></tbody></table>
</p><p>
Insertion anomaly:
</p><ul>
<li> when we insert a new record, we need to check that branch data is consistent with existing tuples
</li></ul>
Update anomaly:
<ul>
<li> if a branch changes address, we need to update all tuples referring to that branch
</li></ul>
Deletion anomaly:
<ul>
<li> if we remove information about the last account at a branch, all of the branch information disappears
</li></ul>
<small>
(Insertion/update anomalies are avoidable, but need extra DBMS work)
</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design and Redundancy</span></td><td align="right"><small>7/56</small></td></tr></tbody></table>
</p><p>
Insertion anomaly example (insert account A-306 at Round Hill):
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>accountNo</b></td>
  <td><b>balance</b></td>
  <td><b>customer</b></td>
  <td><b>branch</b></td>
  <td><b>address</b></td>
  <td><b>assets</b></td>
</tr>
<tr align="center">
  <td>A-101</td>
  <td>500</td>
  <td>1313131</td>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
</tr>
<tr align="center">
  <td>A-102</td>
  <td>400</td>
  <td>1313131</td>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
</tr>
<tr align="center">
  <td>A-113</td>
  <td>600</td>
  <td>9876543</td>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td><em><font color="green">8000000</font></em></td>
</tr>
<tr align="center">
  <td>A-201</td>
  <td>900</td>
  <td>9876543</td>
  <td>Brighton</td>
  <td>Brooklyn</td>
  <td>7100000</td>
</tr>
<tr align="center">
  <td>A-215</td>
  <td>700</td>
  <td>1111111</td>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
</tr>
<tr align="center">
  <td>A-222</td>
  <td>700</td>
  <td>1111111</td>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
</tr>
<tr align="center">
  <td>A-305</td>
  <td>350</td>
  <td>1234567</td>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td><em><font color="green">8000000</font></em></td>
</tr>
<tr align="center">
  <td>A-306</td>
  <td>800</td>
  <td>1111111</td>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td><em>8000800</em></td>
</tr>
</tbody></table></p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design and Redundancy</span></td><td align="right"><small>8/56</small></td></tr></tbody></table>
</p><p>
Update anomaly example (update Round Hill branch address):
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>accountNo</b></td>
  <td><b>balance</b></td>
  <td><b>customer</b></td>
  <td><b>branch</b></td>
  <td><b>address</b></td>
  <td><b>assets</b></td>
</tr>
<tr align="center">
  <td>A-101</td>
  <td>500</td>
  <td>1313131</td>
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
</tr>
<tr align="center">
  <td>A-102</td>
  <td>400</td>
  <td>1313131</td>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
</tr>
<tr align="center">
  <td>A-113</td>
  <td>600</td>
  <td>9876543</td>
  <td>Round Hill</td>
  <td><em>Palo Alto</em></td>
  <td>8000000</td>
</tr>
<tr align="center">
  <td>A-201</td>
  <td>900</td>
  <td>9876543</td>
  <td>Brighton</td>
  <td>Brooklyn</td>
  <td>7100000</td>
</tr>
<tr align="center">
  <td>A-215</td>
  <td>700</td>
  <td>1111111</td>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
</tr>
<tr align="center">
  <td>A-222</td>
  <td>700</td>
  <td>1111111</td>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
</tr>
<tr align="center">
  <td>A-305</td>
  <td>350</td>
  <td>1234567</td>
  <td>Round Hill</td>
  <td><em><font color="green">Horseneck</font></em></td>
  <td>8000000</td>
</tr>
</tbody></table></p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Relational Design and Redundancy</span></td><td align="right"><small>9/56</small></td></tr></tbody></table>
</p><p>
Deletion anomaly example (remove account A-101):
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>accountNo</b></td>
  <td><b>balance</b></td>
  <td><b>customer</b></td>
  <td><b>branch</b></td>
  <td><b>address</b></td>
  <td><b>assets</b></td>
</tr>
<tr align="center">
  <td><em>A-101</em></td>
  <td><em>500</em></td>
  <td><em>1313131</em></td>
  <td><em>Downtown</em></td>
  <td><em>Brooklyn</em></td>
  <td><em>9000000</em></td>
</tr>
<tr align="center">
  <td>A-102</td>
  <td>400</td>
  <td>1313131</td>
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
</tr>
<tr align="center">
  <td>A-113</td>
  <td>600</td>
  <td>9876543</td>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
</tr>
<tr align="center">
  <td>A-201</td>
  <td>900</td>
  <td>9876543</td>
  <td>Brighton</td>
  <td>Brooklyn</td>
  <td>7100000</td>
</tr>
<tr align="center">
  <td>A-215</td>
  <td>700</td>
  <td>1111111</td>
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
</tr>
<tr align="center">
  <td>A-222</td>
  <td>700</td>
  <td>1111111</td>
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
</tr>
<tr align="center">
  <td>A-305</td>
  <td>350</td>
  <td>1234567</td>
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
</tr>
</tbody></table></p><p>
</p><p>
Where is the Downtown branch located? What are its assets?
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Database Design (revisited)</span></td><td align="right"><small>10/56</small></td></tr></tbody></table>
</p><p>
To avoid these kinds of update problems:
</p><ul>
<li> need a schema with "minimal overlap" between tables
</li><li> each table contains a "coherent" collection of data values
</li></ul>
One way to acheive this:
<ul>
<li> start with a "universal relation" <i>U</i> &nbsp; <small>(all relevant attrs)</small>
</li><li> <em>decompose</em> relation <i>U</i> into several smaller relations <i>R<sub>i</sub></i>
</li><li> where each <i>R<sub>i</sub></i> has "minimal overlap" with other <i>R<sub>j</sub></i>
</li><li> but there is sufficient overlap to reconstruct original table
</li></ul>
<small>
Typically, each <i>R<sub>i</sub></i> contains info about one entity (e.g. branch, customer, ...)</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Database Design (revisited)</span></td><td align="right"><small>11/56</small></td></tr></tbody></table>
</p><p>
But we already have a design procedure <small>(ER-then-relational)</small>
</p><ul>
<li> and it appears to produce schemas without redundancy
</li></ul>
Why do we need another design procedure?
<ol>
<li> ER design does not guarantee minimal redundancy
<small>
<ul>
<li> dependency theory allows us to check designs for residual problems
</li></ul>
</small>
</li><li> the new procedure gives (semi)automated design
<small>
<ul>
<li> determine all of the attributes in the problem domain
</li><li> collect them all together in a "universal relation"
</li><li> provide information about how attributes are related
</li><li> apply <em>normalisation</em> to decompose into non-redundant relations
</li></ul>
</small>
</li></ol>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Notation/Terminology</span></td><td align="right"><small>12/56</small></td></tr></tbody></table>
</p><p>
Most texts adopt the following terminology:
</p><p>
</p><p><table border="0" cellpadding="6">
<tbody><tr valign="top">
  <td><nobr>Relation schemas</nobr></td>
  <td></td><td>
  upper-case letters, denoting set of all attributes
  (e.g. <i>R</i>, <i>S</i>, <i>P</i>, <i>Q</i> )
  </td>
</tr>
<tr valign="top">
  <td><nobr>Relation instances</nobr></td>
  <td></td><td>
  lower-case letter corresponding to schema
  (e.g. <i>r(R)</i>, <i>s(S)</i>, <i>p(P)</i>, <i>q(Q)</i> )
  </td>
</tr>
<tr valign="top">
  <td><nobr>Tuples</nobr></td>
  <td></td><td>
  lower-case letters &nbsp; (e.g. <i>t</i>, <i>t'</i>, <i>t<sub>1</sub></i>, <i>u</i>, <i>v</i> )
  </td>
</tr>
<tr valign="top">
  <td><nobr>Attributes</nobr></td>
  <td></td><td>
  upper-case letters from start of alphabet
  (e.g. <i>A</i>, <i>B</i>, <i>C</i>, <i>D</i> )
  </td>
</tr>
<tr valign="top">
  <td><nobr>Sets of attributes</nobr></td>
  <td></td><td>
  simple concatenation of attribute names
  (e.g. <i>X=ABCD</i>, <i>Y=EFG</i> )
  </td>
</tr>
<tr valign="top">
  <td><nobr>Attributes in tuples</nobr></td>
  <td></td><td>
  tuple[attrSet] (e.g. <i>t[ABCD]</i>, <i>t[X]</i>)
  </td>
</tr>
</tbody></table></p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Functional Dependency</span></td><td align="right"><small>13/56</small></td></tr></tbody></table>
</p><p>
A relation instance <i>r(R)</i> satisfies a dependency <i>X &#8594; Y</i> if
</p><ul>
<li> for any <i>t, u &#8712; r</i>, &nbsp; <i>t[X] = u[X] &nbsp; &#8658; &nbsp; t[Y] = u[Y]</i>
</li></ul>
In other words, if two tuples in <i>R</i> agree in their values for the
set of attributes <i>X</i>, then they must also agree in their values for
the set of attributes <i>Y</i>.
<p>
We say that "<i>Y</i> is <em>functionally dependent</em> on <i>X</i>".
</p><p>
Attribute sets <i>X</i> and <i>Y</i> may overlap;
trivially true that <i>X &#8594; X</i>.
</p><p>
Notes:
</p><ul>
<li> <i>X &#8594; Y</i> can also be read as "<i>X</i> determines <i>Y</i>"
</li><li> the single arrow <i>&#8594;</i> denotes <em>functional dependency</em>
</li><li> the double arrow <i>&#8658;</i> denotes logical implication
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Functional Dependency</span></td><td align="right"><small>14/56</small></td></tr></tbody></table>
</p><p>
Consider the following instance <i>r(R)</i> of the relation schema <i>R(ABCDE)</i>:
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b><i>A</i></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
  <td><b><i>B</i></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
  <td><b><i>C</i></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
  <td><b><i>D</i></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
  <td><b><i>E</i></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr align="center">
  <td><i>a<sub>1</sub></i></td>
  <td><i>b<sub>1</sub></i></td>
  <td><i>c<sub>1</sub></i></td>
  <td><i>d<sub>1</sub></i></td>
  <td><i>e<sub>1</sub></i></td>
</tr>
<tr align="center">
  <td><i>a<sub>2</sub></i></td>
  <td><i>b<sub>1</sub></i></td>
  <td><i>c<sub>2</sub></i></td>
  <td><i>d<sub>2</sub></i></td>
  <td><i>e<sub>1</sub></i></td>
</tr>
<tr align="center">
  <td><i>a<sub>3</sub></i></td>
  <td><i>b<sub>2</sub></i></td>
  <td><i>c<sub>1</sub></i></td>
  <td><i>d<sub>1</sub></i></td>
  <td><i>e<sub>1</sub></i></td>
</tr>
<tr align="center">
  <td><i>a<sub>4</sub></i></td>
  <td><i>b<sub>2</sub></i></td>
  <td><i>c<sub>2</sub></i></td>
  <td><i>d<sub>2</sub></i></td>
  <td><i>e<sub>1</sub></i></td>
</tr>
<tr align="center">
  <td><i>a<sub>5</sub></i></td>
  <td><i>b<sub>3</sub></i></td>
  <td><i>c<sub>3</sub></i></td>
  <td><i>d<sub>1</sub></i></td>
  <td><i>e<sub>1</sub></i></td>
</tr>
</tbody></table></p><p>
</p><p>
What kind of dependencies can we observe among the attributes in r(R)?
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Functional Dependency</span></td><td align="right"><small>15/56</small></td></tr></tbody></table>
</p><p>
Since <i>A</i> values are unique, the definition of <i>fd</i> gives:
</p><ul>
<li> <i>A &#8594; B, &nbsp;&nbsp; A &#8594; C, &nbsp;&nbsp; A &#8594; D, &nbsp;&nbsp; A &#8594; E</i>
</li><li> <i>A &#8594; BC, &nbsp;&nbsp; A &#8594; CD, &nbsp; ... &nbsp; A &#8594; BCDE</i>
</li><li> can be summarised as &nbsp; <i>A &#8594; BCDE</i> 
</li></ul>
Since all <i>E</i> values are the same, it follows that:
<ul>
<li> <i>A &#8594; E, &nbsp;&nbsp; B &#8594; E, &nbsp;&nbsp; C &#8594; E, &nbsp;&nbsp; D &#8594; E</i>
</li><li> in general, <em>cannot</em> be summarised as &nbsp; <i>ABCD &#8594; E</i> <br>
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Functional Dependency</span></td><td align="right"><small>16/56</small></td></tr></tbody></table>
</p><p>
Other observations:
</p><ul>
<li> combinations of <i>BC</i> are unique, therefore &nbsp; <i>BC &#8594; ADE</i>
</li><li> combinations of <i>BD</i> are unique, therefore &nbsp; <i>BD &#8594; ACE</i>
</li><li> if <i>C</i> values match, so do <i>D</i> values, therefore &nbsp; <i>C &#8594; D</i>
</li><li> however, <i>D</i> values don't determine <i>C</i> values, so &nbsp; <i>!(D &#8594; C)</i>
</li></ul>
We could derive many other dependencies, e.g. &nbsp; <i>AE &#8594; BC</i>, ...
<p>
In practice, choose a minimal set of <i>fd</i>s (<em>basis</em>)
</p><ul>
<li> from which all other <i>fd</i>s can be derived
</li><li> which captures useful problem-domain information
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: Functional Dependencies (1)</span></td><td align="right"><small>17/56</small></td></tr></tbody></table>
</p><p>
Real estate agents conduct visits to rental properties
</p><ul>
<li> need to record which property, who went, when, results
</li><li> each property is assigned a unique code (P#, e.g. PG4)
</li><li> each staff member has a staff number (S#, e.g. SG43)
</li><li> staff members use company cars to conduct visits
</li><li> a visit occurs at a specific time on a given day
</li><li> notes are made on the state of the property after each visit
</li></ul>
The company stores all of the associated data in a spreadsheet.
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Exercise: Functional Dependencies (1)</span></td><td align="right"><small>18/56</small></td></tr></tbody></table>
</p><p>
Describe any functional dependencies that exist in this data:
</p><p></p><pre><small>
<b>P</b>#  | <b>W</b>hen        | <b>A</b>ddress    | <b>N</b>otes         | <b>S</b>#   | Na<b>m</b>e  | <b>C</b>arReg
----+-------------+------------+---------------+------+-------+-------
PG4 | 03/06 15:15 | 55 High St | Bathroom leak | SG44 | Rob   | ABK754
PG1 | 04/06 11:10 | 47 High St | All ok        | SG44 | Rob   | ABK754
PG4 | 03/07 12:30 | 55 High St | All ok        | SG43 | Dave  | ATS123
PG1 | 05/07 15:00 | 47 High St | Broken window | SG44 | Rob   | ABK754
PG1 | 05/07 15:00 | 47 High St | Leaking tap   | SG44 | Rob   | ABK754
PG2 | 13/07 12:00 | 12 High St | All ok        | SG42 | Peter | ATS123
PG1 | 10/08 09:00 | 47 High St | Window fixed  | SG42 | Peter | ATS123
PG3 | 11/08 14:00 | 99 High St | All ok        | SG41 | John  | AAA001
PG4 | 13/08 10:00 | 55 High St | All ok        | SG44 | Rob   | ABK754
PG3 | 05/09 11:15 | 99 High St | Bathroom leak | SG42 | Peter | ATS123
</small></pre><p>
State assumptions used in determining the <i>fd</i>s.
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/fd1">[Solutions]</a>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: Functional Dependencies (2)</span></td><td align="right"><small>19/56</small></td></tr></tbody></table>
</p><p>
What functional dependencies exist in the following table:
</p><p></p><pre><small>
  A  |  B  |  C  |  D
-----+-----+-----+-----
  1  |  a  |  6  |  x
  2  |  b  |  7  |  y
  3  |  c  |  7  |  z
  4  |  d  |  6  |  x
  5  |  a  |  6  |  y
  6  |  b  |  7  |  z
  7  |  c  |  7  |  x
  8  |  d  |  6  |  y
</small></pre><p>
How is this case different to the previous one?
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/fd2">[Solutions]</a>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Functional Dependency</span></td><td align="right"><small>20/56</small></td></tr></tbody></table>
</p><p>
The above discussion was about dependency within a relation instance <i>r(R)</i>.
</p><p>
Much more important for design is the notion of dependency across all possible
instances of the relation (i.e. a schema-based dependency).
</p><p>
This is a simple generalisation of the previous definition:
</p><ul>
<li> for any <i>t, u &#8712; </i><font color="red">any</font><i> r(R)</i>, &nbsp; <i>t[X] = u[X] &nbsp; &#8658; &nbsp; t[Y] = u[Y]</i>
</li></ul>
Useful because such dependencies reflect the semantics of the problem domain.
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Functional Dependency</span></td><td align="right"><small>21/56</small></td></tr></tbody></table>
</p><p>
Can we generalise some ideas about functional dependency? <br>
</p><p>
E.g. are there dependencies that hold for <i>any</i> relation?
</p><ul>
<li> yes, but they're generally trivial, e.g. <i>Y &#8834; X &nbsp; &#8658; &nbsp; X &#8594; Y</i>
</li></ul>
E.g. do some dependencies suggest the existence of others?
<ul>
<li> yes, <em>rules of inference</em> allow us to <em>derive</em> dependencies
</li><li> allows us to reason about sets of functional dependencies
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Inference Rules</span></td><td align="right"><small>22/56</small></td></tr></tbody></table>
</p><p>
<em>Armstrong's rules</em> are complete, general rules of inference on <i>fd</i>s.
</p><p>
F1. <em>Reflexivity</em> &nbsp; e.g. &nbsp; <i>X &#8594; X</i>
<small>
</small></p><ul><small>
<li> a formal statement of <i>trivial dependencies</i>; useful for derivations
</li></small></ul><small>
</small>
F2. <em>Augmentation</em> &nbsp; e.g. &nbsp; <i>X &#8594; Y &nbsp;&#8658;&nbsp; XZ &#8594; YZ</i>
<small>
<ul>
<li> if a dependency holds, then we can freely expand its left hand side
</li></ul>
</small>
F3. <em>Transitivity</em> &nbsp; e.g. &nbsp; <i>X &#8594; Y, Y &#8594; Z &nbsp;&#8658;&nbsp; X &#8594; Z</i>
<small>
<ul>
<li> the "most powerful" inference rule; useful in multi-step derivations
</li></ul>
</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Inference Rules</span></td><td align="right"><small>23/56</small></td></tr></tbody></table>
</p><p>
Armstrong's rules are complete, but other useful rules exist:
</p><p>
F4. <em>Additivity</em> &nbsp; e.g. &nbsp; <i>X &#8594; Y, X &#8594; Z &nbsp; &#8658; &nbsp; X &#8594; YZ</i>
<small>
</small></p><ul><small>
<li> useful for constructing new right hand sides of <i>fd</i>s (also called <em>union</em>)
</li></small></ul><small>
</small>
F5. <em>Projectivity</em> &nbsp; e.g. &nbsp; <i>X &#8594; YZ &nbsp; &#8658; &nbsp; X &#8594; Y, X &#8594; Z</i>
<small>
<ul>
<li> useful for reducing right hand sides of <i>fd</i>s (also called <em>decomposition</em>)
</li></ul>
</small>
F6. <em>Pseudotransitivity</em> &nbsp; e.g. &nbsp; <i>X &#8594; Y, YZ &#8594; W &nbsp; &#8658; &nbsp; XZ &#8594; W</i>
<small>
<ul>
<li> shorthand for a common transitivity derivation
</li></ul>
</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Inference Rules</span></td><td align="right"><small>24/56</small></td></tr></tbody></table>
</p><p>
Example: determining validity of <i>AB &#8594; GH</i>, given:
</p><p>
</p><center>
<i>R = ABCDEFGHIJ</i> <p>
<i>F = { AB &#8594; E, &nbsp; AG &#8594; J, &nbsp; BE &#8594; I, &nbsp; E &#8594; G, &nbsp; GI &#8594; H }</i>
</p></center>
Derivation:
<center>
<table border="0" cellpadding="4">
<tbody><tr valign="top"><td><nobr> 1. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; E</i> </td><td></td><td> (given) </td></tr>
<tr valign="top"><td><nobr> 2. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; AB</i> </td><td></td><td> (using F1) </td></tr>
<tr valign="top"><td><nobr> 3. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; B</i> </td><td></td><td> (using F5 on 2) </td></tr>
<tr valign="top"><td><nobr> 4. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; BE</i> </td><td></td><td> (using F4 on 1,3) </td></tr>
<tr valign="top"><td><nobr> 5. &nbsp; </nobr></td><td></td><td> <i>BE &#8594; I</i> </td><td></td><td> (given) </td></tr>
<tr valign="top"><td><nobr> 6. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; I</i> </td><td></td><td> (using F3 on 4,5) </td></tr>
<tr valign="top"><td><nobr> 7. &nbsp; </nobr></td><td></td><td> <i>E &#8594; G</i> </td><td></td><td> (given) </td></tr>
<tr valign="top"><td><nobr> 8. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; G</i> </td><td></td><td> (using F3 on 1,7) </td></tr>
<tr valign="top"><td><nobr> 9. &nbsp; </nobr></td><td></td><td> <i>AB &#8594; GI</i> </td><td></td><td> (using F4 on 6,8) </td></tr>
<tr valign="top"><td><nobr> 10. </nobr></td><td></td><td> <i>GI &#8594; H</i> </td><td></td><td> (given) </td></tr>
<tr valign="top"><td><nobr> 11. </nobr></td><td></td><td> <i>AB &#8594; H</i> </td><td></td><td> (using F3 on 6,8) </td></tr>
<tr valign="top"><td><nobr> 12. </nobr></td><td></td><td> <i>AB &#8594; GH</i> </td><td></td><td> (using F4 on 8,11) </td></tr>
</tbody></table>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Closures</span></td><td align="right"><small>25/56</small></td></tr></tbody></table>
</p><p>
Given a set <i>F</i> of <i>fd</i>s, how many new <i>fd</i>s can we derive?
</p><p>
For a finite set of attributes, there must be a finite set of <i>fd</i>s.
</p><p>
The largest collection of dependencies that can be derived from <i>F</i>
is called the <em>closure</em> of <i>F</i> and is denoted <i>F<sup>+</sup></i>.
</p><p>
Closures allow us to answer two interesting questions:
</p><ul>
<li> is a particular dependency <i>X &#8594; Y</i> derivable from <i>F</i>?
</li><li> are two sets of dependencies <i>F</i> and <i>G</i> equivalent?
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Closures</span></td><td align="right"><small>26/56</small></td></tr></tbody></table>
</p><p>
For the question "is <i>X &#8594; Y</i> derivable from <i>F</i>?" ...
</p><ul>
<li> compute the closure <i>F<sup>+</sup></i>;
	check whether <i>X &#8594; Y &nbsp; &#8712; &nbsp; F<sup>+</sup></i>
</li></ul>
For the question "are <i>F</i> and <i>G</i> equivalent?" ...
<ul>
<li> compute closures <i>F<sup>+</sup></i> and <i>G<sup>+</sup></i>;
	check whether they're equal
</li></ul>
Unfortunately, closures can be very large, e.g.
<p>
<small>
<i>R = ABC, &nbsp;&nbsp;&nbsp; F = { AB &#8594; C, &nbsp; C &#8594; B }</i> <br>
<i>F<sup>+</sup> = { A &#8594; A, &nbsp; AB &#8594; A, &nbsp;
	AC &#8594; A, &nbsp; AB &#8594; B, &nbsp;
	BC &#8594; B, &nbsp; ABC &#8594; B, &nbsp;
<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
	C &#8594; C, &nbsp; AC &#8594; C, &nbsp;
	BC &#8594; C, &nbsp; ABC &#8594; C, &nbsp;
	AB &#8594; AB, &nbsp; . . . . . . ,
<br> &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
        AB &#8594; ABC, &nbsp; AB &#8594; ABC, &nbsp;
	C &#8594; B, &nbsp; C &#8594; BC, &nbsp;
	AC &#8594; B, &nbsp; AC &#8594; AB }</i>
</small>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Closures</span></td><td align="right"><small>27/56</small></td></tr></tbody></table>
</p><p>
Algorithms based on <i>F<sup>+</sup></i> rapidly become infeasible.
</p><p>
To solve this problem, use closures based on sets of attributes rather than sets of <i>fd</i>s.
</p><p>
Given a set <i>X</i> of attributes and a set <i>F</i> of <i>fd</i>s,
the largest set of attributes that can be derived from <i>X</i> using
<i>F</i>, is called the <em>closure</em> of <i>X</i>
(denoted <i>X<sup>+</sup></i>).
</p><p>
We can prove <small>(using additivity)</small> that &nbsp;&nbsp; <i>(X &#8594; Y) &#8712; F<sup>+</sup></i> &nbsp; iff &nbsp; <i>Y &#8834; X<sup>+</sup></i>.
</p><p>
For computation, <i>| X<sup>+</sup> |</i> is bounded by the number of attributes.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Closures</span></td><td align="right"><small>28/56</small></td></tr></tbody></table>
</p><p>
For the question "is <i>X &#8594; Y</i> derivable from <i>F</i>?" ...
</p><ul>
<li> compute the closure <i>X<sup>+</sup></i>,
	check whether <i>Y &nbsp; &#8834; &nbsp; X<sup>+</sup></i>
</li></ul>
For the question "are <i>F</i> and <i>G</i> equivalent?" ...
<ul>
<li> for each dependency in <i>G</i>, check whether derivable from <i>F</i>
</li><li> for each dependency in <i>F</i>, check whether derivable from <i>G</i>
</li><li> if true for all, then 
	<i>F &#8658; G</i> and <i>G &#8658; F</i>
	which implies <i>F<sup>+</sup> = G<sup>+</sup></i>
</li></ul>
For the question "what are the keys of <i>R</i> implied by <i>F</i>?" ...
<ul>
<li> find subsets <i>K &#8834; R</i> such that <i>K<sup>+</sup> = R</i>
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: Computing Keys</span></td><td align="right"><small>29/56</small></td></tr></tbody></table>
</p><p>
Determine possible primary keys for each of the following:
</p><ol>
<li> <i> FD &nbsp;=&nbsp; { A &#8594; B, C &#8594; D, E &#8594; FG }</i>
</li><li> <i> FD &nbsp;=&nbsp; { A &#8594; B, B &#8594; C, C &#8594; D }</i>
</li><li> <i> FD &nbsp;=&nbsp; { A &#8594; B, B &#8594; C, C &#8594; A }</i>
</li><li> <i> FD &nbsp;=&nbsp; { ABH &#8594; C, A &#8594; D, C &#8594; E, F &#8594; A, E &#8594; F, BGH &#8594; E }</i>
</li><li> <i> FD &nbsp;=&nbsp; { AB &#8594; C,  C &#8594; B}</i>
</li><li> <i> FD &nbsp;=&nbsp; { MN &#8594; P, NP &#8594; Q, Q &#8594; R}</i>
</li><li> <i> FD &nbsp;=&nbsp; { ABH &#8594; C, A &#8594; DE, BGH &#8594; F, FD &#8594; ADH, BH &#8594; GE}</i>
</li></ol>
<center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/keys">[Solutions]</a>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Normalization</span></td><td align="right"><small>30/56</small></td></tr></tbody></table>
</p><p>
<em>Normalization</em>: branch of relational theory providing design insights.
</p><p>
The goals of normalization:
</p><ul>
<li> be able to characterise the level of redundancy in a relational schema
</li><li> provide mechanisms for transforming schemas to remove redundancy
</li></ul>
<p>
Normalization draws heavily on the theory of functional dependencies.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Normal Forms</span></td><td align="right"><small>31/56</small></td></tr></tbody></table>
</p><p>
Normalization theory defines six <em>normal forms</em> (NFs).
</p><ul>
<li> First,Second,Third Normal Forms (1NF,2NF,3NF) <small>(Codd 1972)</small>
</li><li> Boyce-Codd Normal Form (BCNF) <small>(1974)</small>
</li><li> Fourth Normal Form (4NF) <small>(Zaniolo 1976, Fagin 1977)</small>
</li><li> Fifth Normal Form (5NF) <small>(Fagin 1979)</small>
</li></ul>
NF hierarachy: &nbsp; 5NF <i>&#8658;</i> 4NF <i>&#8658;</i> BCNF <i>&#8658;</i> 3NF <i>&#8658;</i> 2NF <i>&#8658;</i> 1NF
<p>
1NF allows most redundancy; &nbsp; 5NF allows least redundancy.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Normal Forms</span></td><td align="right"><small>32/56</small></td></tr></tbody></table>
</p><p>
</p><center>
<p><table border="0" cellpadding="6">
<tbody><tr valign="top">
  <td><nobr>1NF</nobr></td>
  <td></td><td>
    all attributes have atomic values <br>
    we assume this as part of relational model, <br>
    so <i>every</i> relation schema is in 1NF
  </td>
</tr>
<tr valign="top">
  <td><nobr>2NF</nobr></td>
  <td></td><td>
    all non-key attributes fully depend on key <br>
    (i.e. no partial dependencies) <br>
    avoids much redundancy <br>
  </td>
</tr>
<tr valign="top">
  <td><nobr>3NF<br>BCNF</nobr></td>
  <td></td><td>
    no attributes dependent on non-key attrs<br>
    (i.e. no transitive dependencies) <br>
    avoids most remaining redundancy <br>
  </td>
</tr>
</tbody></table></p><p>
</p></center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Normal Forms</span></td><td align="right"><small>33/56</small></td></tr></tbody></table>
</p><p>
</p><p>
The normalization process:
</p><ul>
<li> decide which normal form <i>rNF</i> is "acceptable".
<ul>
<li> how much redundancy are we willing to tolerate?
</li></ul>
</li><li> check whether each relation in schema is in <i>rNF</i>
</li><li> if a relation is not in <i>rNF</i>
<ul>
<li> partition into sub-relations where each is closer to <i>rNF</i>
</li></ul>
</li><li> repeat until all relations in schema are in <i>rNF</i>
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Normal Forms</span></td><td align="right"><small>34/56</small></td></tr></tbody></table>
</p><p>
In practice, BCNF and 3NF are the most important. <br>
<small>(these are the "acceptable normal forms" for relational design)</small>
</p><p>
Boyce-Codd Normal Form (BCNF):
</p><ul>
<li> eliminates all redundancy due to functional dependencies
</li><li> but may not preserve original functional dependencies
</li></ul>
Third Normal Form (3NF):
<ul>
<li> eliminates most (but not all) redundancy due to <i>fd</i>s
</li><li> guaranteed to preserve all functional dependencies
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Relation Decomposition</span></td><td align="right"><small>35/56</small></td></tr></tbody></table>
</p><p>
The standard transformation technique to remove redundancy:
</p><ul>
<li> <em>decompose</em> relation <i>R</i> into relations <i>S</i> and <i>T</i>
</li></ul>
<p>
We accomplish decomposition by
</p><ul>
<li> selecting (overlapping) subsets of attributes 
</li><li> forming new relations based on attribute subsets
</li></ul>
Properties: &nbsp; <i>R = S &#8746; T, &nbsp; S &#8745; T &#8800; &#8709;</i> &nbsp; and &nbsp; <i>r(R) = s(S) <img src="./Week 6 Lecture_files/join.gif"> t(T)</i>
<p>
May require several decompositions to achieve acceptable NF.
</p><p>
<em>Normalization algorithms</em> tell us how to choose <i>S</i> and <i>T</i>.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Schema Design</span></td><td align="right"><small>36/56</small></td></tr></tbody></table>
</p><p>
Consider the following relation for <i>BankLoans</i>:
</p><center>
<p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align="center">
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align="center">
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align="center">
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align="center">
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
</tbody></table></p><p>
</p></center>
<p>
This schema has all of the update anomalies mentioned earlier.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Schema Design</span></td><td align="right"><small>37/56</small></td></tr></tbody></table>
</p><p>
To improve the design, decompose the <i>BankLoans</i> relation.
</p><p>
The following decomposition is not helpful:
</p><p>
&nbsp;&nbsp;&nbsp; <i>Branch(branchName, branchCity, assets)</i> <br>
&nbsp;&nbsp;&nbsp; <i>CustLoan(custName, loanNo, amount)</i>
</p><p>
because we lose information <small>(which branch is a loan held at?)</small>
</p><p>
Another possible decomposition:
</p><p>
&nbsp;&nbsp;&nbsp; <i>BranchCust(branchName, branchCity, assets, custName)</i> <br>
&nbsp;&nbsp;&nbsp; <i>CustLoan(custName, loanNo, amount)</i>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Schema Design</span></td><td align="right"><small>38/56</small></td></tr></tbody></table>
</p><p>
The <i>BranchCust</i> relation instance:
</p><center>
<p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
</tr>
<tr align="center">
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
</tr>
<tr align="center">
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
</tr>
<tr align="center">
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
</tr>
<tr align="center">
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
</tr>
<tr align="center">
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
</tr>
</tbody></table></p><p>
</p></center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Schema Design</span></td><td align="right"><small>39/56</small></td></tr></tbody></table>
</p><p>
The <i>CustLoan</i> relation instance:
</p><p>
</p><center>
<p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align="center">
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align="center">
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align="center">
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align="center">
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align="center">
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
</tbody></table></p><p>
</p></center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Schema Design</span></td><td align="right"><small>40/56</small></td></tr></tbody></table>
</p><p>
Now consider the result of <i>(BranchCust&nbsp;Join&nbsp;CustLoan)</i>
</p><p>
</p><p><table border="1" cellpadding="2">
<tbody><tr align="center">
  <td><b>branchName</b></td>
  <td><b>branchCity</b></td>
  <td><b>assets</b></td>
  <td><b>custName</b></td>
  <td><b>loanNo</b></td>
  <td><b>amount</b></td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jones</td>
  <td>L-17</td>
  <td>1000</td>
</tr>
<tr align="center">
  <td><em>Downtown</em></td>
  <td><em>Brooklyn</em></td>
  <td><em>9000000</em></td>
  <td><em>Jones</em></td>
  <td><em>L-93</em></td>
  <td><em>500</em></td>
</tr>
<tr align="center">
  <td>Redwood</td>
  <td>Palo Alto</td>
  <td>2100000</td>
  <td>Smith</td>
  <td>L-23</td>
  <td>2000</td>
</tr>
<tr align="center">
  <td>Perryridge</td>
  <td>Horseneck</td>
  <td>1700000</td>
  <td>Hayes</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td><em>Perryridge</em></td>
  <td><em>Horseneck</em></td>
  <td><em>1700000</em></td>
  <td><em>Hayes</em></td>
  <td><em>L-16</em></td>
  <td><em>1300</em></td>
</tr>
<tr align="center">
  <td>Downtown</td>
  <td>Brooklyn</td>
  <td>9000000</td>
  <td>Jackson</td>
  <td>L-15</td>
  <td>1500</td>
</tr>
<tr align="center">
  <td>Mianus</td>
  <td>Horseneck</td>
  <td>400000</td>
  <td>Jones</td>
  <td>L-93</td>
  <td>500</td>
</tr>
<tr align="center">
  <td><em>Mianus</em></td>
  <td><em>Horseneck</em></td>
  <td><em>400000</em></td>
  <td><em>Jones</em></td>
  <td><em>L-17</em></td>
  <td><em>1000</em></td>
</tr>
<tr align="center">
  <td>Round Hill</td>
  <td>Horseneck</td>
  <td>8000000</td>
  <td>Turner</td>
  <td>L-11</td>
  <td>900</td>
</tr>
<tr align="center">
  <td>North Town</td>
  <td>Rye</td>
  <td>3700000</td>
  <td>Hayes</td>
  <td>L-16</td>
  <td>1300</td>
</tr>
<tr align="center">
  <td><em>North Town</em></td>
  <td><em>Rye</em></td>
  <td><em>3700000</em></td>
  <td><em>Hayes</em></td>
  <td><em>L-15</em></td>
  <td><em>1500</em></td>
</tr>
</tbody></table></p><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Schema Design</span></td><td align="right"><small>41/56</small></td></tr></tbody></table>
</p><p>
This is clearly not a successful decomposition.
</p><p>
The fact that we ended up with extra tuples was symptomatic of losing
some critical "connection" information during the decomposition.
</p><p>
Such a decomposition is called a <em>lossy decomposition</em>.
</p><p>
In a good decomposition, we should be able to reconstruct the
original relation exactly:
</p><p>
</p><center>
if <i>R</i> is decomposed into <i>S</i> and <i>T</i>, then <i>Join(S,T) = R</i>
</center>
<p>
Such a decomposition is called <em>lossless join decomposition</em>.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Boyce-Codd Normal Form</span></td><td align="right"><small>42/56</small></td></tr></tbody></table>
</p><p>
A relation schema <i>R</i> is in BCNF w.r.t a set <i>F</i> of functional dependencies iff:
</p><p>
for all <i>fd</i>s <i>X &#8594; Y</i> in <i>F<sup>+</sup></i>
</p><ul>
<li> either <i>X &#8594; Y</i> is trivial (i.e. <i>Y &#8834; X</i>)
</li><li> or <i>X</i> is a superkey
</li></ul>
A DB schema is in BCNF if all relation schemas are in BCNF.
<p>
<small>
Observations:
</small></p><ul><small>
<li> any two-attribute relation is in BCNF
</li><li> any relation with key <i>K</i>, other attributes <i>X</i>, and <i>K &#8594; X</i> is in BCNF
</li></small></ul><small>
</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Boyce-Codd Normal Form</span></td><td align="right"><small>43/56</small></td></tr></tbody></table>
</p><p>
If we transform a schema into BCNF, we are guaranteed:
</p><ul>
<li> no update anomalies due to <i>fd</i>-based redundancy
</li><li> lossless join decomposition
</li></ul>
However, we are <em>not</em> guaranteed:
<ul>
<li> the new schema preserves all <i>fd</i>s from the original schema
</li></ul>
<p>
This may be a problem if the <i>fd</i>s contain significant semantic
information about the problem domain.
</p><p>
If we need to preserve dependencies, use 3NF.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">BCNF Decomposition</span></td><td align="right"><small>44/56</small></td></tr></tbody></table>
</p><p>
The following algorithm converts an arbitrary schema to BCNF:
</p><p></p><pre><small>
Inputs: schema <i>R</i>, set <i>F</i> of <i>fd</i>s
Output: set <i>Res</i> of BCNF schemas

<i>Res</i> = {R};
while (any schema <i>S &#8712; Res</i> is not in BCNF) {
    choose any <i>fd</i> <i>X &#8594; Y</i> on <i>S</i> that violates BCNF
    <i>Res</i> = <i>(Res-S) &#8746; (S-Y) &#8746; XY</i>
}
</small></pre><p>
The last step means:
</p><ul>
<li> make a table from <i>XY</i>;
	drop <i>Y</i> from table <i>S</i>
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... BCNF Decomposition</span></td><td align="right"><small>45/56</small></td></tr></tbody></table>
</p><p>
Example (the <i>BankLoans</i> schema):
</p><p>
<i>BankLoans(branchName,  branchCity, assets, custName, loanNo, amount)</i>
</p><p>
Has functional dependencies <i>F</i>
</p><ul>
<li> <i>branchName &#8594; assets,branchCity</i>
</li><li> <i>loanNo &#8594; amount,branchName</i>
</li></ul>
The key for <i>BankLoans</i> is <i>branchName,custName,loanNo</i>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... BCNF Decomposition</span></td><td align="right"><small>46/56</small></td></tr></tbody></table>
</p><p>
Applying the BCNF algorithm:
</p><ul>
<li> check <i>BankLoans</i> relation ... it is not in BCNF <br>
	<small>(<i>branchName &#8594; assets,branchCity</i> violates BCNF
	 criteria; LHS is not a key)</small>
</li><li> to fix ... decompose <i>BankLoans</i> into <p>
&nbsp;&nbsp;&nbsp; <i>Branch(branchName, branchCity, assets)</i> <br>
&nbsp;&nbsp;&nbsp; <i>LoanInfo(branchName, custName, loanNo, amount)</i>
</p></li><li> check <i>Branch</i> relation ... it is in BCNF <br>
	<small>(the only nontrivial <i>fd</i>s have LHS=<i>branchName</i>, which is a key)</small>
</li></ul>
<small>(continued)</small>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... BCNF Decomposition</span></td><td align="right"><small>47/56</small></td></tr></tbody></table>
</p><p>
Applying the BCNF algorithm (cont):
</p><ul>
<li> check <i>LoanInfo</i> relation ... it is not in BCNF <br>
	<small>(<i>loanNo &#8594; amount,branchName</i> violates BCNF
	criteria; LHS is not a key)</small>
</li><li> to fix ... decompose <i>LoanInfo</i> into <p>
&nbsp;&nbsp;&nbsp; <i>Loan(branchName, loanNo, amount)</i> <br>
&nbsp;&nbsp;&nbsp; <i>Borrower(custName, loanNo)</i>
</p></li><li> check <i>Loan</i> ... it is in BCNF
</li><li> check <i>Borrower</i> ... it is in BCNF
</li></ul>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: BCNF Decomposition (1)</span></td><td align="right"><small>48/56</small></td></tr></tbody></table>
</p><p>
Consider the schema <i>R</i> and set of fds <i>F</i>
</p><p>
<i>R &nbsp;=&nbsp; ABCDEFGH</i>
</p><p>
<i>F &nbsp;=&nbsp; { ABH &#8594; C, A &#8594; DE, BGH &#8594; F,
F &#8594; ADH, BH &#8594; GE }</i>
</p><p>
Produce a BCNF decomposition of <i>R</i>.
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/bcnf1">[Solutions]</a>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: BCNF Decomposition (2)</span></td><td align="right"><small>49/56</small></td></tr></tbody></table>
</p><p>
Recall the following table (based on e.g. a spreadsheet):
</p><p></p><pre><small>
<b>P</b>#  | <b>W</b>hen        | <b>A</b>ddress    | <b>N</b>otes         | <b>S</b>#   | Na<b>m</b>e  | <b>C</b>arReg
----+-------------+------------+---------------+------+-------+-------
PG4 | 03/06 15:15 | 55 High St | Bathroom leak | SG44 | Rob   | ABK754
PG1 | 04/06 11:10 | 47 High St | All ok        | SG44 | Rob   | ABK754
PG4 | 03/07 12:30 | 55 High St | All ok        | SG43 | Dave  | ATS123
PG1 | 05/07 15:00 | 47 High St | Broken window | SG44 | Rob   | ABK754
PG1 | 05/07 15:00 | 47 High St | Leaking tap   | SG44 | Rob   | ABK754
PG2 | 13/07 12:00 | 12 High St | All ok        | SG42 | Peter | ATS123
...
</small></pre><p>
</p><p>
Recall the functional dependencies identified previously,
</p><p>
Use these to convert the table to a BCNF schema.
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/bcnf2">[Solutions]</a>
</center>
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Third Normal Form</span></td><td align="right"><small>50/56</small></td></tr></tbody></table>
</p><p>
A relation schema <i>R</i> is in 3NF w.r.t. a set <i>F</i> of functional dependencies iff:
</p><p>
for all <i>fd</i>s <i>X &#8594; Y</i> in <i>F<sup>+</sup></i>
</p><ul>
<li> either <i>X &#8594; Y</i> is trivial (i.e. <i>Y &#8834; X</i>)
</li><li> or <i>X</i> is a superkey
</li><li> or <i>Y</i> is a single attribute from a key
</li></ul>
A DB schema is in 3NF if all relation schemas are in 3NF.
<p>
<small>The extra condition represents a slight weakening of BCNF requirements.</small>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Third Normal Form</span></td><td align="right"><small>51/56</small></td></tr></tbody></table>
</p><p>
If we transform a schema into 3NF, we are guaranteed:
</p><ul>
<li> lossless join decomposition
</li><li> the new schema preserves all of the <i>fd</i>s from the original schema
</li></ul>
However, we are <em>not</em> guaranteed:
<ul>
<li> no update anomalies due to <i>fd</i>-based redundancy
</li></ul>
<p>
Whether to use BCNF or 3NF depends on overall design considerations.
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Third Normal Form</span></td><td align="right"><small>52/56</small></td></tr></tbody></table>
</p><p>
The following algorithm converts an arbitrary schema to 3NF:
</p><p></p><pre><small>
Inputs: schema <i>R</i>, set <i>F</i> of <i>fd</i>s
Output: set <i>R<sub>i</sub></i> of 3NF schemas

let <i>F<sub>c</sub></i> be a <em>minimal cover</em> for <i>F</i>
<i>Res</i> = {}
for each <i>fd</i> <i>X &#8594; Y</i> in <i>F<sub>c</sub></i> {
    if (no schema <i>S &#8712; Res</i> contains <i>XY</i>) {
        <i>Res</i> = <i>Res &#8746; XY</i>
    }
}
if (no schema <i>S &#8712; Res</i> contains a candidate key for <i>R</i>) {
    <i>K</i> = any candidate key for <i>R</i>
    <i>Res</i> = <i>Res &#8746; K</i>
}
</small></pre><p>
</p><p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="cont">... Third Normal Form</span></td><td align="right"><small>53/56</small></td></tr></tbody></table>
</p><p>
Critical step is producing minimal cover <i>F<sub>c</sub></i> for <i>F</i>
</p><p>
A set <i>F</i> of fds is minimal if
</p><ul>
<li> every fd <i>X &#8594; Y</i> is <i>simple</i> <br>
	<small>(<i>Y</i> is a single attribute)</small>
</li><li> every fd <i>X &#8594; Y</i> is <i>left-reduced</i> <br>
	<small>(no <i>Z &#8834; X</i> such that <i>Z &#8594; A</i> could replace <i>X &#8594; A</i> in <i>F</i> and preserve <i>F<sup>+</sup></i>)</small>
</li><li> every fd <i>X &#8594; Y</i> is <i>necessary</i> <br>
	<small>(no <i>X &#8594; Y</i> can be removed without changing <i>F<sup>+</sup></i>)</small>
</li></ul>
Algorithm: right-reduce, left-reduce, eliminate redundant fds
<p></p><hr><p>
<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: 3NF Decomposition (1)</span></td><td align="right"><small>54/56</small></td></tr></tbody></table>
</p><p>
Consider the schema <i>R</i> and set of fds <i>F</i>
</p><p>
<i>R &nbsp;=&nbsp; ABCDEFGH</i>
</p><p>
<i>F &nbsp;=&nbsp; F<sub>c</sub> &nbsp;=&nbsp; { ABH &#8594; C, A &#8594; D, C &#8594; E,
F &#8594; A, E &#8594; F, BGH &#8594; E }</i>
</p><p>
Produce a 3NF decomposition of <i>R</i>.
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/3nf1">[Solutions]</a>
</center>
<p></p><hr><p>

<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Exercise: 3NF Decomposition (2)</span></td><td align="right"><small>55/56</small></td></tr></tbody></table>

Recall the following table (based on e.g. a spreadsheet):
</p><p></p><pre><small>
<b>P</b>#  | <b>W</b>hen        | <b>A</b>ddress    | <b>N</b>otes         | <b>S</b>#   | Na<b>m</b>e  | <b>C</b>arReg
----+-------------+------------+---------------+------+-------+-------
PG4 | 03/06 15:15 | 55 High St | Bathroom leak | SG44 | Rob   | ABK754
PG1 | 04/06 11:10 | 47 High St | All ok        | SG44 | Rob   | ABK754
PG4 | 03/07 12:30 | 55 High St | All ok        | SG43 | Dave  | ATS123
PG1 | 05/07 15:00 | 47 High St | Broken window | SG44 | Rob   | ABK754
PG1 | 05/07 15:00 | 47 High St | Leaking tap   | SG44 | Rob   | ABK754
PG2 | 13/07 12:00 | 12 High St | All ok        | SG42 | Peter | ATS123
...
</small></pre><p>
</p><p>
Recall the functional dependencies identified previously,
</p><p>
Use these to convert the table to a 3NF schema.
</p><center>
<a href="https://www.cse.unsw.edu.au/~cs3311/19s1/lectures/06/exercises/3nf2">[Solutions]</a>
</center>
<p></p><hr><p>

<table width="100%" cellpadding="0">
<tbody><tr valign="top"><td align="left"><span class="heading">Database Design Methodology</span></td><td align="right"><small>56/56</small></td></tr></tbody></table>
</p><p>
To achieve a "good" database design:
</p><ul>
<li> identify attributes, entities, relationships &nbsp; <i>&#8594;</i> &nbsp; ER design
</li><li> map ER design to relational schema
</li><li> identify constraints <small>(including keys and functional dependencies)</small>
</li><li> apply BCNF/3NF algorithms to produce normalized schema
</li></ul>
<small>
Note: may subsequently need to "denormalise" if the design yields inadequate performance.
</small>
<p></p><hr><p>
<small><small>Produced: 26 April 2018</small></small>


</p></body></html>